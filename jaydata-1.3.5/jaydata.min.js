function jsonify(n){return JSON.stringify(n,null,"\t")}var EventSubscriber;(function(n){n(self.acorn||(self.acorn={}))})(function(n){"use strict";function eu(n){u=n||{};for(var t in tr)u.hasOwnProperty(t)||(u[t]=tr[t]);nr=u.sourceFile||null}function e(n,r){var f=ou(i,n),u;r+=" ("+f.line+":"+f.column+")";u=new SyntaxError(r);u.pos=n;u.loc=f;u.raisedAt=t;throw u;}function ni(n){function e(n){if(n.length==1)return i+="return str === "+JSON.stringify(n[0])+";";i+="switch(str){";for(var t=0;t<n.length;++t)i+="case "+JSON.stringify(n[t])+":";i+="return true}return false;"}var i,r,u,t,f;n=n.split(" ");i="";r=[];n:for(t=0;t<n.length;++t){for(u=0;u<r.length;++u)if(r[u][0].length==n[t].length){r[u].push(n[t]);continue n}r.push([n[t]])}if(r.length>3){for(r.sort(function(n,t){return t.length-n.length}),i+="switch(str.length){",t=0;t<r.length;++t)f=r[t],i+="case "+f[0].length+":",e(f);i+="}"}else e(n);return new Function("str",i)}function pi(n){return n<65?n===36:n<91?!0:n<97?n===95:n<123?!0:n>=170&&hf.test(String.fromCharCode(n))}function cf(n){return n<48?n===36:n<58?!0:n<65?!1:n<91?!0:n<97?n===95:n<123?!0:n>=170&&we.test(String.fromCharCode(n))}function lt(){this.line=it;this.column=t-b}function lf(){it=1;t=b=0;si=!0;wi()}function a(n,i){vt=t;u.locations&&(oi=new lt);f=n;wi();tt=i;si=n.beforeExpr}function be(){var o=u.onComment&&u.locations&&new lt,r=t,f=i.indexOf("*/",t+=2),n;if(f===-1&&e(t-2,"Unterminated comment"),t=f+2,u.locations)for(bt.lastIndex=r;(n=bt.exec(i))&&n.index<t;)++it,b=n.index+n[0].length;if(u.onComment)u.onComment(!0,i.slice(r+2,f),r,t,o,u.locations&&new lt)}function ke(){for(var r=t,f=u.onComment&&u.locations&&new lt,n=i.charCodeAt(t+=2);t<st&&n!==10&&n!==13&&n!==8232&&n!==8329;)++t,n=i.charCodeAt(t);if(u.onComment)u.onComment(!1,i.slice(r+2,t),r,t,f,u.locations&&new lt)}function wi(){for(var n,r;t<st;)if(n=i.charCodeAt(t),n===32)++t;else if(n===13)++t,r=i.charCodeAt(t),r===10&&++t,u.locations&&(++it,b=t);else if(n===10)++t,++it,b=t;else if(n<14&&n>8)++t;else if(n===47)if(r=i.charCodeAt(t+1),r===42)be();else if(r===47)ke();else break;else if(n<14&&n>8||n===32||n===160)++t;else if(n>=5760&&pe.test(String.fromCharCode(n)))++t;else break}function de(){var n=i.charCodeAt(t+1);return n>=48&&n<=57?vf(!0):(++t,a(ar))}function ge(){var n=i.charCodeAt(t+1);return si?(++t,af()):n===61?v(wt,2):v(yr,1)}function no(){var n=i.charCodeAt(t+1);return n===61?v(wt,2):v(le,1)}function to(n){var r=i.charCodeAt(t+1);return r===n?v(n===124?re:ue,2):r===61?v(wt,2):v(n===124?fe:oe,1)}function io(){var n=i.charCodeAt(t+1);return n===61?v(wt,2):v(ee,1)}function ro(n){var r=i.charCodeAt(t+1);return r===n?v(ie,2):r===61?v(wt,2):v(te,1)}function uo(n){var u=i.charCodeAt(t+1),r=1;return u===n?(r=n===62&&i.charCodeAt(t+2)===62?3:2,i.charCodeAt(t+r)===61)?v(wt,r+1):v(ce,r):(u===61&&(r=i.charCodeAt(t+2)===61?3:2),v(he,r))}function fo(n){var r=i.charCodeAt(t+1);return r===61?v(se,i.charCodeAt(t+2)===61?3:2):v(n===61?pr:ef,1)}function eo(n){switch(n){case 46:return de();case 40:return++t,a(g);case 41:return++t,a(k);case 59:return++t,a(nt);case 44:return++t,a(rt);case 91:return++t,a(ai);case 93:return++t,a(vi);case 123:return++t,a(yt);case 125:return++t,a(ct);case 58:return++t,a(pt);case 63:return++t,a(vr);case 48:var r=i.charCodeAt(t+1);if(r===120||r===88)return oo();case 49:case 50:case 51:case 52:case 53:case 54:case 55:case 56:case 57:return vf(!1);case 34:case 39:return so(n);case 47:return ge(n);case 37:case 42:return no();case 124:case 38:return to(n);case 94:return io();case 43:case 45:return ro(n);case 60:case 62:return uo(n);case 61:case 33:return fo(n);case 126:return v(ef,1)}return!1}function ti(n){var r,o,f;if(n?t=l+1:l=t,u.locations&&(ei=new lt),n)return af();if(t>=st)return a(ci);if(r=i.charCodeAt(t),pi(r)||r===92)return pf();if(o=eo(r),o===!1){if(f=String.fromCharCode(r),f==="\\"||hf.test(f))return pf();e(t,"Unexpected character '"+f+"'")}return o}function v(n,r){var u=i.slice(t,t+r);t+=r;a(n,u)}function af(){for(var s="",o,r,u=t,n,f;;){if(t>=st&&e(u,"Unterminated regular expression"),n=i.charAt(t),br.test(n)&&e(u,"Unterminated regular expression"),o)o=!1;else{if(n==="[")r=!0;else if(n==="]"&&r)r=!1;else if(n==="/"&&!r)break;o=n==="\\"}++t}return s=i.slice(u,t),++t,f=yf(),f&&!/^[gmsiy]*$/.test(f)&&e(u,"Invalid regexp flag"),a(ur,new RegExp(s,f))}function ii(n,r){for(var u,e,o=t,f=0,s=0,h=r==null?Infinity:r;s<h;++s){if(u=i.charCodeAt(t),e=u>=97?u-87:u>=65?u-55:u>=48&&u<=57?u-48:Infinity,e>=n)break;++t;f=f*n+e}return t===o||r!=null&&t-o!==r?null:f}function oo(){t+=2;var n=ii(16);return n==null&&e(l+2,"Expected hexadecimal number"),pi(i.charCodeAt(t))&&e(t,"Identifier directly after number"),a(gt,n)}function vf(n){var f=t,s=!1,h=i.charCodeAt(t)===48,r,u,o;return n||ii(10)!==null||e(f,"Invalid number"),i.charCodeAt(t)===46&&(++t,ii(10),s=!0),r=i.charCodeAt(t),(r===69||r===101)&&(r=i.charCodeAt(++t),(r===43||r===45)&&++t,ii(10)===null&&e(f,"Invalid number"),s=!0),pi(i.charCodeAt(t))&&e(t,"Identifier directly after number"),u=i.slice(f,t),s?o=parseFloat(u):h&&u.length!==1?/[89]/.test(u)||w?e(f,"Invalid number"):o=parseInt(u,8):o=parseInt(u,10),a(gt,o)}function so(n){var r,o,f;for(t++,r="";;){if(t>=st&&e(l,"Unterminated string constant"),o=i.charCodeAt(t),o===n)return++t,a(hi,r);if(o===92){for(o=i.charCodeAt(++t),f=/^[0-7]+/.exec(i.slice(t,t+3)),f&&(f=f[0]);f&&parseInt(f,8)>255;)f=f.slice(0,f.length-1);if(f==="0"&&(f=null),++t,f)w&&e(t-2,"Octal literal in strict mode"),r+=String.fromCharCode(parseInt(f,8)),t+=f.length-1;else switch(o){case 110:r+="\n";break;case 114:r+="\r";break;case 120:r+=String.fromCharCode(bi(2));break;case 117:r+=String.fromCharCode(bi(4));break;case 85:r+=String.fromCharCode(bi(8));break;case 116:r+="\t";break;case 98:r+="\b";break;case 118:r+="\x0b";break;case 102:r+="\f";break;case 48:r+="\0";break;case 13:i.charCodeAt(t)===10&&++t;case 10:u.locations&&(b=t,++it);break;default:r+=String.fromCharCode(o)}}else(o===13||o===10||o===8232||o===8329)&&e(l,"Unterminated string constant"),r+=String.fromCharCode(o),++t}}function bi(n){var t=ii(16,n);return t===null&&e(l,"Bad character escape sequence"),t}function yf(){var n,u,f,o,r,s;for(kt=!1,u=!0,f=t;;){if(o=i.charCodeAt(t),cf(o))kt&&(n+=i.charAt(t)),++t;else if(o===92)kt||(n=i.slice(f,t)),kt=!0,i.charCodeAt(++t)!=117&&e(t,"Expecting Unicode escape sequence \\uXXXX"),++t,r=bi(4),s=String.fromCharCode(r),s||e(t-1,"Invalid Unicode escape"),(u?pi(r):cf(r))||e(t-4,"Invalid Unicode escape"),n+=s;else break;u=!1}return kt?n:i.slice(f,t)}function pf(){var n=yf(),t=ht;return kt||(ye(n)?t=lr[n]:(u.forbidReserved&&(u.ecmaVersion===3?ae:ve)(n)||w&&of(n))&&e(l,"The keyword '"+n+"' is reserved")),a(t,n)}function o(){ir=l;ft=vt;rr=oi;ti()}function kr(n){for(w=n,t=ft;t<b;)b=i.lastIndexOf("\n",b-2)+1,--it;wi();ti()}function wf(){this.type=null;this.start=l;this.end=null}function bf(){this.start=ei;this.end=null;nr!==null&&(this.source=nr)}function y(){var n=new wf;return u.locations&&(n.loc=new bf),u.ranges&&(n.range=[l,0]),n}function et(n){var t=new wf;return t.start=n.start,u.locations&&(t.loc=new bf,t.loc.start=n.loc.start),u.ranges&&(t.range=[n.range[0],0]),t}function r(n,t){return n.type=t,n.end=ft,u.locations&&(n.loc.end=rr),u.ranges&&(n.range[1]=ft),n}function dr(n){return u.ecmaVersion>=5&&n.type==="ExpressionStatement"&&n.expression.type==="Literal"&&n.expression.value==="use strict"}function s(n){if(f===n)return o(),!0}function ki(){return!u.strictSemicolons&&(f===ci||f===ct||br.test(i.slice(ft,l)))}function at(){s(nt)||ki()||ut()}function c(n){f===n?o():ut()}function ut(){e(l,"Unexpected token")}function di(n){n.type!=="Identifier"&&n.type!=="MemberExpression"&&e(n.start,"Assigning to rvalue");w&&n.type==="Identifier"&&yi(n.name)&&e(n.start,"Assigning to "+n.name+" in strict mode")}function ho(n){var i,e,o;for(ir=ft=t,u.locations&&(rr=new lt),dt=w=null,h=[],ti(),i=n||y(),e=!0,n||(i.body=[]);f!==ci;)o=d(),i.body.push(o),e&&dr(o)&&kr(!0),e=!1;return r(i,"Program")}function d(){var b,n,rt,et,a,t,lt,vt,v,st,it,u,wt;f===yr&&ti(!0);b=f;n=y();switch(b){case fr:case hu:for(o(),rt=b===fr,s(nt)||ki()?n.label=null:f!==ht?ut():(n.label=ot(),at()),u=0;u<h.length;++u)if(et=h[u],n.label==null||et.name===n.label.name){if(et.kind!=null&&(rt||et.kind==="loop"))break;if(n.label&&rt)break}return u===h.length&&e(n.start,"Unsyntactic "+b.keyword),r(n,rt?"BreakStatement":"ContinueStatement");case cu:return o(),at(),r(n,"DebuggerStatement");case au:return o(),h.push(gi),n.body=d(),h.pop(),c(cr),n.test=ri(),at(),r(n,"DoWhileStatement");case pu:return(o(),h.push(gi),c(g),f===nt)?gr(n,null):f===hr?(a=y(),o(),gf(a,!0),a.declarations.length===1&&s(li))?df(n,a):gr(n,a):(a=p(!1,!0),s(li))?(di(a),df(n,a)):gr(n,a);case or:return o(),uu(n,!0);case wu:return o(),n.test=ri(),n.consequent=d(),n.alternate=s(vu)?d():null,r(n,"IfStatement");case bu:return dt||e(l,"'return' outside of function"),o(),s(nt)||ki()?n.argument=null:(n.argument=p(),at()),r(n,"ReturnStatement");case sr:for(o(),n.discriminant=ri(),n.cases=[],c(yt),h.push(kf);f!=ct;)f===er||f===lu?(vt=f===er,t&&r(t,"SwitchCase"),n.cases.push(t=y()),t.consequent=[],o(),vt?t.test=p():(lt&&e(ir,"Multiple default clauses"),lt=!0,t.test=null),c(pt)):(t||ut(),t.consequent.push(d()));return t&&r(t,"SwitchCase"),o(),h.pop(),r(n,"SwitchStatement");case ku:return o(),br.test(i.slice(ft,l))&&e(ft,"Illegal newline after throw"),n.argument=p(),at(),r(n,"ThrowStatement");case du:return o(),n.block=ui(),n.handler=null,f===su&&(v=y(),o(),c(g),v.param=ot(),w&&yi(v.param.name)&&e(v.param.start,"Binding "+v.param.name+" in strict mode"),c(k),v.guard=null,v.body=ui(),n.handler=r(v,"CatchClause")),n.finalizer=s(yu)?ui():null,n.handler||n.finalizer||e(n.start,"Missing catch or finally clause"),r(n,"TryStatement");case hr:return o(),n=gf(n),at(),n;case cr:return o(),n.test=ri(),h.push(gi),n.body=d(),h.pop(),r(n,"WhileStatement");case gu:return w&&e(l,"'with' in strict mode"),o(),n.object=ri(),n.body=d(),r(n,"WithStatement");case yt:return ui();case nt:return o(),r(n,"EmptyStatement");default:if(st=tt,it=p(),b===ht&&it.type==="Identifier"&&s(pt)){for(u=0;u<h.length;++u)h[u].name===st&&e(it.start,"Label '"+st+"' is already declared");return wt=f.isLoop?"loop":f===sr?"switch":null,h.push({name:st,kind:wt}),n.body=d(),h.pop(),n.label=it,r(n,"LabeledStatement")}return n.expression=it,at(),r(n,"ExpressionStatement")}}function ri(){c(g);var n=p();return c(k),n}function ui(){var n=y(),u=!0,t=!1,f,i;for(n.body=[],c(yt);!s(ct);)i=d(),n.body.push(i),u&&dr(i)&&(f=t,kr(t=!0)),u=!1;return t&&!f&&kr(!1),r(n,"BlockStatement")}function gr(n,t){return n.init=t,c(nt),n.test=f===nt?null:p(),c(nt),n.update=f===k?null:p(),c(k),n.body=d(),h.pop(),r(n,"ForStatement")}function df(n,t){return n.left=t,n.right=p(),c(k),n.body=d(),h.pop(),r(n,"ForInStatement")}function gf(n,t){for(n.declarations=[],n.kind="var";;){var i=y();if(i.id=ot(),w&&yi(i.id.name)&&e(i.id.start,"Binding "+i.id.name+" in strict mode"),i.init=s(pr)?p(!0,t):null,n.declarations.push(r(i,"VariableDeclarator")),!s(rt))break}return r(n,"VariableDeclaration")}function p(n,t){var u=nu(t),i;if(!n&&f===rt){for(i=et(u),i.expressions=[u];s(rt);)i.expressions.push(nu(t));return r(i,"SequenceExpression")}return u}function nu(n){var i=co(n),t;return f.isAssign?(t=et(i),t.operator=tt,t.left=i,o(),t.right=nu(n),di(i),r(t,"AssignmentExpression")):i}function co(n){var i=lo(n),t;return s(vr)?(t=et(i),t.test=i,t.consequent=p(!0),c(pt),t.alternate=p(!0,n),r(t,"ConditionalExpression")):i}function lo(n){return tu(iu(n),-1,n)}function tu(n,t,i){var e=f.binop,u;return e!=null&&(!i||f!==li)&&e>t?(u=et(n),u.left=n,u.operator=tt,o(),u.right=tu(iu(i),e,i),u=r(u,/&&|\|\|/.test(u.operator)?"LogicalExpression":"BinaryExpression"),tu(u,t,i)):n}function iu(n){var u,i,t;if(f.prefix)return t=y(),u=f.isUpdate,t.operator=tt,t.prefix=!0,o(),t.argument=iu(n),u?di(t.argument):w&&t.operator==="delete"&&t.argument.type==="Identifier"&&e(t.start,"Deleting local variable in strict mode"),r(t,u?"UpdateExpression":"UnaryExpression");for(i=ao();f.postfix&&!ki();)t=et(i),t.operator=tt,t.prefix=!1,t.argument=i,di(i),o(),i=r(t,"UpdateExpression");return i}function ao(){return fi(ru())}function fi(n,t){var i;return s(ar)?(i=et(n),i.object=n,i.property=ot(!0),i.computed=!1,fi(r(i,"MemberExpression"),t)):s(ai)?(i=et(n),i.object=n,i.property=p(),i.computed=!0,c(vi),fi(r(i,"MemberExpression"),t)):!t&&s(g)?(i=et(n),i.callee=n,i.arguments=fu(k,!1),fi(r(i,"CallExpression"),t)):n}function ru(){var s,e,t,n;switch(f){case tf:return n=y(),o(),r(n,"ThisExpression");case ht:return ot();case gt:case hi:case ur:return n=y(),n.value=tt,n.raw=i.slice(l,vt),o(),r(n,"Literal");case rf:case uf:case ff:return n=y(),n.value=f.atomValue,n.raw=f.keyword,o(),r(n,"Literal");case g:return s=ei,e=l,o(),t=p(),t.start=e,t.end=vt,u.locations&&(t.loc.start=s,t.loc.end=oi),u.ranges&&(t.range=[e,vt]),c(k),t;case ai:return n=y(),o(),n.elements=fu(vi,!0,!0),r(n,"ArrayExpression");case yt:return yo();case or:return n=y(),o(),uu(n,!1);case nf:return vo();default:ut()}}function vo(){var n=y();return o(),n.callee=fi(ru(),!0),n.arguments=s(g)?fu(k,!1):[],r(n,"NewExpression")}function yo(){var i=y(),b=!0,k=!1,n,v,h,l,t,a;for(i.properties=[],o();!s(ct);){if(b)b=!1;else if(c(rt),u.allowTrailingCommas&&s(ct))break;if(n={key:ne()},v=!1,s(pt)?(n.value=p(!0),h=n.kind="init"):u.ecmaVersion>=5&&n.key.type==="Identifier"&&(n.key.name==="get"||n.key.name==="set")?(v=k=!0,h=n.kind=n.key.name,n.key=ne(),f!==g&&ut(),n.value=uu(y(),!1)):ut(),n.key.type==="Identifier"&&(w||k))for(l=0;l<i.properties.length;++l)t=i.properties[l],t.key.name===n.key.name&&(a=h==t.kind||v&&t.kind==="init"||h==="init"&&(t.kind==="get"||t.kind==="set"),a&&!w&&h==="init"&&t.kind==="init"&&(a=!1),a&&e(n.key.start,"Redefinition of property"));i.properties.push(n)}return r(i,"ObjectExpression")}function ne(){return f===gt||f===hi?ru():ot(!0)}function uu(n,t){var l,a,v,i,u,o;for(f===ht?n.id=ot():t?ut():n.id=null,n.params=[],l=!0,c(g);!s(k);)l?l=!1:c(rt),n.params.push(ot());if(a=dt,v=h,dt=!0,h=[],n.body=ui(!0),dt=a,h=v,w||n.body.body.length&&dr(n.body.body[0]))for(i=n.id?-1:0;i<n.params.length;++i)if(u=i<0?n.id:n.params[i],(of(u.name)||yi(u.name))&&e(u.start,"Defining '"+u.name+"' in strict mode"),i>=0)for(o=0;o<i;++o)u.name===n.params[o].name&&e(u.start,"Argument name clash in strict mode");return r(n,t?"FunctionDeclaration":"FunctionExpression")}function fu(n,t,i){for(var r=[],e=!0;!s(n);){if(e)e=!1;else if(c(rt),t&&u.allowTrailingCommas&&s(n))break;i&&f===rt?r.push(null):r.push(p(!0))}return r}function ot(n){var t=y();return t.name=f===ht?tt:n&&!u.forbidReserved&&f.keyword||ut(),o(),r(t,"Identifier")}var u,i,st,nr,tr,ou,t,l,vt,ei,oi,f,tt,si,it,b,ir,ft,rr,dt,h,w,wr,kt,gi,kf;n.version="0.1.01";n.parse=function(n,t){return i=String(n),st=i.length,eu(t),lf(),ho(u.program)};tr=n.defaultOptions={ecmaVersion:5,strictSemicolons:!1,allowTrailingCommas:!0,forbidReserved:!1,locations:!1,onComment:null,ranges:!1,program:null,sourceFile:null};ou=n.getLineInfo=function(n,t){for(var i,u=1,r=0;;)if(bt.lastIndex=r,i=bt.exec(n),i&&i.index<t)++u,r=i.index+i[0].length;else break;return{line:u,column:t-r}};n.tokenize=function(n,r){function o(n){return ti(n),e.start=l,e.end=vt,e.startLoc=ei,e.endLoc=oi,e.type=f,e.value=tt,e}i=String(n);st=i.length;eu(r);lf();var e={};return o.jumpTo=function(n,r){var f,e;if(t=n,u.locations)for(it=b=bt.lastIndex=0;(f=bt.exec(i))&&f.index<n;)++it,b=f.index+f[0].length;e=i.charAt(n-1);si=r;wi()},o};var gt={type:"num"},ur={type:"regexp"},hi={type:"string"},ht={type:"name"},ci={type:"eof"},fr={keyword:"break"},er={keyword:"case",beforeExpr:!0},su={keyword:"catch"},hu={keyword:"continue"},cu={keyword:"debugger"},lu={keyword:"default"},au={keyword:"do",isLoop:!0},vu={keyword:"else",beforeExpr:!0},yu={keyword:"finally"},pu={keyword:"for",isLoop:!0},or={keyword:"function"},wu={keyword:"if"},bu={keyword:"return",beforeExpr:!0},sr={keyword:"switch"},ku={keyword:"throw",beforeExpr:!0},du={keyword:"try"},hr={keyword:"var"},cr={keyword:"while",isLoop:!0},gu={keyword:"with"},nf={keyword:"new",beforeExpr:!0},tf={keyword:"this"},rf={keyword:"null",atomValue:null},uf={keyword:"true",atomValue:!0},ff={keyword:"false",atomValue:!1},li={keyword:"in",binop:7,beforeExpr:!0},lr={"break":fr,"case":er,"catch":su,"continue":hu,"debugger":cu,"default":lu,"do":au,"else":vu,"finally":yu,"for":pu,"function":or,"if":wu,"return":bu,"switch":sr,"throw":ku,"try":du,"var":hr,"while":cr,"with":gu,"null":rf,"true":uf,"false":ff,"new":nf,"in":li,"instanceof":{keyword:"instanceof",binop:7,beforeExpr:!0},"this":tf,"typeof":{keyword:"typeof",prefix:!0,beforeExpr:!0},"void":{keyword:"void",prefix:!0,beforeExpr:!0},"delete":{keyword:"delete",prefix:!0,beforeExpr:!0}},ai={type:"[",beforeExpr:!0},vi={type:"]"},yt={type:"{",beforeExpr:!0},ct={type:"}"},g={type:"(",beforeExpr:!0},k={type:")"},rt={type:",",beforeExpr:!0},nt={type:";",beforeExpr:!0},pt={type:":",beforeExpr:!0},ar={type:"."},vr={type:"?",beforeExpr:!0},yr={binop:10,beforeExpr:!0},pr={isAssign:!0,beforeExpr:!0},wt={isAssign:!0,beforeExpr:!0},te={binop:9,prefix:!0,beforeExpr:!0},ie={postfix:!0,prefix:!0,isUpdate:!0},ef={prefix:!0,beforeExpr:!0},re={binop:1,beforeExpr:!0},ue={binop:2,beforeExpr:!0},fe={binop:3,beforeExpr:!0},ee={binop:4,beforeExpr:!0},oe={binop:5,beforeExpr:!0},se={binop:6,beforeExpr:!0},he={binop:7,beforeExpr:!0},ce={binop:8,beforeExpr:!0},le={binop:10,beforeExpr:!0};n.tokTypes={bracketL:ai,bracketR:vi,braceL:yt,braceR:ct,parenL:g,parenR:k,comma:rt,semi:nt,colon:pt,dot:ar,question:vr,slash:yr,eq:pr,name:ht,eof:ci,num:gt,regexp:ur,string:hi};for(wr in lr)n.tokTypes[wr]=lr[wr];var ae=ni("abstract boolean byte char class double enum export extends final float goto implements import int interface long native package private protected public short static super synchronized throws transient volatile"),ve=ni("class enum extends super const export import"),of=ni("implements interface let package private protected public static yield"),yi=ni("eval arguments"),ye=ni("break case catch continue debugger default do else finally for function if return switch throw try var while with null true false instanceof typeof void delete new in this"),pe=/[\u1680\u180e\u2000-\u200a\u2028\u2029\u202f\u205f\u3000\ufeff]/,sf="ªµºÀ-ÖØ-öø-ˁˆ-ˑˠ-ˤˬˮͰ-ʹͶͷͺ-ͽΆΈ-ΊΌΎ-ΡΣ-ϵϷ-ҁҊ-ԧԱ-Ֆՙա-ևא-תװ-ײؠ-يٮٯٱ-ۓەۥۦۮۯۺ-ۼۿܐܒ-ܯݍ-ޥޱߊ-ߪߴߵߺࠀ-ࠕࠚࠤࠨࡀ-ࡘࢠࢢ-ࢬऄ-हऽॐक़-ॡॱ-ॷॹ-ॿঅ-ঌএঐও-নপ-রলশ-হঽৎড়ঢ়য়-ৡৰৱਅ-ਊਏਐਓ-ਨਪ-ਰਲਲ਼ਵਸ਼ਸਹਖ਼-ੜਫ਼ੲ-ੴઅ-ઍએ-ઑઓ-નપ-રલળવ-હઽૐૠૡଅ-ଌଏଐଓ-ନପ-ରଲଳଵ-ହଽଡ଼ଢ଼ୟ-ୡୱஃஅ-ஊஎ-ஐஒ-கஙசஜஞடணதந-பம-ஹௐఅ-ఌఎ-ఐఒ-నప-ళవ-హఽౘౙౠౡಅ-ಌಎ-ಐಒ-ನಪ-ಳವ-ಹಽೞೠೡೱೲഅ-ഌഎ-ഐഒ-ഺഽൎൠൡൺ-ൿඅ-ඖක-නඳ-රලව-ෆก-ะาำเ-ๆກຂຄງຈຊຍດ-ທນ-ຟມ-ຣລວສຫອ-ະາຳຽເ-ໄໆໜ-ໟༀཀ-ཇཉ-ཬྈ-ྌက-ဪဿၐ-ၕၚ-ၝၡၥၦၮ-ၰၵ-ႁႎႠ-ჅჇჍა-ჺჼ-ቈቊ-ቍቐ-ቖቘቚ-ቝበ-ኈኊ-ኍነ-ኰኲ-ኵኸ-ኾዀዂ-ዅወ-ዖዘ-ጐጒ-ጕጘ-ፚᎀ-ᎏᎠ-Ᏼᐁ-ᙬᙯ-ᙿᚁ-ᚚᚠ-ᛪᛮ-ᛰᜀ-ᜌᜎ-ᜑᜠ-ᜱᝀ-ᝑᝠ-ᝬᝮ-ᝰក-ឳៗៜᠠ-ᡷᢀ-ᢨᢪᢰ-ᣵᤀ-ᤜᥐ-ᥭᥰ-ᥴᦀ-ᦫᧁ-ᧇᨀ-ᨖᨠ-ᩔᪧᬅ-ᬳᭅ-ᭋᮃ-ᮠᮮᮯᮺ-ᯥᰀ-ᰣᱍ-ᱏᱚ-ᱽᳩ-ᳬᳮ-ᳱᳵᳶᴀ-ᶿḀ-ἕἘ-Ἕἠ-ὅὈ-Ὅὐ-ὗὙὛὝὟ-ώᾀ-ᾴᾶ-ᾼιῂ-ῄῆ-ῌῐ-ΐῖ-Ίῠ-Ῥῲ-ῴῶ-ῼⁱⁿₐ-ₜℂℇℊ-ℓℕℙ-ℝℤΩℨK-ℭℯ-ℹℼ-ℿⅅ-ⅉⅎⅠ-ↈⰀ-Ⱞⰰ-ⱞⱠ-ⳤⳫ-ⳮⳲⳳⴀ-ⴥⴧⴭⴰ-ⵧⵯⶀ-ⶖⶠ-ⶦⶨ-ⶮⶰ-ⶶⶸ-ⶾⷀ-ⷆⷈ-ⷎⷐ-ⷖⷘ-ⷞⸯ々-〇〡-〩〱-〵〸-〼ぁ-ゖゝ-ゟァ-ヺー-ヿㄅ-ㄭㄱ-ㆎㆠ-ㆺㇰ-ㇿ㐀-䶵一-鿌ꀀ-ꒌꓐ-ꓽꔀ-ꘌꘐ-ꘟꘪꘫꙀ-ꙮꙿ-ꚗꚠ-ꛯꜗ-ꜟꜢ-ꞈꞋ-ꞎꞐ-ꞓꞠ-Ɦꟸ-ꠁꠃ-ꠅꠇ-ꠊꠌ-ꠢꡀ-ꡳꢂ-ꢳꣲ-ꣷꣻꤊ-ꤥꤰ-ꥆꥠ-ꥼꦄ-ꦲꧏꨀ-ꨨꩀ-ꩂꩄ-ꩋꩠ-ꩶꩺꪀ-ꪯꪱꪵꪶꪹ-ꪽꫀꫂꫛ-ꫝꫠ-ꫪꫲ-ꫴꬁ-ꬆꬉ-ꬎꬑ-ꬖꬠ-ꬦꬨ-ꬮꯀ-ꯢ가-힣ힰ-ퟆퟋ-ퟻ豈-舘並-龎ﬀ-ﬆﬓ-ﬗיִײַ-ﬨשׁ-זּטּ-לּמּנּסּףּפּצּ-ﮱﯓ-ﴽﵐ-ﶏﶒ-ﷇﷰ-ﷻﹰ-ﹴﹶ-ﻼＡ-Ｚａ-ｚｦ-ﾾￂ-ￇￊ-ￏￒ-ￗￚ-ￜ",hf=new RegExp("["+sf+"]"),we=new RegExp("["+sf+"ͱ-ʹ҃-֑҇-ׇֽֿׁׂׅׄؐ-ؚؠ-ىٲ-ۓۧ-ۨۻ-ۼܰ-݊ࠀ-ࠔࠛ-ࠣࠥ-ࠧࠩ-࠭ࡀ-ࡗࣤ-ࣾऀ-ःऺ-़ा-ॏ॑-ॗॢ-ॣ०-९ঁ-ঃ়া-ৄেৈৗয়-ৠਁ-ਃ਼ਾ-ੂੇੈੋ-੍ੑ੦-ੱੵઁ-ઃ઼ા-ૅે-ૉો-્ૢ-ૣ૦-૯ଁ-ଃ଼ା-ୄେୈୋ-୍ୖୗୟ-ୠ୦-୯ஂா-ூெ-ைொ-்ௗ௦-௯ఁ-ఃె-ైొ-్ౕౖౢ-ౣ౦-౯ಂಃ಼ಾ-ೄೆ-ೈೊ-್ೕೖೢ-ೣ೦-೯ംഃെ-ൈൗൢ-ൣ൦-൯ංඃ්ා-ුූෘ-ෟෲෳิ-ฺเ-ๅ๐-๙ິ-ູ່-ໍ໐-໙༘༙༠-༩༹༵༷ཁ-ཇཱ-྄྆-྇ྍ-ྗྙ-ྼ࿆က-ဩ၀-၉ၧ-ၭၱ-ၴႂ-ႍႏ-ႝ፝-፟ᜎ-ᜐᜠ-ᜰᝀ-ᝐᝲᝳក-ឲ៝០-៩᠋-᠍᠐-᠙ᤠ-ᤫᤰ-᤻ᥑ-ᥭᦰ-ᧀᧈ-ᧉ᧐-᧙ᨀ-ᨕᨠ-ᩓ᩠-᩿᩼-᪉᪐-᪙ᭆ-ᭋ᭐-᭙᭫-᭳᮰-᮹᯦-᯳ᰀ-ᰢ᱀-᱉ᱛ-ᱽ᳐-᳒ᴀ-ᶾḁ-ἕ‌‍‿⁀⁔⃐-⃥⃜⃡-⃰ⶁ-ⶖⷠ-ⷿ〡-〨゙゚Ꙁ-ꙭꙴ-꙽ꚟ꛰-꛱ꟸ-ꠀ꠆ꠋꠣ-ꠧꢀ-ꢁꢴ-꣄꣐-꣙ꣳ-ꣷ꤀-꤉ꤦ-꤭ꤰ-ꥅꦀ-ꦃ꦳-꧀ꨀ-ꨧꩀ-ꩁꩌ-ꩍ꩐-꩙ꩻꫠ-ꫩꫲ-ꫳꯀ-ꯡ꯬꯭꯰-꯹ﬠ-ﬨ︀-️︠-︦︳︴﹍-﹏０-９＿]"),br=/[\n\r\u2028\u2029]/,bt=/\r\n|[\n\r\u2028\u2029]/g;gi={kind:"loop"};kf={kind:"switch"}}),function(){typeof window=="undefined"&&(window=this);$data=window.$data||(window.$data=function n(){if(this instanceof n){var t=n.implementation.apply(this,arguments);return new t(arguments[1])}return n.implementation.apply(this,arguments)})}(this);typeof console=="undefined"&&(console={warn:function(){},error:function(){},log:function(){},dir:function(){},time:function(){},timeEnd:function(){}});console.warn||(console.warn=function(){});console.error||(console.error=function(){}),function(n){n.__namespace=!0;n.version="JayData 1.3.5";n.versionNumber="1.3.5";n.root={};n.Acorn=n.Acorn||(typeof acorn=="object"?acorn:undefined);n.Esprima=n.Esprima||(typeof esprima=="object"?esprima:undefined)}($data);Exception=function(n,t,i){Error.call(this);Error.captureStackTrace&&Error.captureStackTrace(this,this.constructor);this.name=t||"Exception";this.message=n;this.data=i};Exception.prototype.__proto__=Error.prototype;Exception.prototype._getStackTrace=function(){};Guard={};Guard.requireValue=function(n,t){(typeof t=="undefined"||t===null)&&Guard.raise(n+" requires a value other than undefined or null")};Guard.requireType=function(n,t,i){var r=i instanceof Array?i:[i];return r.some(function(i){switch(typeof i){case"string":return typeof t===i;case"function":return t instanceof i;default:Guard.raise("Unknown type format : "+typeof i+" for: "+n)}})};Guard.raise=function(n){if(typeof intellisense=="undefined"){n instanceof Exception?console.error(n.name+":",n.message+"\n",n):console.error(n);throw n;}};Object.isNullOrUndefined=function(n){return n===undefined||n===null},function(){if(Object.getOwnPropertyNames||(Object.getOwnPropertyNames=function(n){var t=[];for(var i in n)n.hasOwnProperty(i)&&t.push(i);return t}),Object.create||(Object.create=function(n){function t(){}return arguments.length>1&&Guard.raise(new Error("Object.create implementation only accepts the first parameter.")),t.prototype=n,new t}),!Object.keys){var t=Object.prototype.hasOwnProperty,i=!{toString:null}.propertyIsEnumerable("toString"),n=["toString","toLocaleString","valueOf","hasOwnProperty","isPrototypeOf","propertyIsEnumerable","constructor"],r=n.length;Object.keys=function(u){var e,o,f;(typeof u!="object"&&typeof u!="function"||u===null)&&Guard.raise(new TypeError("Object.keys called on non-object"));e=[];for(o in u)t.call(u,o)&&e.push(o);if(i)for(f=0;f<r;f++)t.call(u,n[f])&&e.push(n[f]);return e}}Object.defineProperty||(Object.defineProperty=function(n,t,i){n[t]=i.value||{}});Object.defineProperties||(Object.defineProperties=function(n,t){for(var i in t)t.hasOwnProperty(i)&&(n[i]=t[i].value||{})});Array.prototype.forEach||(Array.prototype.forEach=function(n,t){for(var i=0,r=this.length;i<r;i++)t?n.call(t,this[i],i,this):n(this[i],i,this)});Array.prototype.filter||(Array.prototype.filter=function(n,t){for(var u,r=[],i=0,f=this.length;i<f;i++)u=t?n.call(t,this[i],i,this):n(this[i],i,this),u===!0&&r.push(this[i]);return r});Array.prototype.map||(Array.prototype.map=function(n,t){for(var u,r=[],i=0,f=this.length;i<f;i++)u=t?n.call(t,this[i],i,this):n(this[i],i,this),r.push(u);return r});Array.prototype.some||(Array.prototype.some=function(n,t){for(var u,i=0,r=this.length;i<r;i++)if(u=t?n.call(t,this[i],i,this):n(this[i],i,this),u)return!0;return!1});Array.prototype.indexOf||(Array.prototype.indexOf=function(n){for(var t=0,i=this.length;t<i;t++)if(this[t]===n)return t;return-1});String.prototype.trimLeft||(String.prototype.trimLeft=function(){return this.replace(/^\s+/,"")});String.prototype.trimRight||(String.prototype.trimRight=function(){return this.replace(/\s+$/,"")});Function.prototype.bind||(Function.prototype.bind=function(n){if(typeof this!="function")throw new TypeError("Function.prototype.bind - what is trying to be bound is not callable");var r=Array.prototype.slice.call(arguments,1),u=this,t=function(){},i=function(){return u.apply(this instanceof t&&n?this:n,r.concat(Array.prototype.slice.call(arguments)))};return t.prototype=this.prototype,i.prototype=new t,i});typeof Uint8Array=="undefined"&&(Uint8Array=function(n){var t,i,r;if(n instanceof Uint8Array)return n;t=this;i=Array.isArray(n)?n:new Array(n);this.length=i.length;this.byteLength=this.length;this.byteOffset=0;this.buffer={byteLength:t.length};var u=function(n){return i[n]},f=function(n,t){i[n]=(t|0)&255},e=function(n){i[n]=i[n]||0;Object.defineProperty(t,n,{enumerable:!0,configurable:!1,get:function(){if(isNaN(+n)||(n|0)<0||(n|0)>=t.length)try{return typeof document!="undefined"&&document.createTextNode("").splitText(1),new RangeError("INDEX_SIZE_ERR")}catch(i){return i}return u(n)},set:function(i){if(isNaN(+n)||(n|0)<0||(n|0)>=t.length)try{return typeof document!="undefined"&&document.createTextNode("").splitText(1),new RangeError("INDEX_SIZE_ERR")}catch(r){return r}f(n|0,i)}})};for(r=0;r<t.length;r++)e(r)})}(),function(n,t){function i(t,i){if(this.kind=r.property,Object.defineProperty(this,"definedBy",{value:i,enumerable:!1,configurable:!1,writable:!1}),t){if(typeof t=="function"||typeof t.asFunction=="function")this.method=t,this.kind=r.method;else if(this.enumerable=!0,this.configurable=!0,typeof t=="number")this.value=t,this.type=n.Number,this.dataType=n.Number;else if(typeof t=="string")this.value=t,this.dataType=n.String,this.type=n.String;else for(var u in t)t.hasOwnProperty(u)&&(this[u]=t[u]);this.type!==undefined?this.dataType=this.dataType||this.type:this.type=this.dataType;this.originalType=this.type;this.elementType!==undefined&&(this.originalElementType=this.elementType)}}function f(){}function h(){this.classNames={}}function r(){}function e(t){function l(n,t){e[n]=e[n]||[];e[n].push(t)}var u=t,s,o,c,e,i;u&&u.addChildContainer(this);var f={},h=[],r=[];this.classNames=f;this.consolidatedClassNames=h;this.classTypes=r;s=[];this.mappedTo=s;o=this;this.holder=null;c=function(n,t){var i=o.resolveType(n),r=Object.create(i.prototype);return i.apply(r,t),r};e={};this.pendingResolutions=e;this.addChildContainer=function(){};this.createInstance=function(n,t){return c(n,t)};this.mapType=function(n,t){Guard.requireValue("aliasType",n);Guard.requireValue("realType",t);var i=this.getType(n),u=this.getType(t),f=r.indexOf(i),e=r.indexOf(u);s[f]=e};this.isPrimitiveType=function(t){var i=this.resolveType(t);switch(!0){case i===Number:case i===String:case i===Date:case i===Boolean:case i===Array:case i===Object:case i===n.Number:case i===n.Integer:case i===n.Date:case i===n.String:case i===n.Boolean:case i===n.Array:case i===n.Object:case i===n.Guid:case i===n.Byte:case i===n.SByte:case i===n.Decimal:case i===n.Float:case i===n.Int16:case i===n.Int32:case i===n.Int64:case i===n.DateTimeOffset:case i===n.Time:case i===n.SimpleBase:case i===n.Geospatial:case i===n.GeographyBase:case i===n.GeographyPoint:case i===n.GeographyLineString:case i===n.GeographyPolygon:case i===n.GeographyMultiPoint:case i===n.GeographyMultiLineString:case i===n.GeographyMultiPolygon:case i===n.GeographyCollection:case i===n.GeometryBase:case i===n.GeometryPoint:case i===n.GeometryLineString:case i===n.GeometryPolygon:case i===n.GeometryMultiPoint:case i===n.GeometryMultiLineString:case i===n.GeometryMultiPolygon:case i===n.GeometryCollection:return!0;default:return!1}};this.resolveName=function(n){var t=this.resolveType(n),i=r.indexOf(t);return h[i]};this.resolveType=function(n,t){var i=n,u;return i=this.getType(i,t?!0:!1,t),u=r.indexOf(i),typeof s[u]=="undefined"?i:r[s[u]]};this.getType=function(n,t,i){var e,o;if(Guard.requireValue("typeOrName",n),typeof n=="function")return n;if(!(n in f)){if(u&&(e=u.getType(n,!0),e))return e;if(i){l(n,i);return}if(t)return undefined;Guard.raise(new Exception("Unable to resolve type:"+n))}return o=r[f[n]],i&&i(o),o};this.getName=function(n){var i=this.getType(n),t=r.indexOf(i);return t==-1&&Guard.raise("unknown type to request name for: "+n),h[t]};this.getTypes=function(){for(var t,i=Object.keys(f),u=[],n=0;n<i.length;n++)t=i[n],u.push({name:t,type:r[f[t]],toString:function(){return this.name}});return u};this.getTypeName=function(t){switch(typeof t){case"object":if(t==null)return"$data.Object";if(t instanceof Array)return"$data.Array";if(t.getType)return t.getType().fullName;if(t instanceof Date)return"$data.Date";if(t instanceof n.Guid)return"$data.Guid";if(t instanceof n.DateTimeOffset)return"$data.DateTimeOffset";if(t instanceof n.GeographyPoint)return"$data.GeographyPoint";if(t instanceof n.GeographyLineString)return"$data.GeographyLineString";if(t instanceof n.GeographyPolygon)return"$data.GeographyPolygon";if(t instanceof n.GeographyMultiPoint)return"$data.GeographyMultiPoint";if(t instanceof n.GeographyMultiLineString)return"$data.GeographyMultiLineString";if(t instanceof n.GeographyMultiPolygon)return"$data.GeographyMultiPolygon";if(t instanceof n.GeographyCollection)return"$data.GeographyCollection";if(t instanceof n.GeographyBase)return"$data.GeographyBase";if(t instanceof n.GeometryPoint)return"$data.GeometryPoint";if(t instanceof n.GeometryLineString)return"$data.GeometryLineString";if(t instanceof n.GeometryPolygon)return"$data.GeometryPolygon";if(t instanceof n.GeometryMultiPoint)return"$data.GeometryMultiPoint";if(t instanceof n.GeometryMultiLineString)return"$data.GeometryMultiLineString";if(t instanceof n.GeometryMultiPolygon)return"$data.GeometryMultiPolygon";if(t instanceof n.GeometryCollection)return"$data.GeometryCollection";if(t instanceof n.GeometryBase)return"$data.GeometryBase";if(t instanceof n.Geospatial)return"$data.Geospatial";if(t instanceof n.SimpleBase)return"$data.SimpleBase";if(typeof t.toHexString=="function")return"$data.ObjectID";default:return typeof t}};this.isTypeRegistered=function(n){return typeof n=="function"?r.indexOf(n)>-1:n in f};this.unregisterType=function(){Guard.raise("Unimplemented")};this.getDefault=function(t){var i=this.resolveType(t);switch(i){case n.Number:return 0;case n.Float:return 0;case n.Decimal:return"0.0";case n.Integer:return 0;case n.Int16:return 0;case n.Int32:return 0;case n.Int64:return"0";case n.Byte:return 0;case n.SByte:return 0;case n.String:return null;case n.Boolean:return!1;default:return null}};this.getIndex=function(n){var t=this.resolveType(n);return r.indexOf(t)};this.resolveByIndex=function(n){return r[n]};this.registerType=function(n,t,i){var l,y,p,w,a,k,s,v,d,b;if(n){for(typeof t=="string"&&(t=o.resolveType(t)),l=[],typeof n=="string"?(y=[],y.push(n),l=y):l=n,a=0;a<l.length;a++)p=l[a].split("."),s={},s.shortName=p[p.length-1],s.fullName=l[a],l[a]=s;for(w=function(){return c(t,arguments)},typeof intellisense!="undefined"&&intellisense.annotate(w,t),a=0,k=l.length;a<k;a++)s=l[a],"create"+s.shortName in o||(o["create"+s.shortName]=typeof i=="function"?i:w),v=r.indexOf(t),v==-1&&(v=r.push(t)-1,d=s.fullName,h[v]=s.fullName),f[s.fullName]=v,b=e[s.fullName]||[],b.length>0&&(b.forEach(function(n){n(t)}),e[s.fullName]=[]);u&&u.registerType.apply(u,arguments);t.name||(t.name=l[0].shortName)}};i={from:{},to:{}};this.converters=i;this.convertTo=function(t,r,u,f){var c;if(Guard.requireValue("typeOrName",r),Object.isNullOrUndefined(t))return t;var s=Container.getTypeName(t),l=Container.resolveType(s),s=Container.resolveName(l),h=Container.resolveType(r),e=Container.resolveName(h),o;try{if(typeof h["from"+s]=="function")o=h["from"+s].apply(h,arguments);else if(typeof l["to"+e]=="function")o=l["to"+e].apply(l,arguments);else if(i.to[e]&&i.to[e][s])o=i.to[e][s].apply(i,arguments);else if(i.from[s]&&i.from[s][e])o=i.from[s][e].apply(i,arguments);else if(e===s||t instanceof h)o=t;else if(i.to[e]&&i.to[e]["default"])o=i.to[e]["default"].apply(i,arguments);else throw"converter not found";}catch(a){Guard.raise(new Exception("Value '"+s+"' not convertable to '"+e+"'","TypeError",t))}if(h===n.Array&&u&&Array.isArray(o))for(c=0;c<o.length;c++)o[c]=this.convertTo.call(this,o[c],u,undefined,f);return o};this.registerConverter=function(t,r,u,f){var e=Container.resolveName(t),o;Container.isTypeRegistered(r)?(i.to[e]=i.to[e]||{},i.from[e]=i.from[e]||{},o=Container.resolveName(r),u&&(i.to[e][o]=u),f&&(i.from[e][o]=f)):(i.to[e]=i.to[e]?n.typeSystem.extend(i.to[e],r):r,i.from[e]=i.from[e]?n.typeSystem.extend(i.from[e],u):u)}}var u,c,o,s;i.prototype.createPropertyDescriptor=function(n,t){var r=this,i={enumerable:this.enumerable==undefined?!0:this.enumerable,configurable:this.configurable==undefined?!0:this.configurable};return this.set&&this.get?(i.set=this.set,i.get=this.get):"value"in this||t?(i.value=t||this.value,i.writable=!0):(i.set=function(n){this.storeProperty(r,n)},i.get=function(){return this.retrieveProperty(r)}),i};i.prototype.createStorePropertyDescriptor=function(n){var t=this;return{enumerable:!1,writable:!0,configurable:t.configurable,value:n}};i.prototype.createGetMethod=function(){var n=this;return{enumerable:!1,writable:!1,configurable:!1,value:function(t,i){return this.getProperty(n,t,i)}}};i.prototype.createSetMethod=function(){var n=this;return{enumerable:!1,writable:!1,configurable:!1,value:function(t,i,r){return this.setProperty(n,t,i,r)}}};i.translateDefinition=function(t,r,u){function h(t){t&&t.isAssignableTo&&n.Entity&&t.isAssignableTo(n.Entity)&&u.childResolverThunks.push(function(){t.resolveForwardDeclarations&&t.resolveForwardDeclarations()})}var s=u,f,e,o;return t.type&&Container.isTypeRegistered(t.type)&&(s=Container.resolveType(t.type),typeof s.translateDefinition=="function"?(f=s.translateDefinition.apply(s,arguments),f.name=f.name||r):s=u),f instanceof i||(f=new i(f||t,s),f.name=r),u.resolverThunks=u.resolverThunks||[],u.childResolverThunks=u.childResolverThunks||[],e=f.type,o=f.elementType,h(e),h(o),"string"==typeof e&&("@"===e[0]?(f.type=e.substr(1),f.dataType=e.substr(1)):u.resolverThunks.push(function(){var n=u.container.resolveType(e);h(n);f.type=n;f.dataType=n})),o&&"string"==typeof o&&("@"===o[0]?f.elementType=o.substr(1):u.resolverThunks.push(function(){var n=u.container.resolveType(o);h(n);f.elementType=n})),u.resolveForwardDeclarations=function(){u.resolveForwardDeclarations=function(){};n.Trace.log("resolving: "+u.fullName);this.resolverThunks.forEach(function(n){n()});this.childResolverThunks.forEach(function(n){n()})},f};i.prototype.toJSON=function(){var t={};for(var n in this)if(n!=="defineBy"&&n!=="storageModel")if((n==="type"||n==="dataType")&&this[n]&&typeof this[n]=="function")try{t[n]=Container.resolveName(this[n])}catch(i){t[n]=this[n]}else t[n]=this[n];return t};n.MemberDefinition=window.MemberDefinition=i;u="$";f.prototype={clearCache:function(){this.arrayCache=undefined;this.pubMapPropsCache=undefined;this.keyPropsCache=undefined;this.propByTypeCache=undefined;this.pubMapMethodsCache=undefined;this.pubMapPropNamesCache=undefined},asArray:function(){if(!this.arrayCache){this.arrayCache=[];for(var n in this)n.indexOf(u)===0&&this.arrayCache.push(this[n])}return this.arrayCache},getPublicMappedProperties:function(){if(!this.pubMapPropsCache){this.pubMapPropsCache=[];for(var n in this)n.indexOf(u)===0&&this[n].kind=="property"&&!this[n].notMapped&&this[n].enumerable&&this.pubMapPropsCache.push(this[n])}return this.pubMapPropsCache},getPublicMappedPropertyNames:function(){if(!this.pubMapPropNamesCache){this.pubMapPropNamesCache=[];for(var n in this)n.indexOf(u)===0&&this[n].kind=="property"&&!this[n].notMapped&&this[n].enumerable&&this.pubMapPropNamesCache.push(this[n].name)}return this.pubMapPropNamesCache},getKeyProperties:function(){if(!this.keyPropsCache){this.keyPropsCache=[];for(var n in this)n.indexOf(u)===0&&this[n].kind=="property"&&this[n].key&&this.keyPropsCache.push(this[n])}return this.keyPropsCache},getPublicMappedMethods:function(){if(!this.pubMapMethodsCache){this.pubMapMethodsCache=[];for(var n in this)n.indexOf(u)===0&&this[n].kind=="method"&&this[n].method&&this.pubMapMethodsCache.push(this[n])}return this.pubMapMethodsCache},getPropertyByType:function(n){if(!this.propByTypeCache){this.propByTypeCache=[];for(var t in this)t.indexOf(u)===0&&this[t].dataType==n&&this.propByTypeCache.push(this[t])}return this.propByTypeCache},getMember:function(n){return this[u+n]},setMember:function(n){this[u+n.name]=n}};f.prototype.constructor=f;n.MemberDefinitionCollection=window.MemberDefinitionCollection=f;r.__enum=!0;r.method="method";r.property="property";r.navProperty="navProperty";r.complexProperty="complexProperty";r.field="field";n.MemberTypes=r;h.prototype={define:function(n,t,i,r,u){return this.defineEx(n,[{type:t}],i,r,u)},defineEx:function(t,i,r,u,f){var y,c,a,e,p,o,v;for(r=r||n.Container,i.length==0?i.push({type:n.Base}):i.length>0&&!i[0].type&&(i[0].type=n.Base),o=0,y=i.length;o<y;o++)typeof i[o]=="function"&&(i[o]={type:i[o]});var w=u?u.constructor:undefined,s=t.split("."),l=s.splice(s.length-1,1)[0],h=r===n.Container?window:r;for(o=0;o<s.length;o++)c=s[o],h[c]||(a={},a.__namespace=!0,h[c]=a),h=h[c];for(e=null,e=this.classFunctionBuilder(l,i,f,u),e.fullName=t,e.namespace=s.join("."),e.name=l,e.container=r,e.container.registerType(t,e),this.buildType(e,i,u,f),typeof intellisense!="undefined"&&u&&u.constructor&&intellisense.annotate(e,u.constructor),h[l]=this.classNames[t]=e,p=e.baseTypes.length,o=0;o<p;o++)v=e.baseTypes[o],"inheritedTypeProcessor"in v&&v.inheritedTypeProcessor(e);return e},classFunctionBuilder:function(n,t,i,r){var u=this.bodyBuilder(t,i,r);return new Function("base","classDefinition","instanceDefinition","name","return function "+n+" (){ "+u+" \n}; ")(t,i,r,n)},bodyBuilder:function(t,i,r){for(var u,s,h="",f="",e="",o=0,c=t.length;o<c;o++)u=t[o],s=o,s==0?u&&u.type&&u.type!==n.Base&&u.type.fullName&&(f+="    var baseArguments = $data.typeSystem.createCtorParams(arguments, base["+s+"].params, this); \n",f+="    "+u.type.fullName+".apply(this, baseArguments); \n"):u&&u.type&&u.propagateTo?(e+="    "+(e?"":"var ")+"propagationArguments = $data.typeSystem.createCtorParams(arguments, base["+s+"].params, this); \n",e+='    this["'+u.propagateTo+'"] =  Object.create('+u.type.fullName+".prototype); \n    "+u.type.fullName+'.apply(this["'+u.propagateTo+'"], propagationArguments); \n'):u&&u.type&&u.type.memberDefinitions&&u.type.memberDefinitions.$constructor&&!u.propagateTo&&(h+="    "+u.type.fullName+".memberDefinitions.$constructor.method.apply(this); \n");return r&&r.constructor!=Object&&(f+="    instanceDefinition.constructor.apply(this, arguments); \n"),"\n    //mixins \n"+h+"\n    //construction \n"+f+"\n    //propagations \n"+e},buildType:function(n,t,i,r){var e=t[0].type,o,u,s;if(n.inheritsFrom=e,e){if(n.prototype=Object.create(e.prototype),n.memberDefinitions=Object.create(e.memberDefinitions||new f),n.memberDefinitions.clearCache(),o=e.staticDefinitions,o&&(o=o.asArray(),o))for(u=0;u<o.length;u++)this.buildMember(n,o[u],undefined,"staticDefinitions");for(n.baseTypes=e.baseTypes?[].concat(e.baseTypes):[],u=0;u<t.length;u++)n.baseTypes.push(t[u].type);n.isAssignableTo||Object.defineProperty(n,"isAssignableTo",{value:function(n){return this===n||this.baseTypes.indexOf(n)>=0},writable:!1,enumerable:!1,configurable:!1})}r&&(this.buildStaticMembers(n,r),r.constructor&&(n.classConstructor=r.constructor));i&&this.buildInstanceMembers(n,i);s=[].concat(t);s.shift();Object.keys(s).length>0&&this.buildInstanceMixins(n,s);n.__class=!0;n.prototype.constructor=n;Object.defineProperty(n.prototype,"getType",{value:function(){return n},writable:!1,enumerable:!1,configurable:!1})},addMethod:function(n,t,i,r){n[t]=r&&typeof intellisense=="undefined"?function(){return i.apply(this[r],arguments)}:i},addProperty:function(n,t,i,r){var u,f;r&&(i.configurable=!0,i.get&&(u=i.get,i.get=function(){return this[r]||Guard.raise(new Exception("not inicialized")),u.apply(this[r],arguments)}),i.set&&(f=i.set,i.set=function(){this[r]||Guard.raise(new Exception("not inicialized"));f.apply(this[r],arguments)}));Object.defineProperty(n,t,i)},addField:function(){Guard.raise("not implemented")},buildMethod:function(n,t,i){var r=t.classMember?n:n.prototype;this.addMethod(r,t.name,t.method,i)},buildProperty:function(n,t,i){var r=t.classMember?n:n.prototype,e=t.createPropertyDescriptor(n),u,f;this.addProperty(r,t.name,e,i);t.classMember||n.__setPropertyfunctions!=!0||t.withoutGetSetMethod===!0||"get_"+t.name in r||"set_"+t.name in r||(u=t.createGetMethod(),this.addProperty(r,"get_"+t.name,u,i),f=t.createSetMethod(),this.addProperty(r,"set_"+t.name,f,i))},buildMember:function(n,t,i,u){u=u||"memberDefinitions";n[u]=n[u]||new f;n[u].setMember(t);switch(t.kind){case r.method:this.buildMethod(n,t,i);break;case r.navProperty:case r.complexProperty:case r.property:this.buildProperty(n,t,i);break;default:Guard.raise("Unknown member type: "+t.kind+","+t.name)}},buildStaticMembers:function(n,t){var f=this,r,u;for(r in t)t.hasOwnProperty(r)&&(u=i.translateDefinition(t[r],r,n),u.classMember=!0,f.buildMember(n,u,undefined,"staticDefinitions"))},buildInstanceMembers:function(n,t){var f=this,r,u;for(r in t)t.hasOwnProperty(r)&&(u=i.translateDefinition(t[r],r,n),f.buildMember(n,u,undefined,"memberDefinitions"))},copyMembers:function(n,t){function i(n){typeof intellisense!="undefined"&&intellisense.logMessage(n)}Object.keys(n.prototype).forEach(function(r){r!=="constructor"&&r!=="toString"&&(i("copying item:"+r),t.prototype[r]=n[r])})},buildInstanceMixins:function(n,t){var r,i;for(n.mixins=n.mixins||[],n.propagations=n.propagations||[],r=0;r<t.length;r++)i=t[r],i.propagateTo?(this.buildInstancePropagation(n,i),n.propagations.push(i),n.propagations[i.type.name]=!0):(this.buildInstanceMixin(n,i),n.mixins.push(i),n.mixins[i.type.name]=!0)},buildInstanceMixin:function(n,t){for(var u,r,f=t.type.memberDefinitions.asArray(),i=0,e=f.length;i<e;i++)r=f[i].name,r==="constructor"||n.memberDefinitions.getMember(r)||this.buildMember(n,f[i]);if(t.type.staticDefinitions)for(u=t.type.staticDefinitions.asArray(),i=0,e=u.length;i<e;i++)r=u[i].name,r==="constructor"||n.memberDefinitions.getMember(r)||this.buildMember(n,u[i],undefined,"staticDefinitions")},buildInstancePropagation:function(n,t){for(var u,r=t.type.memberDefinitions.asArray(),i=0,f=r.length;i<f;i++)u=r[i].name,u==="constructor"||n.memberDefinitions.getMember(u)||this.buildMember(n,r[i],t.propagateTo)}};n.Class=Class=new h;t=window;n.ContainerClass=e;t.Container=n.Container=c=t.C$=new e;n.createContainer=function(){return new e(n.Container)};t.$C=function(){Class.define.apply(Class,arguments)};o=function(n,t){var i="_"+n.name;this[i]?this[i]=t:Object.defineProperty(this,i,n.createStorePropertyDescriptor(t))};s=function(n){var t="_"+n.name;return this[t]};n.Class.define("$data.Base",function(){},null,{storeProperty:o,retrieveProperty:s,setProperty:function(n,t,i){this[n.name]=t;i()},getProperty:function(n,t){t.apply(this,[this[n.name]])}},{create:function(){return Container.createInstance(this,arguments)},extend:function(t,i,r,u){return!i||i instanceof e||(u=r,r=i,i=undefined),n.Class.define(t,this,i,r,u)},getMemberDefinition:function(n){return this.memberDefinitions.getMember(n)},addProperty:function(t,r,u,f){var e=r,o=u,s,h,c;return typeof e=="string"&&(s=r,e=u,o=f),h={notMapped:!0,storeOnObject:!0,get:typeof e=="function"?e:function(){},set:typeof o=="function"?o:function(){},type:s},c=i.translateDefinition(h,t,this),n.Class.buildMember(this,c),this.memberDefinitions.clearCache(),this},addMember:function(t,r,u){var f=i.translateDefinition(r,t,this);return u?(f.classMember=!0,n.Class.buildMember(this,f,undefined,"staticDefinitions"),this.staticDefinitions.clearCache()):(n.Class.buildMember(this,f),this.memberDefinitions.clearCache()),this},describeField:function(n,t){var i=this.memberDefinitions.getMember(n);return i?Guard.raise(new Exception("Field '"+n+"' already defined!","Invalid operation")):this.addMember(n,t),this},storeProperty:o,retrieveProperty:s,"from$data.Object":function(n){return n}});n.Class.ConstructorParameter=ConstructorParameter=n.Class.define("ConstructorParameter",null,null,{constructor:function(n){this.paramIndex=n},paramIndex:{}})}($data,window);$data.defaultErrorCallback=function(){arguments.length>0&&arguments[arguments.length-1]&&typeof arguments[arguments.length-1].reject=="function"?((console.error||console.log).call(console,arguments[0]),arguments[arguments.length-1].reject.apply(arguments[arguments.length-1],arguments)):arguments[0]instanceof Error?Guard.raise(arguments[0]):Guard.raise(new Exception("DEFAULT ERROR CALLBACK!","DefaultError",arguments))};$data.defaultSuccessCallback=function(){};$data.defaultNotifyCallback=function(){};$data.typeSystem={__namespace:!0,extend:function(n){var i,t;for(typeof n!="object"&&typeof n!="function"&&Guard.raise("Target must be object or function"),i=1;i<arguments.length;i++)if(t=arguments[i],t!==null&&typeof t!="undefined")for(key in t)n[key]=t[key];return n},createCallbackSetting:function(n,t){function u(n){function i(){n.apply(t,arguments);n=function(){}}var t=this;return i}var r={success:$data.defaultSuccessCallback,error:$data.defaultErrorCallback,notify:$data.defaultNotifyCallback},i;return t!=undefined&&t!=null&&(r=t),i=n==null||n==undefined?r:typeof n=="function"?this.extend(r,{success:n}):this.extend(r,n),typeof i.error=="function"&&(i.error=u(i.error)),i},createCtorParams:function(n,t,i){var u,f,e,r;if(t){for(u=[],f=0,e=t.length;f<e;f++)r=f,t[r]instanceof ConstructorParameter?u.push(n[t[r].paramIndex]):typeof t[r]=="function"?u.push(t[r].apply(i)):u.push(t[r]);return u}return n},writePropertyValues:function(n){n&&n.getType&&n.getType().memberDefinitions&&this.writeProperties(n,n.getType().memberDefinitions.asArray().filter(function(n){return(n.kind=="property"||n.kind=="navProperty"||n.kind=="complexProperty")&&!n.prototypeProperty}))},writeProperties:function(n,t){for(var i,u={},r=0,f=t.length;r<f;r++)i=t[r],u[i.name]=i.createPropertyDescriptor(null,i.value);Object.defineProperties(n,u)},writeProperty:function(n,t,i){var r=typeof t=="string"?n.getType().memberDefinitions.getMember(t):t,u;r&&(u=r.createPropertyDescriptor(null,i),Object.defineProperty(n,r.name,u))}};$data.debug=function(){(console.debug||console.log).apply(console,arguments)};$data.debugWith=function(){var n=arguments;return function(t){(console.debug||console.log).apply(console,n);typeof Error!="undefined"&&t instanceof Error||typeof Exception!="undefined"&&t instanceof Exception?(console.error||console.log).apply(console,arguments):(console.debug||console.log).apply(console,arguments)}};$data.fdebug={success:$data.debugWith("success"),error:$data.debugWith("error")};$data.Number=typeof Number!="undefined"?Number:function(){};$data.Date=typeof Date!="undefined"?Date:function(){};$data.String=typeof String!="undefined"?String:function(){};$data.Boolean=typeof Boolean!="undefined"?Boolean:function(){};$data.Array=typeof Array!="undefined"?Array:function(){};$data.Object=typeof Object!="undefined"?Object:function(){};$data.Function=Function;$data.Byte=function(){};$data.SByte=function(){};$data.Decimal=function(){};$data.Float=$data.Single=function(){};$data.Integer=function(){};$data.Int16=function(){};$data.Int32=function(){};$data.Int64=function(){};$data.ObjectID=typeof $data.mongoDBDriver!="undefined"&&typeof $data.mongoDBDriver.ObjectID!="undefined"?$data.mongoDBDriver.ObjectID:function(){};$data.Time=function(){};$data.DateTimeOffset=function(n){this.value=n};$data.DateTimeOffset.prototype.toJSON=function(){return this.value instanceof Date?this.value.toISOString():this.value};$data.Container.registerType(["$data.Number","number","JayNumber","double"],$data.Number);$data.Container.registerType(["$data.Integer","int","integer","JayInteger"],$data.Integer);$data.Container.registerType(["$data.Int32","int32","JayInt32"],$data.Int32);$data.Container.registerType(["$data.Byte","byte","JayByte"],$data.Byte);$data.Container.registerType(["$data.SByte","sbyte","JaySByte"],$data.SByte);$data.Container.registerType(["$data.Decimal","decimal","JayDecimal"],$data.Decimal);$data.Container.registerType(["$data.Float","$data.Single","float","single","JayFloat"],$data.Float);$data.Container.registerType(["$data.Int16","int16","word","JayInt16"],$data.Int16);$data.Container.registerType(["$data.Int64","int64","long","JayInt64"],$data.Int64);$data.Container.registerType(["$data.String","string","text","character","JayString"],$data.String);$data.Container.registerType(["$data.Array","array","Array","[]","JayArray"],$data.Array,function(){return $data.Array.apply(undefined,arguments)});$data.Container.registerType(["$data.Date","datetime","date","JayDate"],$data.Date);$data.Container.registerType(["$data.Time","time","JayTime"],$data.Time);$data.Container.registerType(["$data.DateTimeOffset","offset","datetimeoffset","JayDateTimeOffset"],$data.DateTimeOffset);$data.Container.registerType(["$data.Boolean","bool","boolean","JayBoolean"],$data.Boolean);$data.Container.registerType(["$data.Object","Object","object","{}","JayObject"],$data.Object);$data.Container.registerType(["$data.Function","Function","function"],$data.Function);$data.Container.registerType(["$data.ObjectID","ObjectID","objectId","objectid","ID","Id","id","JayObjectID"],$data.ObjectID);$data.Class.define("$data.TraceBase",null,null,{log:function(){},warn:function(){},error:function(){}});$data.Trace=new $data.TraceBase;$data.Class.define("$data.Logger",$data.TraceBase,null,{log:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.log.apply(console,arguments)},warn:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.warn.apply(console,arguments)},error:function(){Array.prototype.unshift.call(arguments,this.getDateFormat());console.error.apply(console,arguments)},getDateFormat:function(){var n=new Date;return n.getHours()+":"+n.getMinutes()+":"+n.getSeconds()+"."+n.getMilliseconds()}});$data.Number=typeof Number!="undefined"?Number:function(){};$data.Date=typeof Date!="undefined"?Date:function(){};$data.String=typeof String!="undefined"?String:function(){};$data.Boolean=typeof Boolean!="undefined"?Boolean:function(){};$data.Array=typeof Array!="undefined"?Array:function(){};$data.Object=typeof Object!="undefined"?Object:function(){};$data.Function=Function;$data.Byte=function(){};$data.SByte=function(){};$data.Decimal=function(){};$data.Float=$data.Single=function(){};$data.Integer=function(){};$data.Int16=function(){};$data.Int32=function(){};$data.Int64=function(){};$data.ObjectID=typeof $data.mongoDBDriver!="undefined"&&typeof $data.mongoDBDriver.ObjectID!="undefined"?$data.mongoDBDriver.ObjectID:function(){};$data.Time=function(){};$data.DateTimeOffset=function(n){this.value=n};$data.DateTimeOffset.prototype.toJSON=function(){return this.value instanceof Date?this.value.toISOString():this.value};$data.Container.registerType(["$data.Number","number","JayNumber","double"],$data.Number);$data.Container.registerType(["$data.Integer","int","integer","JayInteger"],$data.Integer);$data.Container.registerType(["$data.Int32","int32","JayInt32"],$data.Int32);$data.Container.registerType(["$data.Byte","byte","JayByte"],$data.Byte);$data.Container.registerType(["$data.SByte","sbyte","JaySByte"],$data.SByte);$data.Container.registerType(["$data.Decimal","decimal","JayDecimal"],$data.Decimal);$data.Container.registerType(["$data.Float","$data.Single","float","single","JayFloat"],$data.Float);$data.Container.registerType(["$data.Int16","int16","word","JayInt16"],$data.Int16);$data.Container.registerType(["$data.Int64","int64","long","JayInt64"],$data.Int64);$data.Container.registerType(["$data.String","string","text","character","JayString"],$data.String);$data.Container.registerType(["$data.Array","array","Array","[]","JayArray"],$data.Array,function(){return $data.Array.apply(undefined,arguments)});$data.Container.registerType(["$data.Date","datetime","date","JayDate"],$data.Date);$data.Container.registerType(["$data.Time","time","JayTime"],$data.Time);$data.Container.registerType(["$data.DateTimeOffset","offset","datetimeoffset","JayDateTimeOffset"],$data.DateTimeOffset);$data.Container.registerType(["$data.Boolean","bool","boolean","JayBoolean"],$data.Boolean);$data.Container.registerType(["$data.Object","Object","object","{}","JayObject"],$data.Object);$data.Container.registerType(["$data.Function","Function","function"],$data.Function);$data.Container.registerType(["$data.ObjectID","ObjectID","objectId","objectid","ID","Id","id","JayObjectID"],$data.ObjectID);$data.SimpleBase=function(n){var t,i;if(typeof n=="object"&&n)if(Array.isArray(this.constructor.validMembers))for(t=0;t<this.constructor.validMembers.length;t++)i=this.constructor.validMembers[t],n[i]!==undefined&&(this[i]=n[i]);else delete n.type,$data.typeSystem.extend(this,n)};$data.SimpleBase.registerType=function(n,t,i){i=i||$data.SimpleBase;t.type=n;t.prototype=Object.create(i.prototype);t.prototype.constructor=t};$data.Container.registerType(["$data.SimpleBase","SimpleBase"],$data.SimpleBase);$data.Geospatial=function(){var n,t;if(this.type=this.constructor.type,Array.isArray(this.constructor.validMembers))for(n=0;n<this.constructor.validMembers.length;n++)t=this.constructor.validMembers[n],this[t]=undefined;$data.SimpleBase.apply(this,arguments);this.type=this.constructor.type||"Unknown"};$data.SimpleBase.registerType("Geospatial",$data.Geospatial);$data.Container.registerType(["$data.Geospatial","Geospatial"],$data.Geospatial);$data.point=function(n){if(n&&n.crs)return n.crs.properties&&n.crs.properties.name===$data.GeometryBase.defaultCrs.properties.name?new $data.GeometryPoint(n):new $data.GeographyPoint(n);if(n){if("x"in n&&"y"in n)return new $data.GeometryPoint(n.x,n.y);if("longitude"in n&&"latitude"in n)return new $data.GeographyPoint(n.longitude,n.latitude);if("lng"in n&&"lat"in n)return new $data.GeographyPoint(n.lng,n.lat)}};$data.GeographyBase=function(){$data.Geospatial.apply(this,arguments);this.crs=$data.GeographyBase.defaultCrs;$data.GeographyBase.validateGeoJSON(this)};$data.GeographyBase.defaultCrs={properties:{name:"EPSG:4326"},type:"name"};$data.GeographyBase.parseFromString=function(n){var i=n.indexOf("("),r,t;if(i>=0){if(r=n.substring(0,i).toLowerCase(),t=$data.GeographyBase.registered[r],t&&t.parseFromString&&t!=$data.GeographyBase)return t.parseFromString(n);Guard.raise(new Exception("parseFromString","Not Implemented",n))}};$data.GeographyBase.stringifyToUrl=function(n){if(n instanceof $data.GeographyBase&&n.constructor&&n.constructor.stringifyToUrl)return n.constructor.stringifyToUrl(n);if(n instanceof $data.GeographyBase&&n.constructor&&Array.isArray(n.constructor.validMembers)&&n.constructor.validMembers[0]==="coordinates"){var t="geography'"+n.type.toUpperCase()+"(";function i(n){if(Array.isArray(n[0]))for(var r=0;r<n.length;r++)r>0&&(t+=","),Array.isArray(n[r][0])&&(t+="("),i(n[r]),Array.isArray(n[r][0])&&(t+=")");else t+=n.join(" ")}return i(n.coordinates,t),t+=")'"}Guard.raise(new Exception("stringifyToUrl on instance type","Not Implemented",n))};$data.GeographyBase.registerType=function(n,t,i){$data.SimpleBase.registerType(n,t,i||$data.GeographyBase);$data.GeographyBase.registered=$data.GeographyBase.registered||{};$data.GeographyBase.registered[n.toLowerCase()]=t};$data.GeographyBase.validateGeoJSON=function(n){var t=n.type,i,r;if(t&&(i=$data.GeographyBase.registered[t.toLowerCase()],typeof i.validateGeoJSON=="function")){if(r=i.validateGeoJSON(n),r)return r;Guard.raise(new Exception("Invalid '"+t+"' format!","Format Exception",n))}console.log("GeoJSON validation missing",n);return};$data.SimpleBase.registerType("GeographyBase",$data.GeographyBase,$data.Geospatial);$data.Container.registerType(["$data.GeographyBase"],$data.GeographyBase);$data.GeographyPoint=function(n,t){n&&typeof n=="object"&&Array.isArray(n)?$data.GeographyBase.call(this,{coordinates:n}):n&&typeof n=="object"&&("longitude"in n||"latitude"in n)?$data.GeographyBase.call(this,{coordinates:[n.longitude,n.latitude]}):n&&typeof n=="object"&&("lng"in n||"lat"in n)?$data.GeographyBase.call(this,{coordinates:[n.lng,n.lat]}):n&&typeof n=="object"?$data.GeographyBase.call(this,n):$data.GeographyBase.call(this,{coordinates:[n||0,t||0]})};$data.GeographyPoint.validateGeoJSON=function(n){return n&&Array.isArray(n.coordinates)&&n.coordinates.length==2&&typeof n.coordinates[0]=="number"&&typeof n.coordinates[1]=="number"};$data.GeographyPoint.parseFromString=function(n){var i=n.substring(n.indexOf("(")+1,n.lastIndexOf(")")),t=i.split(" ");return new $data.GeographyPoint(parseFloat(t[0]),parseFloat(t[1]))};$data.GeographyPoint.validMembers=["coordinates"];$data.GeographyBase.registerType("Point",$data.GeographyPoint);Object.defineProperty($data.GeographyPoint.prototype,"longitude",{get:function(){return this.coordinates[0]},set:function(n){this.coordinates[0]=n}});Object.defineProperty($data.GeographyPoint.prototype,"latitude",{get:function(){return this.coordinates[1]},set:function(n){this.coordinates[1]=n}});$data.Container.registerType(["$data.GeographyPoint","GeographyPoint","$data.Geography","Geography","geography","geo"],$data.GeographyPoint);$data.Geography=$data.GeographyPoint;$data.GeographyLineString=function(n){Array.isArray(n)?$data.GeographyBase.call(this,{coordinates:n}):$data.GeographyBase.call(this,n)};$data.GeographyLineString.validateGeoJSON=function(n){for(var t,i=n&&Array.isArray(n.coordinates),r=0;i&&r<n.coordinates.length;r++)t=n.coordinates[r],i=i&&Array.isArray(t)&&t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number";return i};$data.GeographyLineString.validMembers=["coordinates"];$data.GeographyBase.registerType("LineString",$data.GeographyLineString);$data.Container.registerType(["$data.GeographyLineString","GeographyLineString"],$data.GeographyLineString);$data.GeographyPolygon=function(n){var i,r,u,f,t;typeof n=="object"&&("topLeft"in n&&"bottomRight"in n||"topRight"in n&&"bottomLeft"in n)?("topLeft"in n&&"bottomRight"in n?(i=n.topLeft instanceof $data.GeographyPoint?n.topLeft:new $data.GeographyPoint(n.topLeft),f=n.bottomRight instanceof $data.GeographyPoint?n.bottomRight:new $data.GeographyPoint(n.bottomRight),r=new $data.GeographyPoint([f.coordinates[0],i.coordinates[1]]),u=new $data.GeographyPoint([i.coordinates[0],f.coordinates[1]])):(r=n.topRight instanceof $data.GeographyPoint?n.topRight:new $data.GeographyPoint(n.topRight),u=n.bottomLeft instanceof $data.GeographyPoint?n.bottomLeft:new $data.GeographyPoint(n.bottomLeft),i=new $data.GeographyPoint([u.coordinates[0],r.coordinates[1]]),f=new $data.GeographyPoint([r.coordinates[0],u.coordinates[1]])),t=[],t.push([].concat(i.coordinates)),t.push([].concat(r.coordinates)),t.push([].concat(f.coordinates)),t.push([].concat(u.coordinates)),t.push([].concat(i.coordinates)),$data.GeographyBase.call(this,{coordinates:[t]})):Array.isArray(n)?$data.GeographyBase.call(this,{coordinates:n}):$data.GeographyBase.call(this,n)};$data.GeographyPolygon.validateGeoJSON=function(n){for(var r,u,i,t=n&&Array.isArray(n.coordinates),f=0;t&&f<n.coordinates.length;f++)for(r=n.coordinates[f],t=t&&Array.isArray(r),u=0;t&&u<r.length;u++)i=r[u],t=t&&Array.isArray(i)&&i.length==2&&typeof i[0]=="number"&&typeof i[1]=="number";return t};$data.GeographyPolygon.parseFromString=function(n){for(var u,f,i,e,t=n.substring(n.indexOf("(")+1,n.lastIndexOf(")")),o=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split("),("),t=[],r=0;r<o.length;r++){for(u=[],f=o[r].split(","),i=0;i<f.length;i++)e=f[i].split(" "),u.push([parseFloat(e[0]),parseFloat(e[1])]);t.push(u)}return new $data.GeographyPolygon(t)};$data.GeographyPolygon.validMembers=["coordinates"];$data.GeographyBase.registerType("Polygon",$data.GeographyPolygon);$data.Container.registerType(["$data.GeographyPolygon","GeographyPolygon"],$data.GeographyPolygon);$data.GeographyMultiPoint=function(n){Array.isArray(n)?$data.GeographyBase.call(this,{coordinates:n}):$data.GeographyBase.call(this,n)};$data.GeographyMultiPoint.validateGeoJSON=function(n){for(var t,i=n&&Array.isArray(n.coordinates),r=0;i&&r<n.coordinates.length;r++)t=n.coordinates[r],i=i&&Array.isArray(t)&&t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number";return i};$data.GeographyMultiPoint.validMembers=["coordinates"];$data.GeographyBase.registerType("MultiPoint",$data.GeographyMultiPoint);$data.Container.registerType(["$data.GeographyMultiPoint","GeographyMultiPoint"],$data.GeographyMultiPoint);$data.GeographyMultiLineString=function(n){Array.isArray(n)?$data.GeographyBase.call(this,{coordinates:n}):$data.GeographyBase.call(this,n)};$data.GeographyMultiLineString.validateGeoJSON=function(n){for(var r,u,i,t=n&&Array.isArray(n.coordinates),f=0;t&&f<n.coordinates.length;f++)for(r=n.coordinates[f],t=t&&Array.isArray(r),u=0;t&&u<r.length;u++)i=r[u],t=t&&Array.isArray(i)&&i.length==2&&typeof i[0]=="number"&&typeof i[1]=="number";return t};$data.GeographyMultiLineString.validMembers=["coordinates"];$data.GeographyBase.registerType("MultiLineString",$data.GeographyMultiLineString);$data.Container.registerType(["$data.GeographyMultiLineString","GeographyMultiLineString"],$data.GeographyMultiLineString);$data.GeographyMultiPolygon=function(n){Array.isArray(n)?$data.GeographyBase.call(this,{coordinates:n}):$data.GeographyBase.call(this,n)};$data.GeographyMultiPolygon.validateGeoJSON=function(n){for(var r,u,f,e,i,t=n&&Array.isArray(n.coordinates),o=0;t&&o<n.coordinates.length;o++)for(r=n.coordinates[o],t=t&&Array.isArray(r),u=0;t&&u<r.length;u++)for(f=r[u],t=t&&Array.isArray(f),e=0;t&&e<f.length;e++)i=f[e],t=t&&Array.isArray(i)&&i.length==2&&typeof i[0]=="number"&&typeof i[1]=="number";return t};$data.GeographyMultiPolygon.validMembers=["coordinates"];$data.GeographyBase.registerType("MultiPolygon",$data.GeographyMultiPolygon);$data.Container.registerType(["$data.GeographyMultiPolygon","GeographyMultiPolygon"],$data.GeographyMultiPolygon);$data.GeographyCollection=function(n){Array.isArray(n)?$data.GeographyBase.call(this,{geometries:n}):$data.GeographyBase.call(this,n)};$data.GeographyCollection.validateGeoJSON=function(n){for(var r,t=n&&Array.isArray(n.geometries),i=0;t&&i<n.geometries.length;i++){r=n.geometries[i];try{t=t&&$data.GeographyBase.validateGeoJSON(r)}catch(u){t=!1}}return t};$data.GeographyCollection.validMembers=["geometries"];$data.GeographyBase.registerType("GeometryCollection",$data.GeographyCollection);$data.Container.registerType(["$data.GeographyCollection","GeographyCollection"],$data.GeographyCollection);$data.Container.registerConverter($data.GeographyPoint,$data.Object,function(n){return n?new $data.GeographyPoint(n):n});$data.Container.registerConverter($data.GeographyLineString,$data.Object,function(n){return n?new $data.GeographyLineString(n):n});$data.Container.registerConverter($data.GeographyPolygon,$data.Object,function(n){return n?new $data.GeographyPolygon(n):n});$data.Container.registerConverter($data.GeographyMultiPoint,$data.Object,function(n){return n?new $data.GeographyMultiPoint(n):n});$data.Container.registerConverter($data.GeographyMultiLineString,$data.Object,function(n){return n?new $data.GeographyMultiLineString(n):n});$data.Container.registerConverter($data.GeographyMultiPolygon,$data.Object,function(n){return n?new $data.GeographyMultiPolygon(n):n});$data.Container.registerConverter($data.GeographyCollection,$data.Object,function(n){return n?new $data.GeographyCollection(n):n});$data.GeometryBase=function(){$data.Geospatial.apply(this,arguments);this.crs=$data.GeometryBase.defaultCrs;$data.GeometryBase.validateGeoJSON(this)};$data.GeometryBase.defaultCrs={properties:{name:"EPSG:0"},type:"name"};$data.GeometryBase.parseFromString=function(n){var i=n.indexOf("("),r,t;if(i>=0){if(r=n.substring(0,i).toLowerCase(),t=$data.GeometryBase.registered[r],t&&t.parseFromString&&t!=$data.GeometryBase)return t.parseFromString(n);Guard.raise(new Exception("parseFromString","Not Implemented",n))}};$data.GeometryBase.stringifyToUrl=function(n){if(n instanceof $data.GeometryBase&&n.constructor&&n.constructor.stringifyToUrl)return n.constructor.stringifyToUrl(n);if(n instanceof $data.GeometryBase&&n.constructor&&Array.isArray(n.constructor.validMembers)&&n.constructor.validMembers[0]==="coordinates"){var t="geometry'"+n.type.toUpperCase()+"(";function i(n){if(Array.isArray(n[0]))for(var r=0;r<n.length;r++)r>0&&(t+=","),Array.isArray(n[r][0])&&(t+="("),i(n[r]),Array.isArray(n[r][0])&&(t+=")");else t+=n.join(" ")}return i(n.coordinates,t),t+=")'"}Guard.raise(new Exception("stringifyToUrl on instance type","Not Implemented",n))};$data.GeometryBase.registerType=function(n,t,i){$data.SimpleBase.registerType(n,t,i||$data.GeometryBase);$data.GeometryBase.registered=$data.GeometryBase.registered||{};$data.GeometryBase.registered[n.toLowerCase()]=t};$data.GeometryBase.validateGeoJSON=function(n){var t=n.type,i,r;if(t&&(i=$data.GeometryBase.registered[t.toLowerCase()],typeof i.validateGeoJSON=="function")){if(r=i.validateGeoJSON(n),r)return r;Guard.raise(new Exception("Invalid '"+t+"' format!","Format Exception",n))}console.log("GeoJSON validation missing",n);return};$data.SimpleBase.registerType("GeometryBase",$data.GeometryBase,$data.Geospatial);$data.Container.registerType(["$data.GeometryBase"],$data.GeometryBase);$data.GeometryPoint=function(n,t){var i=n;i&&typeof i=="object"&&Array.isArray(i)?$data.GeometryBase.call(this,{coordinates:i}):i&&typeof i=="object"&&("x"in i||"y"in i)?$data.GeometryBase.call(this,{coordinates:[i.x,i.y]}):i&&typeof i=="object"?$data.GeometryBase.call(this,i):$data.GeometryBase.call(this,{coordinates:[n||0,t||0]})};$data.GeometryPoint.validateGeoJSON=function(n){return n&&Array.isArray(n.coordinates)&&n.coordinates.length==2&&typeof n.coordinates[0]=="number"&&typeof n.coordinates[1]=="number"};$data.GeometryPoint.parseFromString=function(n){var i=n.substring(n.indexOf("(")+1,n.lastIndexOf(")")),t=i.split(" ");return new $data.GeometryPoint(parseFloat(t[0]),parseFloat(t[1]))};$data.GeometryPoint.validMembers=["coordinates"];$data.GeometryBase.registerType("Point",$data.GeometryPoint);Object.defineProperty($data.GeometryPoint.prototype,"x",{get:function(){return this.coordinates[0]},set:function(n){this.coordinates[0]=n}});Object.defineProperty($data.GeometryPoint.prototype,"y",{get:function(){return this.coordinates[1]},set:function(n){this.coordinates[1]=n}});$data.Container.registerType(["$data.GeometryPoint","GeometryPoint"],$data.GeometryPoint);$data.GeometryLineString=function(n){Array.isArray(n)?$data.GeometryBase.call(this,{coordinates:n}):$data.GeometryBase.call(this,n)};$data.GeometryLineString.validateGeoJSON=function(n){for(var t,i=n&&Array.isArray(n.coordinates),r=0;i&&r<n.coordinates.length;r++)t=n.coordinates[r],i=i&&Array.isArray(t)&&t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number";return i};$data.GeometryLineString.validMembers=["coordinates"];$data.GeometryBase.registerType("LineString",$data.GeometryLineString);$data.Container.registerType(["$data.GeometryLineString","GeometryLineString"],$data.GeometryLineString);$data.GeometryPolygon=function(n){var i,r,u,f,t;typeof n=="object"&&("topLeft"in n&&"bottomRight"in n||"topRight"in n&&"bottomLeft"in n)?("topLeft"in n&&"bottomRight"in n?(i=n.topLeft instanceof $data.GeometryPoint?n.topLeft:new $data.GeometryPoint(n.topLeft),f=n.bottomRight instanceof $data.GeometryPoint?n.bottomRight:new $data.GeometryPoint(n.bottomRight),r=new $data.GeometryPoint([f.coordinates[0],i.coordinates[1]]),u=new $data.GeometryPoint([i.coordinates[0],f.coordinates[1]])):(r=n.topRight instanceof $data.GeometryPoint?n.topRight:new $data.GeometryPoint(n.topRight),u=n.bottomLeft instanceof $data.GeometryPoint?n.bottomLeft:new $data.GeometryPoint(n.bottomLeft),i=new $data.GeometryPoint([u.coordinates[0],r.coordinates[1]]),f=new $data.GeometryPoint([r.coordinates[0],u.coordinates[1]])),t=[],t.push([].concat(i.coordinates)),t.push([].concat(r.coordinates)),t.push([].concat(f.coordinates)),t.push([].concat(u.coordinates)),t.push([].concat(i.coordinates)),$data.GeometryBase.call(this,{coordinates:[t]})):Array.isArray(n)?$data.GeometryBase.call(this,{coordinates:n}):$data.GeometryBase.call(this,n)};$data.GeometryPolygon.validateGeoJSON=function(n){for(var r,u,i,t=n&&Array.isArray(n.coordinates),f=0;t&&f<n.coordinates.length;f++)for(r=n.coordinates[f],t=t&&Array.isArray(r),u=0;t&&u<r.length;u++)i=r[u],t=t&&Array.isArray(i)&&i.length==2&&typeof i[0]=="number"&&typeof i[1]=="number";return t};$data.GeometryPolygon.parseFromString=function(n){for(var u,f,i,e,t=n.substring(n.indexOf("(")+1,n.lastIndexOf(")")),o=t.substring(t.indexOf("(")+1,t.lastIndexOf(")")).split("),("),t=[],r=0;r<o.length;r++){for(u=[],f=o[r].split(","),i=0;i<f.length;i++)e=f[i].split(" "),u.push([parseFloat(e[0]),parseFloat(e[1])]);t.push(u)}return new $data.GeometryPolygon(t)};$data.GeometryPolygon.validMembers=["coordinates"];$data.GeometryBase.registerType("Polygon",$data.GeometryPolygon);$data.Container.registerType(["$data.GeometryPolygon","GeometryPolygon"],$data.GeometryPolygon);$data.GeometryMultiPoint=function(n){Array.isArray(n)?$data.GeometryBase.call(this,{coordinates:n}):$data.GeometryBase.call(this,n)};$data.GeometryMultiPoint.validateGeoJSON=function(n){for(var t,i=n&&Array.isArray(n.coordinates),r=0;i&&r<n.coordinates.length;r++)t=n.coordinates[r],i=i&&Array.isArray(t)&&t.length==2&&typeof t[0]=="number"&&typeof t[1]=="number";return i};$data.GeometryMultiPoint.validMembers=["coordinates"];$data.GeometryBase.registerType("MultiPoint",$data.GeometryMultiPoint);$data.Container.registerType(["$data.GeometryMultiPoint","GeometryMultiPoint"],$data.GeometryMultiPoint);$data.GeometryMultiLineString=function(n){Array.isArray(n)?$data.GeometryBase.call(this,{coordinates:n}):$data.GeometryBase.call(this,n)};$data.GeometryMultiLineString.validateGeoJSON=function(n){for(var r,u,i,t=n&&Array.isArray(n.coordinates),f=0;t&&f<n.coordinates.length;f++)for(r=n.coordinates[f],t=t&&Array.isArray(r),u=0;t&&u<r.length;u++)i=r[u],t=t&&Array.isArray(i)&&i.length==2&&typeof i[0]=="number"&&typeof i[1]=="number";return t};$data.GeometryMultiLineString.validMembers=["coordinates"];$data.GeometryBase.registerType("MultiLineString",$data.GeometryMultiLineString);$data.Container.registerType(["$data.GeometryMultiLineString","GeometryMultiLineString"],$data.GeometryMultiLineString);$data.GeometryMultiPolygon=function(n){Array.isArray(n)?$data.GeometryBase.call(this,{coordinates:n}):$data.GeometryBase.call(this,n)};$data.GeometryMultiPolygon.validateGeoJSON=function(n){for(var r,u,f,e,i,t=n&&Array.isArray(n.coordinates),o=0;t&&o<n.coordinates.length;o++)for(r=n.coordinates[o],t=t&&Array.isArray(r),u=0;t&&u<r.length;u++)for(f=r[u],t=t&&Array.isArray(f),e=0;t&&e<f.length;e++)i=f[e],t=t&&Array.isArray(i)&&i.length==2&&typeof i[0]=="number"&&typeof i[1]=="number";return t};$data.GeometryMultiPolygon.validMembers=["coordinates"];$data.GeometryBase.registerType("MultiPolygon",$data.GeometryMultiPolygon);$data.Container.registerType(["$data.GeometryMultiPolygon","GeometryMultiPolygon"],$data.GeometryMultiPolygon);$data.GeometryCollection=function(n){Array.isArray(n)?$data.GeometryBase.call(this,{geometries:n}):$data.GeometryBase.call(this,n)};$data.GeometryCollection.validateGeoJSON=function(n){for(var r,t=n&&Array.isArray(n.geometries),i=0;t&&i<n.geometries.length;i++){r=n.geometries[i];try{t=t&&$data.GeometryBase.validateGeoJSON(r)}catch(u){t=!1}}return t};$data.GeometryCollection.validMembers=["geometries"];$data.GeometryBase.registerType("GeometryCollection",$data.GeometryCollection);$data.Container.registerType(["$data.GeometryCollection","GeometryCollection"],$data.GeometryCollection);$data.Container.registerConverter($data.GeometryPoint,$data.Object,function(n){return n?new $data.GeometryPoint(n):n});$data.Container.registerConverter($data.GeometryLineString,$data.Object,function(n){return n?new $data.GeometryLineString(n):n});$data.Container.registerConverter($data.GeometryPolygon,$data.Object,function(n){return n?new $data.GeometryPolygon(n):n});$data.Container.registerConverter($data.GeometryMultiPoint,$data.Object,function(n){return n?new $data.GeometryMultiPoint(n):n});$data.Container.registerConverter($data.GeometryMultiLineString,$data.Object,function(n){return n?new $data.GeometryMultiLineString(n):n});$data.Container.registerConverter($data.GeometryMultiPolygon,$data.Object,function(n){return n?new $data.GeometryMultiPolygon(n):n});$data.Container.registerConverter($data.GeometryCollection,$data.Object,function(n){return n?new $data.GeometryCollection(n):n});$data.Guid=function(n){if(n===undefined||typeof n=="string"&&/^[a-zA-z0-9]{8}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{4}-[a-zA-z0-9]{12}$/.test(n))this.value=n||"00000000-0000-0000-0000-000000000000";else throw Guard.raise(new Exception("TypeError: ","value not convertable to $data.Guid",n));};$data.Container.registerType(["$data.Guid","Guid","guid"],$data.Guid);$data.Container.registerConverter("$data.Guid",{"$data.String":function(n){return n?$data.parseGuid(n).toString():n},"$data.Guid":function(n){return n?n.toString():n}},{"$data.String":function(n){return n?n.toString():n}});$data.Guid.prototype.toJSON=function(){return this.value};$data.Guid.prototype.valueOf=function(){return this.value};$data.Guid.prototype.toString=function(){return this.value};$data.Guid.NewGuid=function(){return $data.createGuid()};$data.parseGuid=function(n){return new $data.Guid(n)},function(){var n="0123456789ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz".split("");$data.createGuid=function(t){var f;if(t)return new $data.Guid(t);var e,u=n,r=[],i,o=u.length;if(e)for(i=0;i<e;i++)r[i]=u[0|Math.random()*o];else for(r[8]=r[13]=r[18]=r[23]="-",r[14]="4",i=0;i<36;i++)r[i]||(f=0|Math.random()*16,r[i]=u[i==19?f&3|8:f]);return $data.parseGuid(r.join(""))}}();$data.Blob=function(){};$data.Blob.createFromHexString=function(n){var t;if(n!=n.match(new RegExp("[0-9a-fA-F]+"))[0])Guard.raise(new Exception("TypeError: ","value not convertable to $data.Blob",n));else{t=new(typeof Buffer!="undefined"?Buffer:Uint8Array)(n.length>>1);for(var i=0,r=1,u=0;i<n.length;i+=2,r+=2,u++)t[u]=parseInt("0x"+n[i]+n[r],16);return t}};$data.Blob.toString=function(n){var i,t;if(!n||!n.length)return null;for(i="",t=0;t<n.length;t++)i+=String.fromCharCode(n[t]);return i};$data.Blob.toBase64=function(n){return!n||!n.length?null:btoa($data.Blob.toString(n))};$data.Blob.toArray=function(n){var i,t;if(!n||!n.length)return null;for(i=new Array(n.length),t=0;t<n.length;t++)i[t]=n[t];return i};$data.Blob.toHexString=function(n){var i,t;if(!n||!n.length)return null;for(i="",t=0;t<n.length;t++)i+=("00"+n[t].toString(16)).slice(-2);return i.toUpperCase()};$data.Blob.toDataURL=function(n){return!n||!n.length?null:"data:application/octet-stream;base64,"+btoa($data.Blob.toString(n))};$data.Container.registerType(["$data.Blob","blob","JayBlob"],$data.Blob);$data.Container.registerConverter("$data.Blob",{"$data.String":function(n){var i,t;if(n&&n.length){for(i=new(typeof Buffer!="undefined"?Buffer:Uint8Array)(n.length),t=0;t<n.length;t++)i[t]=n.charCodeAt(t);return i}return null},"$data.Array":function(n){return new(typeof Buffer!="undefined"?Buffer:Uint8Array)(n)},"$data.Number":function(n){return new(typeof Buffer!="undefined"?Buffer:Uint8Array)($data.packIEEE754(n,11,52).reverse())},"$data.Boolean":function(n){return new(typeof Buffer!="undefined"?Buffer:Uint8Array)([n|0])},"default":function(n){var t,i,r;if(typeof Blob!="undefined"&&n instanceof Blob)return t=new XMLHttpRequest,t.open("GET",URL.createObjectURL(n),!1),t.responseType="arraybuffer",t.send(null),$data.Container.convertTo(t.response,$data.Blob);if(typeof ArrayBuffer!="undefined"&&n instanceof ArrayBuffer)return new(typeof Buffer!="undefined"?Buffer:Uint8Array)(new Uint8Array(n));if(n instanceof Uint8Array)return typeof Buffer!="undefined"?new Buffer(n):n;if(typeof Buffer!="undefined"?n instanceof Buffer:!1)return n;if(n.buffer)return new(typeof Buffer!="undefined"?Buffer:Uint8Array)(n);if(typeof n=="object"&&n instanceof Object){i=[];for(r in n)i[r]=n[r];if(!i.length)throw 0;return new(typeof Buffer!="undefined"?Buffer:Uint8Array)(i)}throw 0;}},{"$data.String":function(n){return $data.Blob.toString(n)},"$data.Array":function(n){return $data.Blob.toArray(n)}}),function(n){function t(){}function i(){}function r(){}function u(){}function f(){}function e(){}function o(){}function s(){}function h(){}function c(){}function l(){}function a(){}function v(){}function y(){}function p(){}function w(){}function b(){}function k(){}function d(){}function g(){}function nt(){}function tt(){}function it(){}function rt(){}function ut(){}function ft(){}function et(){}function ot(){}function st(){}function ht(){}n.Container.registerType("Edm.Boolean",t);n.Container.mapType(t,n.Boolean);n.Container.registerType("Edm.Binary",i);n.Container.mapType(i,n.Blob);n.Container.registerType("Edm.DateTime",r);n.Container.mapType(r,n.Date);n.Container.registerType("Edm.DateTimeOffset",u);n.Container.mapType(u,n.DateTimeOffset);n.Container.registerType("Edm.Time",f);n.Container.mapType(f,n.Time);n.Container.registerType("Edm.Decimal",e);n.Container.mapType(e,n.Decimal);n.Container.registerType("Edm.Float",o);n.Container.mapType(o,n.Float);n.Container.registerType("Edm.Single",s);n.Container.mapType(s,n.Float);n.Container.registerType("Edm.Double",h);n.Container.mapType(h,n.Number);n.Container.registerType("Edm.Guid",c);n.Container.mapType(c,n.Guid);n.Container.registerType("Edm.Int16",l);n.Container.mapType(l,n.Int16);n.Container.registerType("Edm.Int32",a);n.Container.mapType(a,n.Integer);n.Container.registerType("Edm.Int64",v);n.Container.mapType(v,n.Int64);n.Container.registerType("Edm.Byte",y);n.Container.mapType(y,n.Byte);n.Container.registerType("Edm.SByte",p);n.Container.mapType(p,n.SByte);n.Container.registerType("Edm.String",w);n.Container.mapType(w,n.String);n.Container.registerType("Edm.GeographyPoint",b);n.Container.mapType(b,n.GeographyPoint);n.Container.registerType("Edm.GeographyLineString",k);n.Container.mapType(k,n.GeographyLineString);n.Container.registerType("Edm.GeographyPolygon",d);n.Container.mapType(d,n.GeographyPolygon);n.Container.registerType("Edm.GeographyMultiPoint",g);n.Container.mapType(g,n.GeographyMultiPoint);n.Container.registerType("Edm.GeographyMultiLineString",nt);n.Container.mapType(nt,n.GeographyMultiLineString);n.Container.registerType("Edm.GeographyMultiPolygon",tt);n.Container.mapType(tt,n.GeographyMultiPolygon);n.Container.registerType("Edm.GeographyCollection",it);n.Container.mapType(it,n.GeographyCollection);n.Container.registerType("Edm.GeometryPoint",rt);n.Container.mapType(rt,n.GeometryPoint);n.Container.registerType("Edm.GeometryLineString",ut);n.Container.mapType(ut,n.GeometryLineString);n.Container.registerType("Edm.GeometryPolygon",ft);n.Container.mapType(ft,n.GeometryPolygon);n.Container.registerType("Edm.GeometryMultiPoint",et);n.Container.mapType(et,n.GeometryMultiPoint);n.Container.registerType("Edm.GeometryMultiLineString",ot);n.Container.mapType(ot,n.GeometryMultiLineString);n.Container.registerType("Edm.GeometryMultiPolygon",st);n.Container.mapType(st,n.GeometryMultiPolygon);n.Container.registerType("Edm.GeometryCollection",ht);n.Container.mapType(ht,n.GeometryCollection);n.oDataEdmMapping={"$data.Byte":"Edm.Byte","$data.SByte":"Edm.SByte","$data.Decimal":"Edm.Decimal","$data.Float":"Edm.Float","$data.Int16":"Edm.Int16","$data.Int64":"Edm.Int64","$data.DateTimeOffset":"Edm.DateTimeOffset","$data.Time":"Edm.Time","$data.Boolean":"Edm.Boolean","$data.Blob":"Edm.Binary","$data.Date":"Edm.DateTime","$data.Number":"Edm.Double","$data.Integer":"Edm.Int32","$data.Int32":"Edm.Int32","$data.String":"Edm.String","$data.ObjectID":"Edm.String","$data.GeographyPoint":"Edm.GeographyPoint","$data.GeographyLineString":"Edm.GeographyLineString","$data.GeographyPolygon":"Edm.GeographyPolygon","$data.GeographyMultiPoint":"Edm.GeographyMultiPoint","$data.GeographyMultiLineString":"Edm.GeographyMultiLineString","$data.GeographyMultiPolygon":"Edm.GeographyMultiPolygon","$data.GeographyCollection":"Edm.GeographyCollection","$data.GeometryPoint":"Edm.GeometryPoint","$data.GeometryLineString":"Edm.GeometryLineString","$data.GeometryPolygon":"Edm.GeometryPolygon","$data.GeometryMultiPoint":"Edm.GeometryMultiPoint","$data.GeometryMultiLineString":"Edm.GeometryMultiLineString","$data.GeometryMultiPolygon":"Edm.GeometryMultiPolygon","$data.GeometryCollection":"Edm.GeometryCollection","$data.Guid":"Edm.Guid"}}($data);$data.Container.registerConverter("$data.Boolean",{"$data.String":function(n){return n.toLowerCase()=="true"?!0:n.toLowerCase()=="false"?!1:!!n},"default":function(n){return!!n}});$data.Container.registerConverter("$data.Integer",{"default":function(n){if(n===Number.POSITIVE_INFINITY||n===Number.NEGATIVE_INFINITY||n===Number.MAX_VALUE||n===Number.MIN_VALUE)return n;var t=parseInt(+n,10);if(isNaN(t))throw 0;return t}});$data.Container.registerConverter("$data.Int32",{"default":function(n){return n|0}});$data.Container.registerConverter("$data.Number",{"default":function(n){var t=+n;if(isNaN(t))throw 0;return t}});$data.Container.registerConverter("$data.Byte",{"default":function(n){return(n|0)&255}});$data.Container.registerConverter("$data.Date",{"default":function(n){var t=new Date(n);if(isNaN(t))throw 0;return t}});$data.Container.registerConverter("$data.DateTimeOffset",{"$data.Date":function(n){return n},"default":function(n){var t=new Date(n);if(isNaN(t))throw 0;return t}}),function(){function n(n){var t=/^([0-9]|0[0-9]|1[0-9]|2[0-3]):([0-5][0-9]|[0-9])(:([0-5][0-9]|[0-9])(\.(\d+))?)?$/.exec(n),i;if(!t)throw 0;return i="",i+=("00"+t[1]).slice(-2),i+=":"+("00"+t[2]).slice(-2),i+=t[4]?":"+("00"+t[4]).slice(-2):":00",t[6]&&(i+="."+(t[6]+"000").slice(0,3)),i}$data.Container.registerConverter("$data.Time",{"$data.String":n,"$data.Number":function(t){for(var f,u=[1e3,60,60],r=[0,0,0,t|0],i=0;i<u.length;i++)r[u.length-(i+1)]=r[u.length-i]/u[i]|0,r[u.length-i]-=r[u.length-(i+1)]*u[i];for(f="",i=0;i<r.length;i++)i<r.length-1?(f+=("00"+r[i]).slice(-2),i<r.length-2&&(f+=":")):f+="."+("000"+r[i]).slice(-3);return n(f)},"$data.Date":function(t){var i=t.getHours()+":"+t.getMinutes()+":"+t.getSeconds(),r=t.getMilliseconds();return r&&(i+="."+r),n(i)}})}();$data.Container.registerConverter("$data.Decimal",{"$data.Boolean":function(n){return n?"1":"0"},"$data.Number":function(n){return n.toString()},"$data.String":function(n){if(!/^\-?([0-9]+(\.[0-9]+)?|Infinity)$/.test(n))throw 0;return n},"$data.Date":function(n){var t=n.valueOf();if(isNaN(t))throw 0;return t.toString()}});$data.packIEEE754=function(n,t,i){var f=(1<<t-1)-1,s,r,u,c,e,o,h,l;for(n!==n?(r=(1<<f)-1,u=Math.pow(2,i-1),s=0):n===Infinity||n===-Infinity?(r=(1<<f)-1,u=0,s=n<0?1:0):n===0?(r=0,u=0,s=1/n==-Infinity?1:0):(s=n<0,n=Math.abs(n),n>=Math.pow(2,1-f)?(c=Math.min(Math.floor(Math.log(n)/Math.LN2),f),r=c+f,u=Math.round(n*Math.pow(2,i-c)-Math.pow(2,i))):(r=0,u=Math.round(n/Math.pow(2,1-f-i)))),o=[],e=i;e;e-=1)o.push(u%2?1:0),u=Math.floor(u/2);for(e=t;e;e-=1)o.push(r%2?1:0),r=Math.floor(r/2);for(o.push(s?1:0),o.reverse(),h=o.join(""),l=[];h.length;)l.push(parseInt(h.substring(0,8),2)),h=h.substring(8);return l};$data.unpackIEEE754=function(n,t,i){for(var h=[],c,e,o,l,r,s,u,f=n.length;f;f-=1)for(e=n[f-1],c=8;c;c-=1)h.push(e%2?1:0),e=e>>1;return h.reverse(),o=h.join(""),l=(1<<t-1)-1,r=parseInt(o.substring(0,1),2)?-1:1,s=parseInt(o.substring(1,1+t),2),u=parseInt(o.substring(1+t),2),s===(1<<t)-1?u!==0?NaN:r*Infinity:s>0?r*Math.pow(2,s-l)*(1+u/Math.pow(2,i)):u!==0?r*Math.pow(2,-(l-1))*(u/Math.pow(2,i)):r<0?-0:0};$data.IEEE754=function(n,t,i){return $data.unpackIEEE754($data.packIEEE754(n,t,i),t,i)};$data.Container.registerConverter("$data.Float",{"default":function(n){var t=+n;if(isNaN(t))throw 0;return $data.IEEE754(t,8,23)}});$data.Container.registerConverter("$data.Int16",{"default":function(n){var t=(n|0)&65535;return t>=32768?t-65536:t}});$data.Container.registerConverter("$data.Int64",{"$data.Boolean":function(n){return n?"1":"0"},"$data.Number":function(n){var t=n.toString();if(t.indexOf(".")>0)return t.split(".")[0];if(t.indexOf(".")==0)throw 0;return t},"$data.String":function(n){if(!/^\-?([0-9]+(\.[0-9]+)?|Infinity)$/.test(n))throw 0;if(n.indexOf(".")>0)return n.split(".")[0];if(n.indexOf(".")==0)throw 0;return n},"$data.Date":function(n){var t=n.valueOf();if(isNaN(t))throw 0;return t.toString()}});$data.Container.registerConverter("$data.SByte",{"default":function(n){var t=(n|0)&255;return t>=128?t-256:t}});$data.Container.registerConverter("$data.String",{"$data.Date":function(n){return n.toISOString()},"$data.ObjectID":function(n){return btoa(n.toString())},"default":function(n){return typeof n=="object"?JSON.stringify(n):n.toString()}});$data.Container.registerConverter("$data.Object",{"$data.String":function(n){return JSON.parse(n)},"$data.Function":function(){throw 0;}});$data.Container.registerConverter("$data.Array",{"$data.String":function(n){var t=JSON.parse(n);if(!Array.isArray(t))throw 0;return t}});$data.Container.registerConverter("$data.ObjectID",{"$data.ObjectID":function(n){try{return btoa(n.toString())}catch(t){return n}},"$data.String":function(n){return n}});$data.Container.proxyConverter=function(n){return n};$data.Container.defaultConverter=function(n){return function(t){return $data.Container.convertTo(t,n)}};$data.StringFunctions={startsWith:function(){var n,t;if(arguments.length==2)n=arguments[0],t=arguments[1];else if(arguments.length==1&&typeof this=="string")n=this,t=arguments[0];else if(this instanceof String)n=this.valueOf(),t=arguments[0];else return!1;return typeof n!="string"?!1:n.indexOf(t)===0},endsWith:function(){var n,t;if(arguments.length==2)n=arguments[0],t=arguments[1];else if(arguments.length==1&&typeof this=="string")n=this,t=arguments[0];else if(this instanceof String)n=this.valueOf(),t=arguments[0];else return!1;return typeof n!="string"?!1:n.slice(-t.length)===t},contains:function(){var n,t;if(arguments.length==2)n=arguments[0],t=arguments[1];else if(arguments.length==1&&typeof this=="string")n=this,t=arguments[0];else if(this instanceof String)n=this.valueOf(),t=arguments[0];else return!1;return typeof n!="string"?!1:n.indexOf(t)>=0}};$data.Class.define("$data.Expressions.ExpressionType",null,null,{},{Constant:"constant",Variable:"variable",MemberAccess:"memberAccess",Call:"call",Equal:"equal",NotEqual:"notEqual",EqualTyped:"equalTyped",NotEqualTyped:"notEqualTyped",GreaterThen:"greaterThan",LessThen:"lessThan",GreaterThenOrEqual:"greaterThanOrEqual",LessThenOrEqual:"lessThenOrEqual",Or:"or",OrBitwise:"orBitwise",And:"and",AndBitwise:"andBitwise",In:"in",Add:"add",Divide:"divide",Multiply:"multiply",Subtract:"subtract",Modulo:"modulo",ArrayIndex:"arrayIndex",New:"new",Positive:"positive",Negative:"negative",Increment:"increment",Decrement:"decrement",Not:"not",This:"this",LambdaParameterReference:"lambdaParameterReference",LambdaParameter:"lambdaParameter",Parameter:"parameter",ArrayLiteral:"arrayLiteral",ObjectLiteral:"objectLiteral",ObjectField:"objectField",Function:"Function",Unknown:"UNKNOWN",EntitySet:"EntitySet",ServiceOperation:"ServiceOperation",EntityField:"EntityField",EntityContext:"EntityContext",Entity:"Entity",Filter:"Filter",First:"First",Count:"Count",InlineCount:"InlineCount",Single:"Single",Find:"Find",Some:"Some",Every:"Every",ToArray:"ToArray",BatchDelete:"BatchDelete",ForEach:"ForEach",Projection:"Projection",EntityMember:"EntityMember",EntityFieldOperation:"EntityFieldOperation",FrameOperation:"FrameOperation",EntityFunctionOperation:"EntityFunctionOperation",ContextFunctionOperation:"ContextFunctionOperation",EntityBinary:"EntityBinary",Code:"Code",ParametricQuery:"ParametricQuery",MemberInfo:"MemberInfo",QueryParameter:"QueryParameter",ComplexEntityField:"ComplexEntityField",Take:"Take",Skip:"Skip",OrderBy:"OrderBy",OrderByDescending:"OrderByDescending",Include:"Include",IndexedPhysicalAnd:"IndexedDBPhysicalAndFilterExpression",IndexedLogicalAnd:"IndexedDBLogicalAndFilterExpression",IndexedLogicalOr:"IndexedDBLogicalOrFilterExpression",IndexedLogicalIn:"IndexedDBLogicalInFilterExpression"});$data.BinaryOperator=function(){};$data.binaryOperators=[{operator:"==",expressionType:$data.Expressions.ExpressionType.Equal,type:"boolean",implementation:function(n,t){return n==t}},{operator:"===",expressionType:$data.Expressions.ExpressionType.EqualTyped,type:"boolean",implementation:function(n,t){return n===t}},{operator:"!=",expressionType:$data.Expressions.ExpressionType.NotEqual,type:"boolean",implementation:function(n,t){return n!=t}},{operator:"!==",expressionType:$data.Expressions.ExpressionType.NotEqualTyped,type:"boolean",implementation:function(n,t){return n!==t}},{operator:">",expressionType:$data.Expressions.ExpressionType.GreaterThen,type:"boolean",implementation:function(n,t){return n>t}},{operator:">=",expressionType:$data.Expressions.ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(n,t){return n>=t}},{operator:"<=",expressionType:$data.Expressions.ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(n,t){return n<=t}},{operator:"<",expressionType:$data.Expressions.ExpressionType.LessThen,type:"boolean",implementation:function(n,t){return n<t}},{operator:"&&",expressionType:$data.Expressions.ExpressionType.And,type:"boolean",implementation:function(n,t){return n&&t}},{operator:"||",expressionType:$data.Expressions.ExpressionType.Or,type:"boolean",implementation:function(n,t){return n||t}},{operator:"&",expressionType:$data.Expressions.ExpressionType.AndBitwise,type:"number",implementation:function(n,t){return n&t}},{operator:"|",expressionType:$data.Expressions.ExpressionType.OrBitwise,type:"number",implementation:function(n,t){return n|t}},{operator:"+",expressionType:$data.Expressions.ExpressionType.Add,type:"number",implementation:function(n,t){return n+t}},{operator:"-",expressionType:$data.Expressions.ExpressionType.Subtract,type:"number",implementation:function(n,t){return n-t}},{operator:"/",expressionType:$data.Expressions.ExpressionType.Divide,type:"number",implementation:function(n,t){return n/t}},{operator:"%",expressionType:$data.Expressions.ExpressionType.Modulo,type:"number",implementation:function(n,t){return n%t}},{operator:"*",expressionType:$data.Expressions.ExpressionType.Multiply,type:"number",implementation:function(n,t){return n*t}},{operator:"[",expressionType:$data.Expressions.ExpressionType.ArrayIndex,type:"number",implementation:function(n,t){return n[t]}},{operator:"in",expressionType:$data.Expressions.ExpressionType.In,type:"boolean",implementation:function(n,t){return n in t}}];$data.binaryOperators.resolve=function(n){var t=$data.binaryOperators.filter(function(t){return t.operator==n});if(t.length>0)return n};$data.binaryOperators.contains=function(n){return $data.binaryOperators.some(function(t){return t.operator==n})};$data.binaryOperators.getOperator=function(n){var t=$data.binaryOperators.filter(function(t){return t.operator==n});return t.length<1&&Guard.raise("Unknown operator: "+n),t[0]};$data.unaryOperators=[{operator:"+",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Positive,type:"number",implementation:function(n){return+n}},{operator:"-",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Negative,type:"number",implementation:function(n){return-n}},{operator:"++",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(n){return++n}},{operator:"--",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(n){return--n}},{operator:"++",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(n){return n++}},{operator:"!",arity:"prefix",expressionType:$data.Expressions.ExpressionType.Not,type:"boolean",implementation:function(n){return!n}},{operator:"--",arity:"suffix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(n){return n--}}];$data.unaryOperators.resolve=function(n){var t=$data.unaryOperators.filter(function(t){return t.operator==n});if(t.length>0)return n};$data.unaryOperators.contains=function(n){return $data.unaryOperators.some(function(t){return t.operator==n})};$data.unaryOperators.getOperator=function(n,t){var i=$data.unaryOperators.filter(function(i){return i.operator==n&&(!t||i.arity==t)});return i.length<1&&Guard.raise("Unknown operator: "+n),i[0]};$data.timeIt=function(n,t){t=t||1;console.time("!");for(var i=0;i<t;i++)n();console.timeEnd("!")};$data.Expressions.OperatorTypes={UNARY:"UNARY",INCDEC:"INCDEC",DECISION:"DECISION",METHODCALL:"METHODCALL",NEW:"NEW",JSONASSIGN:"JSONASSIGN",ARRAYACCESS:"ARRAYACCESS",UNKNOWN:"UNKNOWN"};$data.executable=!0;$C("$data.Expressions.ExpressionNode",null,null,{constructor:function(){this.expressionType=this.constructor},getJSON:function(){return jsonify(this)},expressionType:{set:function(n){typeof n=="string"&&(n=Container.resolveType(n));this._expressionType=n},get:function(){return arguments.callee.caller==jsonify||arguments.callee.caller==JSON.stringify?Container.resolveName(this._expressionType):this._expressionType},enumerable:!0},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:!1},type:{},isTerminated:{value:!1},toString:function(){return this.value}},null);$C("$data.Expressions.UnaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i,r){this.operand=n;this.operator=t;this.nodeType=i;this.resolution=r},operator:{value:undefined,writable:!0},operand:{value:undefined,writable:!0},nodeType:{value:undefined,writable:!0}});$C("$data.Expressions.ArrayLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n){this.items=n||[]},nodeType:{value:$data.Expressions.ExpressionType.ArrayLiteral,writable:!0},items:{value:undefined,dataType:Array,elementType:$data.Expressions.ExpressionNode},toString:function(){return"["+this.items.map(function(n){return n.toString()}).join(",")+"]"}},null);$C("$data.Expressions.CallExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i){this.expression=n;this.member=t;this.args=i},nodeType:{value:$data.Expressions.ExpressionType.Call},expression:{value:undefined,dataType:$data.Expressions.ExpressionNode,writable:!0},member:{value:undefined,dataType:$data.MemberDefinition,writable:!0},type:{value:undefined,writable:!0},implementation:{get:function(){return function(n,t,i){return typeof t!="function"&&(t=n[t]),Guard.requireType("method",t,Function),t.apply(n,i)}},set:function(){Guard.raise("Property can not be set")}},toString:function(){return this.object.toString()+"."+this.member.toString()+"()"}});$C("$data.Expressions.CodeParser",null,null,{constructor:function(n){this.scopeContext=n;this.lambdaParams=[]},log:function(n){this.scopeContext&&this.scopeContext.log(n)},parseExpression:function(n){var r,t,i;return typeof n=="object"&&(n=""),r={success:!0,errorMessage:"",errorDetails:""},$data.Acorn?{success:!0,expression:this.ParserBuild($data.Acorn.parse("("+n.toString()+")").body[0]),errors:[]}:$data.Esprima?{success:!0,expression:this.ParserBuild($data.Esprima.parse("("+n.toString()+")").body[0]),errors:[]}:(t=$data.ASTParser.parseCode(n),this.log({event:"AST",data:t}),!t.success)?{success:!1,error:"ASTParser error",errorMessage:t.errors?JSON.stringify(t.errors):"could not get code"}:(i=this.Build2(t.tree.first[0]),{success:!0,expression:i,errors:t.errors})},createExpression:function(n,t){var i=this.parseExpression(n,t);return i.success||Guard.raise("ExpressionParserError: "+i.errorMessage),i.expression},ParserBuild:function(n){return this["Parser"+n.type](n)},ParserExpressionStatement:function(n){return this.ParserBuild(n.expression)},ParserBlockStatement:function(n){return this.ParserBuild(n.body[0])},ParserReturnStatement:function(n){return this.ParserBuild(n.argument)},ParserMemberExpression:function(n){return new $data.Expressions.PropertyExpression(this.ParserBuild(n.object),new $data.Expressions.ConstantExpression(n.property.name||n.property.value,typeof(n.property.name||n.property.value)))},ParserIdentifier:function(n){return this.ParserParameter(n,this.lambdaParams.indexOf(n.name)>-1?$data.Expressions.ExpressionType.LambdaParameterReference:$data.Expressions.ExpressionType.Parameter)},ParserObjectExpression:function(n){for(var i=new Array(n.properties.length),t=0;t<n.properties.length;t++)i[t]=this.ParserProperty(n.properties[t]);return new $data.Expressions.ObjectLiteralExpression(i)},ParserArrayExpression:function(n){for(var i=new Array(n.elements.length),t=0;t<n.elements.length;t++)i[t]=this.ParserBuild(n.elements[t]);return new $data.Expressions.ArrayLiteralExpression(i)},ParserProperty:function(n){return new $data.Expressions.ObjectFieldExpression(n.key.name,this.ParserBuild(n.value))},ParserFunctionExpression:function(n){for(var r,i=new Array(n.params.length),t=0;t<n.params.length;t++)this.lambdaParams.push(n.params[t].name),i[t]=this.ParserParameter(n.params[t],$data.Expressions.ExpressionType.LambdaParameter),i[t].owningFunction=r;return new $data.Expressions.FunctionExpression(n.id?n.id.name:n.id,i,this.ParserBuild(n.body))},ParserParameter:function(n,t){var i=new $data.Expressions.ParameterExpression(n.name,null,t);return t==$data.Expressions.ExpressionType.LambdaParameterReference&&(i.paramIndex=this.lambdaParams.indexOf(n.name)),i},ParserLogicalExpression:function(n){return this.ParserBinaryExpression(n)},ParserOperators:{value:{"==":{expressionType:$data.Expressions.ExpressionType.Equal,type:"boolean",implementation:function(n,t){return n==t}},"===":{expressionType:$data.Expressions.ExpressionType.EqualTyped,type:"boolean",implementation:function(n,t){return n===t}},"!=":{expressionType:$data.Expressions.ExpressionType.NotEqual,type:"boolean",implementation:function(n,t){return n!=t}},"!==":{expressionType:$data.Expressions.ExpressionType.NotEqualTyped,type:"boolean",implementation:function(n,t){return n!==t}},">":{expressionType:$data.Expressions.ExpressionType.GreaterThen,type:"boolean",implementation:function(n,t){return n>t}},">=":{expressionType:$data.Expressions.ExpressionType.GreaterThenOrEqual,type:"boolean",implementation:function(n,t){return n>=t}},"<=":{expressionType:$data.Expressions.ExpressionType.LessThenOrEqual,type:"boolean",implementation:function(n,t){return n<=t}},"<":{expressionType:$data.Expressions.ExpressionType.LessThen,type:"boolean",implementation:function(n,t){return n<t}},"&&":{expressionType:$data.Expressions.ExpressionType.And,type:"boolean",implementation:function(n,t){return n&&t}},"||":{expressionType:$data.Expressions.ExpressionType.Or,type:"boolean",implementation:function(n,t){return n||t}},"&":{expressionType:$data.Expressions.ExpressionType.AndBitwise,type:"number",implementation:function(n,t){return n&t}},"|":{expressionType:$data.Expressions.ExpressionType.OrBitwise,type:"number",implementation:function(n,t){return n|t}},"+":{expressionType:$data.Expressions.ExpressionType.Add,type:"number",implementation:function(n,t){return n+t}},"-":{expressionType:$data.Expressions.ExpressionType.Subtract,type:"number",implementation:function(n,t){return n-t}},"/":{expressionType:$data.Expressions.ExpressionType.Divide,type:"number",implementation:function(n,t){return n/t}},"%":{expressionType:$data.Expressions.ExpressionType.Modulo,type:"number",implementation:function(n,t){return n%t}},"*":{expressionType:$data.Expressions.ExpressionType.Multiply,type:"number",implementation:function(n,t){return n*t}},"[":{expressionType:$data.Expressions.ExpressionType.ArrayIndex,type:"number",implementation:function(n,t){return n[t]}},"in":{expressionType:$data.Expressions.ExpressionType.In,type:"boolean",implementation:function(n,t){return n in t}}}},ParserUnaryOperators:{value:{"+":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Positive,type:"number",implementation:function(n){return+n}},"-":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Negative,type:"number",implementation:function(n){return-n}},"++true":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(n){return++n}},"--true":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(n){return--n}},"++false":{arity:"suffix",expressionType:$data.Expressions.ExpressionType.Increment,type:"number",implementation:function(n){return n++}},"!":{arity:"prefix",expressionType:$data.Expressions.ExpressionType.Not,type:"boolean",implementation:function(n){return!n}},"--false":{arity:"suffix",expressionType:$data.Expressions.ExpressionType.Decrement,type:"number",implementation:function(n){return n--}}}},ParserUnaryExpression:function(n){return new $data.Expressions.UnaryExpression(this.ParserBuild(n.argument),this.ParserUnaryOperators[n.operator],this.ParserUnaryOperators[n.operator].expressionType)},ParserUpdateExpression:function(n){return new $data.Expressions.UnaryExpression(this.ParserBuild(n.argument),this.ParserUnaryOperators[n.operator+n.prefix],this.ParserUnaryOperators[n.operator+n.prefix].nodeType)},ParserBinaryExpression:function(n){return new $data.Expressions.SimpleBinaryExpression(this.ParserBuild(n.left),this.ParserBuild(n.right),this.ParserOperators[n.operator].expressionType,n.operator,this.ParserOperators[n.operator].type)},ParserThisExpression:function(){return new $data.Expressions.ThisExpression},ParserLiteral:function(n){return new $data.Expressions.ConstantExpression(n.value,typeof n.value)},ParserCallExpression:function(n){for(var r,u,t=this.ParserBuild(n.callee),f=new Array(n.arguments.length),i=0;i<n.arguments.length;i++)f[i]=this.ParserBuild(n.arguments[i]);switch(!0){case t instanceof $data.Expressions.PropertyExpression:u=t.expression;r=t.member;break;case t instanceof $data.Expressions.ParameterExpression:u=new $data.Expressions.ConstantExpression(null,"object");r=t}return new $data.Expressions.CallExpression(u,r,f)}});$C("$data.Expressions.ConstantExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i){this.value=n;this.type=t;this.name=i;Object.isNullOrUndefined(this.value)||(this.type=Container.resolveType(this.type),Container.resolveType(Container.getTypeName(this.value))!==this.type&&(this.value=Container.convertTo(n,this.type)))},nodeType:{value:$data.Expressions.ExpressionType.Constant,enumerable:!0},type:{value:Object,writable:!0},value:{value:undefined,writable:!0},toString:function(){return this.value.toString()}});$C("$data.Expressions.FunctionExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i){this.parameters=t||[];this.name=n;this.body=i},toString:function(n){var t=this.parameters.map(function(n){return n.toString()}),i;return t=t.join(","),i=this.body?this.body.toString(n):"","function "+this.name+"("+t+") { "+i+"}"},nodeType:{value:$data.Expressions.ExpressionType.Function,writable:!0},parameters:{value:undefined,dataType:Array,elementType:$data.Expressions.ParameterExpression},body:{value:undefined,dataType:$data.Expressions.ExpressionNode},type:{}},null);$C("$data.Expressions.ObjectFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t){this.fieldName=n;this.expression=t},nodeType:{value:$data.Expressions.ExpressionType.ObjectField,writable:!0},toString:function(){return"unimplemented"}},null);$C("$data.Expressions.ObjectLiteralExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n){this.members=n},nodeType:{value:$data.Expressions.ExpressionType.ObjectLiteral,writable:!0},toString:function(){return"unimplemented"},implementation:{get:function(){return function(n){var t={};return n.forEach(function(n){t[n.name]=n.value}),t}},set:function(){}}},null);$C("$data.Expressions.PagingExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i){this.source=n;this.amount=t;this.nodeType=i},nodeType:{value:$data.Expressions.ExpressionType.Unknown,writable:!0},toString:function(){return"unimplemented"}},null);$C("$data.Expressions.ParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i){this.nodeType=i||$data.Expressions.ExpressionType.Parameter;this.name=n;this.type=t||"unknown"},owningFunction:{value:undefined,enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.Parameter,writable:!0},name:{value:undefined,dataType:String,writable:!0},type:{value:undefined,dataType:"object",writable:!0},toString:function(n){var t;return t=n?this.type+" ":"",t+this.name}},null);$C("$data.Expressions.PropertyExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t){this.expression=n;this.member=t;this.type=t.dataType},nodeType:{value:$data.Expressions.ExpressionType.MemberAccess},expression:{value:undefined,dataType:$data.Expressions.ExpressionNode,writable:!0},implementation:{get:function(){return function(n,t){return n[t]===undefined&&Guard.raise(new Exception("Parameter '"+t+"' not found in context","Property not found!")),n[t]}},set:function(){}},member:{value:undefined,dataType:$data.MemberDefinition,writable:!0},type:{value:undefined,writable:!0},toString:function(){return this.expression.toString()+"."+this.member.toString()}});$C("$data.Expressions.SimpleBinaryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i,r,u,f){this.left=n;this.right=t;this.nodeType=i;this.operator=r;this.type=u;this.resolution=f},implementation:{get:function(){return $data.binaryOperators.getOperator(this.operator).implementation},set:function(){}},type:{value:"number",writable:!0}});$C("$data.Expressions.ThisExpression",$data.Expressions.ExpressionNode,null,{nodeType:{value:$data.Expressions.ExpressionType.This}});$C("$data.Expressions.ExpressionVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(n,t){if(!n)return n;var i=null;switch(n.expressionType){case $data.Expressions.ParameterExpression:i=this.VisitParameter(n,t);break;case $data.Expressions.ConstantExpression:i=this.VisitConstant(n,t);break;case $data.Expressions.FunctionExpression:i=this.VisitFunction(n,t);break;case $data.Expressions.CallExpression:i=this.VisitCall(n,t);break;case $data.Expressions.SimpleBinaryExpression:i=this.VisitBinary(n,t);break;case $data.Expressions.PropertyExpression:i=this.VisitProperty(n,t);break;case $data.Expressions.ThisExpression:i=this.VisitThis(n,t);break;case $data.Expressions.ObjectLiteralExpression:i=this.VisitObjectLiteral(n,t);break;case $data.Expressions.ObjectFieldExpression:i=this.VisitObjectField(n,t);break;case $data.Expressions.ArrayLiteralExpression:i=this.VisitArrayLiteral(n,t);break;case $data.Expressions.UnaryExpression:i=this.VisitUnary(n,t);break;case $data.Expressions.EntityContextExpression:i=this.VisitEntityContext(n,t)}return this._deep=this._deep-1,i},VisitArrayLiteral:function(n,t){var i=this,r=n.items.map(function(n){return i.Visit(n,t)});return Container.createArrayLiteralExpression(r)},VisitObjectLiteral:function(n,t){var i=this,r=n.members.map(function(n){return i.Visit(n,t)});return Container.createObjectLiteralExpression(r)},VisitObjectField:function(n,t){var i=this.Visit(n.expression,t);return Container.createObjectFieldExpression(n.fieldName,i)},VisitThis:function(n){return n},VisitCall:function(n,t){var f=this,i=n.args.map(function(n){return this.Visit(n,t)},this),r=this.Visit(n.expression,t),u=this.Visit(n.member,t);return new $data.Expressions.CallExpression(r,u,i)},VisitParameter:function(n){return n},VisitConstant:function(n){return n},VisitFunction:function(n,t){var i=this,r=n.parameters.map(function(n){return i.Visit(n,t)}),u=i.Visit(n.body,t);return new $data.Expressions.FunctionExpression(n.name,r,u)},VisitBinary:function(n,t){var i=this.Visit(n.left,t),r=this.Visit(n.right,t);return new $data.Expressions.SimpleBinaryExpression(i,r,n.nodeType,n.operator,n.type)},VisitProperty:function(n,t){var i=this.Visit(n.expression,t),r=this.Visit(n.member,t);return new $data.Expressions.PropertyExpression(i,r)},VisitUnary:function(n,t){var i=this.Visit(n.operand,t);return i===n.operand?n:new $data.Expressions.UnaryExpression(i,n.operator,n.nodeType)},VisitEntityContext:function(n){return n},VisitDecision:function(n,t){var i=this.Visit(n.expression,t),r=this.Visit(n.left,t),u=this.Visit(n.right,t);return i===n.expression&&r===n.left&&u===n.right?n:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(n.executable,i,r,u)},VisitNew:function(n,t){var i=this.VisitArray(n.values,t);return i===n.values?n:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(!0,i)},VisitArrayAccess:function(n,t){var i=this.Visit(n.array,t),r=this.Visit(n.index,t);return i===n.array&&r===n.index?n:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(!0,i,r)},VisitArray:function(n,t){for(var r=[],u=!0,i=0;i<n.length;i++)r[i]=this.Visit(n[i],t),u=u&&r[i]===n[i];return u?n:r},GetMemberChain:function(n,t){if(n.expression.type==MEMBERACCESS){var i=this.GetMemberChain(n.expression,t);return i.push(n.member),i}return[n.expression,n.member]}},{});$C("$data.Expressions.ParameterProcessor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},Visit:function(n,t){if((n instanceof $data.Expressions.ParameterExpression||n instanceof $data.Expressions.ThisExpression)&&this.canResolve(n)){var i=this.resolve(n,t);return i!==n&&(i.resolvedBy=this.constructor.name),i}return n},canResolve:function(){Guard.raise("Pure method")},resolve:function(){Guard.raise("Pure method")}});$C("$data.Expressions.GlobalContextProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(n){this.global=n},canResolve:function(n){return n.nodeType==$data.Expressions.ExpressionType.Parameter&&this.global&&typeof this.global=="object"&&n.name in this.global},resolve:function(n){var t=this.global[n.name];return Container.createConstantExpression(t,typeof t,n.name)}});$C("$data.Expressions.ConstantValueResolver",$data.Expressions.ParameterProcessor,null,{constructor:function(n,t,i){this.globalResolver=Container.createGlobalContextProcessor(t);this.paramResolver=Container.createGlobalContextProcessor(n);this.paramsObject=n;this.scopeContext=i},canResolve:function(n){return n.name==="$context"||n.nodeType==$data.Expressions.ExpressionType.This&&this.paramsObject?!0:this.paramResolver.canResolve(n)||this.globalResolver.canResolve(n)},resolve:function(n){return n.name==="$context"?Container.createEntityContextExpression(this.scopeContext):n.nodeType==$data.Expressions.ExpressionType.This?Container.createConstantExpression(this.paramsObject,typeof this.paramsObject,"this"):this.paramResolver.canResolve(n)?this.paramResolver.resolve(n):this.globalResolver.resolve(n)}});$C("$data.Expressions.LocalContextProcessor",$data.Expressions.GlobalContextProcessor,null,{constructor:function(n){this.canResolve=function(t){return t.nodeType==$data.Expressions.ExpressionType.Parameter&&n("typeof "+t.name)!=="undefined"};this.resolve=function(t){var i=n(t.name);return Container.createConstantExpression(i,typeof i)}}});$C("$data.Expressions.LambdaParameterProcessor",$data.Expressions.ParameterProcessor,null,{constructor:function(n){var t={};this.canResolve=function(i){var r,u;if(i.nodeType==$data.Expressions.ExpressionType.LambdaParameter){if(r=i.owningFunction.parameters,r.length==1&&i.name==r[0].name)return t[i.name]=n[0],!0;for(u=0;u<r.length;u++)if(r[u].name==i.name)return t[i.name]=n[u],!0;return!1}return!1};this.resolve=function(n){var r=t[n.name],i=Container.createParameterExpression(n.name,r,$data.Expressions.ExpressionType.LambdaParameter);return i.owningFunction=n.owningFunction,i}}});$C("$data.Expressions.ParameterResolverVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){this.lambdaParamCache={}},Visit:function(n,t){return $data.Expressions.ExpressionVisitor.prototype.Visit.call(this,n,t)},VisitArrayLiteral:function(n,t){var r=this,i=n.items.map(function(n){return r.Visit(n,t)}),u=i.every(function(n){return n instanceof $data.Expressions.ConstantExpression});return u?(i=i.map(function(n){return n.value}),Container.createConstantExpression(i,"array")):Container.createArrayLiteralExpression(i)},VisitObjectLiteral:function(n,t){var f=this,i=n.members.map(function(n){return f.Visit(n,t)}),e=i.every(function(n){return n.expression instanceof $data.Expressions.ConstantExpression}),u,r;return e?(u=i.map(function(n){return{name:n.fieldName,value:n.expression.value}}),r=n.implementation(u),Container.createConstantExpression(r,typeof r)):Container.createObjectLiteralExpression(i)},VisitThis:function(n,t){return t.Visit(n,t)},VisitParameter:function(n,t){var i,r;switch(n.nodeType){case $data.Expressions.ExpressionType.Parameter:case $data.Expressions.ExpressionType.LambdaParameter:return i=t.Visit(n,t),i.nodeType==$data.Expressions.ExpressionType.LambdaParameter&&(this.lambdaParamCache[i.name]=i),i;case $data.Expressions.ExpressionType.LambdaParameterReference:if(r=this.lambdaParamCache[n.name],r)return i=Container.createParameterExpression(n.name,r.type,$data.Expressions.ExpressionType.LambdaParameterReference),i.paramIndex=n.paramIndex,i;break;default:return n}return n},VisitConstant:function(n){return n},VisitFunction:function(n,t){var i=this,r=n.parameters.map(function(n){return i.Visit(n,t)}),u=i.Visit(n.body,t);return new $data.Expressions.FunctionExpression(n.name,r,u)},VisitBinary:function(n,t){var i=this.Visit(n.left,t),r=this.Visit(n.right,t),f=$data.Expressions,u;return i instanceof f.ConstantExpression&&r instanceof f.ConstantExpression?(u=n.implementation(i.value,r.value),Container.createConstantExpression(u,typeof u)):new Container.createSimpleBinaryExpression(i,r,n.nodeType,n.operator,n.type)},VisitUnary:function(n,t){var i=this.Visit(n.operand,t),u=$data.Expressions,r;return i instanceof u.ConstantExpression?(r=n.operator.implementation(i.value),Container.createConstantExpression(r,typeof r)):new Container.createUnaryExpression(i,n.operator,n.nodeType)},VisitProperty:function(n,t){var i=this.Visit(n.expression,t),r=this.Visit(n.member,t),u;return i instanceof $data.Expressions.ConstantExpression&&r instanceof $data.Expressions.ConstantExpression?(u=n.implementation(i.value,r.value),Container.createConstantExpression(u,typeof u,i.name+"$"+r.value)):i===n.expression&&r===n.member?n:Container.createPropertyExpression(i,r)},VisitCall:function(n){function o(n,t,i){return t instanceof $data.Expressions.ConstantExpression&&(!i||i instanceof $data.Expressions.ConstantExpression)&&n.every(function(n){return n instanceof $data.Expressions.ConstantExpression})}function s(n){return n instanceof $data.Expressions.ConstantExpression?n.value:n}var i=$data.Expressions.ExpressionVisitor.prototype.VisitCall.apply(this,arguments),r=i.expression,f=i.member,e=i.args,t,u;return o(e,f,r)?(t=f.value,typeof t=="string"&&r.value&&(t=r.value[t]),typeof t!="function"&&Guard.raise("Constant expression is not a method..."),u=n.implementation(r.value,t,e.map(s)),new $data.Expressions.ConstantExpression(u,typeof u)):i}},{});$C("$data.Expressions.AggregatedVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(n){this.Visit=function(t,i){for(var u,r=0;r<n.length;r++)if(u=n[r].Visit(t,i),u!==t)return u;return t}}});$C("$data.Expressions.LogicalSchemaBinderVisitor",$data.Expressions.ExpressionVisitor,null,{constructor:function(){},VisitProperty:function(n,t){var r=this.Visit(n.expression,t),i=this.Visit(n.member,t),u=r.type,f=t.memberResolver.resolve(u,i.value);return i.type=f,Container.createPropertyExpression(r,i)}},{});$data.Class.define("$data.Expressions.ExpTreeVisitor",null,null,{constructor:function(){this._deep=0},Visit:function(n,t){this._deep=this._deep+1;var i=null;switch(n.type){case LITERAL:i=this.VisitLiteral(n,t);break;case VARIABLE:i=this.VisitVariable(n,t);break;case MEMBERACCESS:i=this.VisitMember(n,t);break;case BINARY:i=this.VisitBinary(n,t);break;case UNARY:i=this.VisitUnary(n,t);break;case INCDEC:i=this.VisitIncDec(n,t);break;case EQUALITY:i=this.VisitEquality(n,t);break;case DECISION:i=this.VisitDecision(n,t);break;case METHODCALL:i=this.VisitMethodCall(n,t);break;case NEW:i=this.VisitNew(n,t);break;case JSONASSIGN:i=this.VisitJsonAssign(n,t);break;case ARRAYACCESS:i=this.VisitArrayAccess(n,t);break;default:Guard.raise("Type isn't implemented: "+n.type)}return this._deep=this._deep-1,i},VisitLiteral:function(n){return n},VisitVariable:function(n){return n},VisitMember:function(n,t){var i=this.Visit(n.expression,t),r=this.Visit(n.member,t);return i===n.expression&&r===n.member?n:$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(n.executable,i,r)},VisitBinary:function(n,t){var i=this.Visit(n.left,t),r=this.Visit(n.right,t);return i===n.left&&r===n.right?n:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(n.executable,n.operator,i,r)},VisitUnary:function(n,t){var i=this.Visit(n.operand,t);return i===n.operand?n:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(n.executable,n.operator,i)},VisitIncDec:function(n,t){var i=this.Visit(n.operand,t);return i===n.operand?n:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(n.executable,n.operator,i,n.suffix)},VisitEquality:function(n,t){var i=this.Visit(n.left,t),r=this.Visit(n.right,t);return i===n.left&&r===n.right?n:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(n.executable,n.operator,i,r)},VisitDecision:function(n,t){var i=this.Visit(n.expression,t),r=this.Visit(n.left,t),u=this.Visit(n.right,t);return i===n.expression&&r===n.left&&u===n.right?n:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(n.executable,i,r,u)},VisitMethodCall:function(n,t){var i=n.object?this.Visit(n.object,t):null,r=this.VisitArray(n.args,t);return i===n.object&&r===n.args?n:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(n.executable,i,n.method,r)},VisitNew:function(n,t){var i=this.VisitArray(n.values,t);return i===n.values?n:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(!0,i)},VisitJsonAssign:function(n,t){var i=this.Visit(n.left,t),r=this.Visit(n.right,t);return i===n.left&&r===n.right?n:(i.JSONASSIGN=!0,r.JSONASSIGN=!0,$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(!0,i,r))},VisitArrayAccess:function(n,t){var i=this.Visit(n.array,t),r=this.Visit(n.index,t);return i===n.array&&r===n.index?n:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(!0,i,r)},VisitArray:function(n,t){for(var r=[],u=!0,i=0;i<n.length;i++)r[i]=this.Visit(n[i],t),u=u&&r[i]===n[i];return u?n:r},GetMemberChain:function(n,t){if(n.expression.type==MEMBERACCESS){var i=this.GetMemberChain(n.expression,t);return i.push(n.member),i}return[n.expression,n.member]}},{});$data.Class.define("$data.Expressions.SetExecutableVisitor",$data.Expressions.ExpTreeVisitor,null,{Visit:function(n,t){switch(n.type){case LITERAL:return this.VisitLiteral(n,t);case VARIABLE:return this.VisitVariable(n,t);case MEMBERACCESS:return this.VisitMember(n,t);case BINARY:return this.VisitBinary(n,t);case UNARY:return this.VisitUnary(n,t);case INCDEC:return this.VisitIncDec(n,t);case EQUALITY:return this.VisitEquality(n,t);case DECISION:return this.VisitDecision(n,t);case METHODCALL:return this.VisitMethodCall(n,t);case NEW:return this.VisitNew(n,t);case JSONASSIGN:return this.VisitJsonAssign(n,t);case ARRAYACCESS:return this.VisitArrayAccess(n,t);default:Guard.raise("Type isn't implemented: "+n.type)}},VisitBinary:function(n,t){var i=this.Visit(n.left,t),r=this.Visit(n.right,t);return i===n.left&&r===n.right&&i.executable&&r.executable==n.executable?n:$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(i.executable&&r.executable,n.operator,i,r)},VisitUnary:function(n,t){var i=this.Visit(n.operand,t);return i===n.operand?n:$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(i.executable,n.operator,i)},VisitIncDec:function(n,t){var i=this.Visit(n.operand,t);return i===n.operand?n:$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(i.executable,n.operator,i,n.suffix)},VisitEquality:function(n,t){var i=this.Visit(n.left,t),r=this.Visit(n.right,t);return i===n.left&&r===n.right&&i.executable&&r.executable==n.executable?n:$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(i.executable&&r.executable,n.operator,i,r)},VisitDecision:function(n,t){var i=this.Visit(n.expression,t),r=this.Visit(n.left,t),u=this.Visit(n.right,t);return i===n.expression&&r===n.left&&u===n.right&&r.executable&&u.executable&&i.executable==n.executable?n:$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(r.executable&&u.executable&&i.executable,i,r,u)},VisitMethodCall:function(n,t){var i=n.object?this.Visit(n.object,t):null,r=this.VisitArray(n.args,t);return i===n.object&&r===n.args&&(i==null?!0:i.executable)==n.executable?n:$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(i==null?!0:i.executable,i,n.method,r)},VisitNew:function(n,t){var i=this.VisitArray(n.values,t);return i===n.values?n:$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(!0,i)},VisitJsonAssign:function(n,t){var i=this.Visit(n.left,t),r=this.Visit(n.right,t);return i===n.left&&r===n.right?n:(i.JSONASSIGN=!0,r.JSONASSIGN=!0,$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(!0,i,r))},VisitArrayAccess:function(n,t){var i=this.Visit(n.array,t),r=this.Visit(n.index,t);return i===n.array&&r===n.index?n:$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(!0,i,r)},VisitArray:function(n,t){for(var r=[],u=!0,i=0;i<n.length;i++)r[i]=this.Visit(n[i],t),u=u&&r[i]===n[i];return u?n:r},VisitLiteral:function(n){return{type:n.type,executable:!0,value:n.value,valueType:n.valueType}},VisitVariable:function(n,t){return typeof t.paramContext[n.name]==undefined&&Guard.raise("Variable is not defined in the paramContext: "+n.name),$data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(!0,"Math","GLOBALOBJECT")},VisitMember:function(n,t){var u=this.GetMemberChain(n),i=u[0].name,f=t.lambdaParams.indexOf(i)>=0,r=i==t.paramsName;return r||f||Guard.raise("Variable is not defined in the paramContext or the lambda parameters: "+i),$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(r,n.expression,n.member)}},null);$data.Class.define("$data.Expressions.ExecutorVisitor",$data.Expressions.ExpTreeVisitor,null,{VisitVariable:function(n,t){if(!n.executable)return n;var i=n.name==t.paramsName?t.paramContext:window[n.name];return typeof i=="undefined"&&Guard.raise(new Exception("Unknown variable in '"+t.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+n.name+"'.","InvalidOperation",{operationName:t.operation,missingParameterName:n.name})),$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof i,i)},VisitMember:function(n,t){var u,r,i;if(!n.executable)return n;for(u=this.GetMemberChain(n),i=0;i<u.length;i++)r=i==0?t.paramContext:r[u[i].name];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof r,r)},VisitUnary:function(eNode,context){var operand=this.Visit(eNode.operand,context),value,src,operandValue;return(operand!==eNode.operand&&(eNode=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(eNode.executable,eNode.operator,operand)),!eNode.executable)?eNode:(operandValue=operand.valueType=="string"?"'"+operand.value+"'":operand.value,src="value = "+eNode.operator+" "+operandValue,eval(src),$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof value,value))},VisitIncDec:function(n,t){var i=this.Visit(n.operand,t),r;return(i!==n.operand&&(n=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(n.executable,n.operator,i,n.suffix)),!n.executable)?n:(r=n.suffix?n.operator=="++"?i.value++:i.value--:n.operator=="++"?++i.value:--i.value,$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof r,r))},VisitBinary:function(eNode,context){var left=this.Visit(eNode.left,context),right=this.Visit(eNode.right,context),value,src,leftValue,rightValue;return((left!==eNode.left||right!==eNode.right)&&(eNode=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(eNode.executable,eNode.operator,left,right)),!eNode.executable)?eNode:(leftValue=left.valueType=="string"?"'"+left.value+"'":left.value,rightValue=right.valueType=="string"?"'"+right.value+"'":right.value,src="value = "+leftValue+" "+eNode.operator+" "+rightValue,eval(src),$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof value,value))},VisitEquality:function(eNode,context){var left=this.Visit(eNode.left,context),right=this.Visit(eNode.right,context),value,src,leftValue,rightValue;return((left!==eNode.left||right!==eNode.right)&&(eNode=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(eNode.executable,eNode.operator,left,right)),!eNode.executable)?eNode:(leftValue=left.valueType=="string"?"'"+left.value+"'":left.value,rightValue=right.valueType=="string"?"'"+right.value+"'":right.value,src="value = "+leftValue+" "+eNode.operator+" "+rightValue,eval(src),$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof value,value))},VisitDecision:function(n,t){var i=this.Visit(n.expression,t),r=this.Visit(n.left,t),u=this.Visit(n.right,t),f;return((i!==n.expression||r!==n.left||u!==n.right)&&(n=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(n.executable,i,r,u)),!n.executable)?n:(f=i.value?r.value:u.value,$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof f,f))},VisitMethodCall:function(eNode,context){var object=eNode.object?this.Visit(eNode.object,context):null,args=this.VisitArray(eNode.args,context),a,i,arg,t,value,src;if((object!==eNode.object||args!=eNode.args)&&(eNode=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(eNode.executable,object,eNode.method,args)),!eNode.executable)return eNode;for(a=[],i=0;i<args.length;i++)arg=args[i],t=typeof arg.value,a.push(t=="string"?"'"+arg.value+"'":arg.value);return src=object?"value = object.value[eNode.method]("+a.join(",")+");":"value = "+eNode.method+"("+a.join(",")+");",eval(src),$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof value,value)},VisitArrayAccess:function(n,t){var r=this.Visit(n.array,t),u=this.Visit(n.index,t),i=r.value[u.value];return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,typeof i,i)}},null);$data.Class.define("$data.Expressions.ExpressionBuilder",null,null,{constructor:function(n){this.context=n},_isLambdaParam:function(n){for(var i=this.context.lambdaParams,t=0;t<i.length;t++)if(i[t]==n)return!0;return!1},_isParam:function(n){return this.context.paramContext[n]!=undefined},_isParamRoot:function(n){return this.context.paramsName==n},Build:function(n,t){var i;switch(n.arity){case"infix":"("==n.value?i=this.BuildMethodCall(n,t):"."==n.value?i=this.BuildMember(n,t):["===","==","!==","!=",">","<",">=","<="].indexOf(n.value)>=0?i=this.BuildEquality(n,t):["&&","||"].indexOf(n.value)>=0?i=this.BuildBinary(n,t):["+","-","*","/","%"].indexOf(n.value)>=0?i=this.BuildBinary(n,t):"["==n.value?i=this.BuildArrayAccess(n,t):Guard.raise("Value of infix node isn't implemented: "+n.value);break;case"prefix":["+","-","!"].indexOf(n.value)>=0?i=this.BuildUnary(n,t):["++","--"].indexOf(n.value)>=0?i=this.BuildIncDec(n,t):"{"==n.value?i=this.BuildNewExpression(n,t):Guard.raise("Value of prefix node isn't implemented: "+n.value);break;case"suffix":["++","--"].indexOf(n.value)>=0?i=this.BuildIncDec(n,t):Guard.raise("Value of suffix node isn't implemented: "+n.value);break;case"string":case"number":i=this.BuildLiteral(n,t);break;case"ternary":n.value=="?"?i=this.BuildDecision(n,t):Guard.raise("Value of ternary node isn't implemented: "+n.value);break;case null:case undefined:i=n.type=="boolean"&&(n.value=="true"||n.value=="false")?this.BuildBoolLiteral(n,t):this.BuildVariable(n,t);break;default:Guard.raise("Arity isn't implemented: "+n.arity)}return i},BuildNewExpression:function(n){for(var t=$data.Expressions.ExpressionNodeTypes.NewExpressionNode.create(!0,[]),r=n.first,i=0;i<r.length;i++)t.values.push(this.Build(r[i],t));return t},BuildLiteral:function(n){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,n.arity,n.value)},BuildBoolLiteral:function(n){return $data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,n.type,n.value=="true"?!0:!1)},BuildVariable:function(n,t){var i;if(!n.first)return t.type==MEMBERACCESS?i=this._isLambdaParam(n.value)?"LAMBDAPARAM":this._isParamRoot(n.value)?"PARAMETERROOT":this._isParam(n.value)?"PARAMETER":"PROPERTY":this._isLambdaParam(n.value)?i="LAMBDAPARAM":this._isParamRoot(n.value)?i="PARAMETERROOT":this._isParam(n.value)?i="PARAMETER":window[n.value]!=undefined?i="GLOBALOBJECT":Guard.raise(new Exception("Unknown variable in '"+this.context.operation+"' operation. The variable isn't referenced in the parameter context and it's not a global variable: '"+n.value+"'.","InvalidOperation",{operationName:this.context.operation,missingParameterName:n.value})),$data.Expressions.ExpressionNodeTypes.VariableExpressionNode.create(!0,n.value,i);var u=$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,"name",n.value),r=$data.Expressions.ExpressionNodeTypes.JsonAssignExpressionNode.create(!0),f=this.Build(n.first,r);return r.left=u,r.right=f,u.JSONASSIGN=!0,f.JSONASSIGN=!0,r},BuildMember:function(n){if(n.value!="."||n.arity!="infix")return n.type=="string"?$data.Expressions.ExpressionNodeTypes.LiteralExpressionNode.create(!0,n.arity,n.value):$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(!0,null,n.value);var t=$data.Expressions.ExpressionNodeTypes.MemberAccessExpressionNode.create(!0),i=this.Build(n.first,t),r=this.Build(n.second,t);return t.expression=i,t.member=r,t},BuildUnary:function(n){var t=$data.Expressions.ExpressionNodeTypes.UnaryExpressionNode.create(!0,n.value);return t.operand=this.Build(n.first,t),t},BuildIncDec:function(n){var t=$data.Expressions.ExpressionNodeTypes.IncDecExpressionNode.create(!0,n.value,null,n.arity=="suffix");return t.operand=this.Build(n.first,t),t},BuildBinary:function(n){n.first||Guard.raise("Cannot build binary: node.first is null");n.second||Guard.raise("Cannot build binary: node.second is null");var t=$data.Expressions.ExpressionNodeTypes.BinaryExpressionNode.create(!0,n.value);return t.left=this.Build(n.first,t),t.right=this.Build(n.second,t),t},BuildEquality:function(n){var t=$data.Expressions.ExpressionNodeTypes.EqualityExpressionNode.create(!0,n.value);return t.left=this.Build(n.first,t),t.right=this.Build(n.second,t),t},BuildDecision:function(n){var t=$data.Expressions.ExpressionNodeTypes.DecisionExpressionNode.create(!0);return t.expression=this.Build(n.first,t),t.left=this.Build(n.second,t),t.right=this.Build(n.third,t),t},BuildMethodCall:function(n){var t=$data.Expressions.ExpressionNodeTypes.MethodcallExpressionNode.create(!0),r,u,i,f;for(n.first.type=="function"?(t.object=this.Build(n.first.first,t),t.method=n.first.second.value):(n.first.type!=null&&Guard.raise("Cannot build MethodCall because type is "+type),t.object=null,t.method=n.first.value),r=n.second,u=[],i=0;i<r.length;i++)f=r[i],u[i]=this.Build(f,t);return t.args=u,t},BuildArrayAccess:function(n){var t=$data.Expressions.ExpressionNodeTypes.ArrayAccessExpressionNode.create(!0);return t.array=this.Build(n.first,t),t.index=this.Build(n.second,t),t}},null);$C("$data.Expressions.AssociationInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n){this.associationInfo=n},nodeType:{value:$data.Expressions.ExpressionType.AssociationInfo,enumerable:!0}});$C("$data.Expressions.CodeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t){Container.resolveType(Container.getTypeName(n))==$data.String&&n.replace(/^[\s\xA0]+/,"").match("^function")!="function"&&(n="function (it) { return "+n+"; }");this.source=n;this.parameters=t},nodeType:{value:$data.Expressions.ExpressionType.Code,enumerable:!0}});$C("$data.Expressions.CodeToEntityConverter",$data.Expressions.ExpressionVisitor,null,{constructor:function(n){this.scopeContext=n;this.parameters=[]},VisitBinary:function(n,t){var r=this.Visit(n.left,t),i=this.Visit(n.right,t),s,o,u,f,c,e,l,h,a,v;if((!(r instanceof $data.Expressions.ConstantExpression)&&i instanceof $data.Expressions.ConstantExpression||!(i instanceof $data.Expressions.ConstantExpression)&&r instanceof $data.Expressions.ConstantExpression)&&(i instanceof $data.Expressions.ConstantExpression?(s=r,o=i):(s=i,o=r),((u=s.selector)instanceof $data.Expressions.MemberInfoExpression||(u=s.operation)instanceof $data.Expressions.MemberInfoExpression)&&u.memberDefinition&&(u.memberDefinition.type||u.memberDefinition.dataType)&&(f=Container.resolveType(u.memberDefinition.type||u.memberDefinition.dataType),c=Container.resolveType(o.type),f!==c))){if(e=o.value,n.operator===$data.Expressions.ExpressionType.In)if(Array.isArray(e)){for(l=[],h=0;h<e.length;h++)l.push(new $data.Expressions.ConstantExpression(e[h],f));e=l;f=$data.Array}else f=c;i===o?i=new $data.Expressions.ConstantExpression(e,f,i.name):r=new $data.Expressions.ConstantExpression(e,f,r.name)}return a=this.scopeContext.resolveBinaryOperator(n.nodeType,n,t.frameType),v=Container.createSimpleBinaryExpression(r,i,n.nodeType,n.operator,n.type,a),v},VisitUnary:function(n,t){var i=this.Visit(n.operand,t),r=this.scopeContext.resolveUnaryOperator(n.nodeType,n,t.frameType);return Container.createUnaryExpression(i,n.operator,n.nodeType,r)},VisitParameter:function(n,t){var i;Guard.requireValue("context",t);i=$data.Expressions.ExpressionType;switch(n.nodeType){case i.LambdaParameterReference:return Container.createEntityExpression(t.lambdaParameters[n.paramIndex],{lambda:n.name});case i.LambdaParameter:break;default:Guard.raise("Global parameter "+n.name+" not found. For query parameters use 'this.field' notation")}},VisitThis:function(n,t){var i=this.parameters.push({name:"",value:undefined})-1;return Container.createQueryParameterExpression("",i,t.queryParameters,undefined)},VisitFunction:function(){var n=$data.Expressions.ExpressionVisitor.prototype.VisitFunction.apply(this,arguments);return n.body},VisitCall:function(n,t){var s=this,r=this.Visit(n.expression,t),i=this.Visit(n.member,t),f=n.args.map(function(n){return s.Visit(n,t)}),e,o,u;switch(!0){case r instanceof $data.Expressions.QueryParameterExpression:return o=f.map(function(n){return n.value}),e=n.implementation(r.value,i.value,o),Container.createQueryParameterExpression(r.name+"$"+i.value,r.index,e,typeof e);case r instanceof $data.Expressions.EntityFieldExpression:case r instanceof $data.Expressions.EntityFieldOperationExpression:return u=this.scopeContext.resolveFieldOperation(i.value,r,t.frameType),u||Guard.raise("Unknown entity field operation: "+i.getJSON()),i=Container.createMemberInfoExpression(u),Container.createEntityFieldOperationExpression(r,i,this._resolveFunctionArguments(f,u.parameters));case r instanceof $data.Expressions.EntitySetExpression:return u=this.scopeContext.resolveSetOperations(i.value,r,t.frameType),u||Guard.raise("Unknown entity field operation: "+i.getJSON()),i=Container.createMemberInfoExpression(u),Container.createFrameOperationExpression(r,i,this._resolveFunctionArguments(f,u.parameters));case r instanceof $data.Expressions.EntityExpression:return u=this.scopeContext.resolveTypeOperations(i.value,r,t.frameType),u||Guard.raise("Unknown entity function operation: "+i.getJSON()),i=Container.createMemberInfoExpression(u),Container.createEntityFunctionOperationExpression(r,i,this._resolveFunctionArguments(f,u.method.params));case r instanceof $data.Expressions.EntityContextExpression:return u=this.scopeContext.resolveContextOperations(i.value,r,t.frameType),u||Guard.raise("Unknown entity function operation: "+i.getJSON()),i=Container.createMemberInfoExpression(u),Container.createContextFunctionOperationExpression(r,i,this._resolveFunctionArguments(f,u.method.params));default:Guard.raise("VisitCall: Only fields can have operations: "+n.getType().name)}},_resolveFunctionArguments:function(n,t){return t&&(t=t.filter(function(n){return n.name!=="@expression"})),n.length===1&&n[0]instanceof $data.Expressions.ConstantExpression&&typeof n[0].value=="object"&&n[0].value&&t&&t[0]&&n[0].value.constructor===$data.Object&&t.some(function(t){return t.name in n[0].value})?t.map(function(t){var i=t.type||t.dataType||n[0].type;return new $data.Expressions.ConstantExpression(n[0].value[t.name],Container.resolveType(i),t.name)}):n.map(function(n,i){if(n instanceof $data.Expressions.ConstantExpression&&t&&t[i]){var r=t[i].type||t[i].dataType||n.type;return new $data.Expressions.ConstantExpression(n.value,Container.resolveType(r),t[i].name)}return n})},VisitProperty:function(n,t){var i=this.Visit(n.expression,t),r=this.Visit(n.member,t),u,a,f,s,h,e,c,o,l;Guard.requireType("member",r,$data.Expressions.ConstantExpression);switch(i.expressionType){case $data.Expressions.EntityExpression:u=i.getMemberDefinition(r.value);u||Guard.raise(new Exception("Unknown member: "+r.value,"MemberNotFound"));a=u.storageModel.PhysicalType.memberDefinitions.getMember(u.name);switch(a.kind){case"property":return f=Container.createMemberInfoExpression(u),Container.createEntityFieldExpression(i,f);case"navProperty":return(s=u.storageModel.Associations[u.name],h=Container.createEntitySetExpression(i,Container.createAssociationInfoExpression(s)),s.ToMultiplicity!=="*")?Container.createEntityExpression(h,{}):h;case"complexProperty":return f=Container.createMemberInfoExpression(u),Container.createComplexTypeExpression(i,f)}case $data.Expressions.ComplexTypeExpression:return(e=i.getMemberDefinition(r.value),e||Guard.raise("Unknown member "+r.value+" on "+i.entityType.name),c=Container.createMemberInfoExpression(e),Container.isPrimitiveType(Container.resolveType(e.dataType)))?Container.createEntityFieldExpression(i,c):Container.createComplexTypeExpression(i,c);case $data.Expressions.QueryParameterExpression:return o=n.implementation(i.value,r.value),this.parameters[i.index].name+="$"+r.value,this.parameters[i.index].value=o,Container.createQueryParameterExpression(i.name+"$"+r.value,i.index,o,Container.getTypeName(o));case $data.Expressions.EntityFieldExpression:case $data.Expressions.EntityFieldOperationExpression:return l=this.scopeContext.resolveFieldOperation(r.value,i,t.frameType),l||Guard.raise("Unknown entity field operation: "+r.getJSON()),r=Container.createMemberInfoExpression(l),Container.createEntityFieldOperationExpression(i,r,[]);default:Guard.raise("Unknown expression type to handle: "+i.expressionType.name)}}});$C("$data.Expressions.ComplexTypeExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t){Guard.requireType("source",n,[$data.Expressions.EntityExpression,$data.Expressions.ComplexTypeExpression]);Guard.requireType("selector",t,[$data.Expressions.EntityExpression,$data.Expressions.MemberInfoExpression]);this.source=n;this.selector=t;var i=n.entityType.getMemberDefinition(t.memberName).dataType,r=Container.resolveType(i);this.entityType=r},getMemberDefinition:function(n){return this.entityType.getMemberDefinition(n)},nodeType:{value:$data.Expressions.ExpressionType.Com}});$C("$data.Expressions.EntityContextExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n){this.instance=n},instance:{enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.EntityContext,enumerable:!0}});$C("$data.Expressions.EntityExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t){Guard.requireValue("source",n);Guard.requireValue("selector",t);n instanceof $data.Expressions.EntitySetExpression||n instanceof $data.Expressions.ServiceOperationExpression||Guard.raise("Only EntitySetExpressions can be the source for an EntityExpression");this.source=n;this.selector=t;this.entityType=this.source.elementType;this.storageModel=this.source.storageModel;Guard.requireValue("entityType",this.entityType);Guard.requireValue("storageModel",this.storageModel)},getMemberDefinition:function(n){var t=this.entityType.getMemberDefinition(n);return t||Guard.raise(new Exception("Unknown member "+n+" on type "+this.entityType.name,"MemberNotFound")),t.storageModel=this.storageModel,t},nodeType:{value:$data.Expressions.ExpressionType.Entity}});$C("$data.Expressions.EntityExpressionVisitor",null,null,{constructor:function(){this.lambdaTypes=[]},canVisit:function(n){return n instanceof $data.Expressions.ExpressionNode},Visit:function(n,t){var i,u,r;return this.canVisit(n)?(i="Visit"+n.getType().name,i in this)?(u=this[i],r=u.call(this,n,t),typeof r=="undefined")?n:r:n:n},VisitToArrayExpression:function(n,t){var i=this.Visit(n.source,t);return i!==n.source?Container.createToArrayExpression(i):n},VisitForEachExpression:function(n,t){var i=this.Visit(n.source,t);return i!==n.source?Container.createForEachExpression(i):n},VisitMemberInfoExpression:function(n){return n},VisitSingleExpression:function(n,t){var i=this.Visit(n.source,t);return i!==n.source?Container.createSingleExpression(i):n},VisitFirstExpression:function(n,t){var i=this.Visit(n.source,t);return i!==n.source?Container.createFirstExpression(i):n},VisitSomeExpression:function(n,t){var i=this.Visit(n.source,t);return i!==n.source?Container.createSomeExpression(i):n},VisitFindExpression:function(n,t){var i=this.Visit(n.source,t);return i!==n.source?Container.createFindExpression(i):n},VisitEveryExpression:function(n,t){var i=this.Visit(n.source,t);return i!==n.source?Container.createEveryExpression(i):n},VisitCountExpression:function(n,t){var i=this.Visit(n.source,t);return i!==n.source?Container.createCountExpression(i):n},VisitBatchDeleteExpression:function(n,t){var i=this.Visit(n.source,t);return i!==n.source?Container.createBatchDeleteExpression(i):n},VisitObjectLiteralExpression:function(n,t){for(var u=n.members.map(function(n){return this.Visit(n,t)},this),r=!0,i=0;i<n.members.length;i++)r=r&&n.members[i]===u[i];return r?n:Container.createObjectLiteralExpression(u)},VisitObjectFieldExpression:function(n,t){var i=this.Visit(n.expression,t);return n.expression!==i?Container.createObjectFieldExpression(n.fieldName,i):n},VisitIncludeExpression:function(n,t){var i=this.Visit(n.source,t);return i!==n.source?Container.createIncludeExpression(i,n.selector):n},VisitUnaryExpression:function(n,t){var i=this.Visit(n.operand,t);return n.operand!==i?Container.createUnaryExpression(i,n.operator,n.nodeType,n.resolution):n},VisitSimpleBinaryExpression:function(n,t){var i=this.Visit(n.left,t),r=this.Visit(n.right,t);return i!==n.left||r!==n.right?new $data.Expressions.SimpleBinaryExpression(i,r,n.nodeType,n.operator,n.type,n.resolution):n},VisitEntityContextExpression:function(n){return n},VisitCodeExpression:function(n){return n},VisitComplexTypeExpression:function(n,t){var i=this.Visit(n.source,t),r=this.Visit(n.selector,t);return i!==n.source||r!==n.selector?Container.createComplexTypeExpression(i,r):n},VisitEntityExpression:function(n,t){var i=this.Visit(n.source,t),r=this.Visit(n.selector,t);return i!==n.source||r!==n.selector?Container.createEntityExpression(i,r):n},VisitEntityFieldExpression:function(n,t){var i=this.Visit(n.source,t),r=this.Visit(n.selector,t);return i!==n.source||r!==n.selector?Container.createEntityFieldExpression(i,r):n},VisitEntityFieldOperationExpression:function(n,t){var i=this.Visit(n.source,t),r=this.Visit(n.operation,t),u=n.parameters.map(function(n){return this.Visit(n)},this);return Container.createEntityFieldOperationExpression(i,r,u)},VisitParametricQueryExpression:function(n,t){var i=this.Visit(n.expression,t),r=n.parameters.map(function(n){return this.Visit(n)},this);return Container.createParametricQueryExpression(i,r)},VisitEntitySetExpression:function(n,t){var i=this.Visit(n.source,t),r=this.Visit(n.selector,t);return i!==n.source||r!==n.selector?Container.createEntitySetExpression(i,r,n.params,n.instance):n},VisitInlineCountExpression:function(n,t){var i=this.Visit(n.source,t),r=this.Visit(n.selector,t);return i!==n.source||r!==n.selector?Container.createInlineCountExpression(i,r,n.params,n.instance):n},VisitFilterExpression:function(n,t){var i=this.Visit(n.source,t),r=this.Visit(n.selector,t);return i!==n.source||r!==n.selector?Container.createFilterExpression(i,r,n.params,n.instance):n},VisitProjectionExpression:function(n,t){var r=this.Visit(n.source,t),u=this.Visit(n.selector,t),i;return r!==n.source||u!==n.selector?(i=Container.createProjectionExpression(r,u,n.params,n.instance),i.projectionAs=n.projectionAs,i):n},VisitOrderExpression:function(n,t){var i=this.Visit(n.source,t),r=this.Visit(n.selector,t);return i!==n.source||r!==n.selector?Container.createOrderExpression(i,r,n.nodeType):n},VisitPagingExpression:function(n,t){var i=this.Visit(n.source,t),r=this.Visit(n.amount,t);return i!==n.source||r!==n.amount?Container.createPagingExpression(i,r,n.nodeType):n}});$C("$data.Expressions.ExpressionMonitor",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(n){this.Visit=function(t,i){var r=t,u,f,e;return this.canVisit(t)&&(n.VisitExpressionNode&&n.VisitExpressionNode.apply(n,arguments),u="Visit"+t.getType().name,u in n&&(r=n[u].apply(n,arguments))),f=arguments,r!==t&&(f=[r,i]),r=$data.Expressions.EntityExpressionVisitor.prototype.Visit.apply(this,f),f=[r,i],this.canVisit(r)&&(e=r.getType().name,n.MonitorExpressionNode&&n.MonitorExpressionNode.apply(n,f),u="Monitor"+e,u in n&&n[u].apply(n,f),n.MutateExpressionNode&&n.MutateExpressionNode.apply(n,f),u="Mutate"+e,u in n&&(r=n[u].apply(n,f))),r}}});$C("$data.Expressions.EntityFieldExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t){this.selector=t;this.source=n;(this.selector instanceof $data.Expressions.MemberInfoExpression||this.selector.name)&&(this.memberName=this.selector.name)},nodeType:{value:$data.Expressions.ExpressionType.EntityField}});$C("$data.Expressions.EntityFieldOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i){this.source=n;this.operation=t;this.parameters=i},nodeType:{value:$data.Expressions.ExpressionType.EntityFieldOperation}});$C("$data.Expressions.EntitySetExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i,r){function f(){for(var t=n;t;){if(t instanceof $data.Expressions.EntityContextExpression)return t;t=t.source}}Guard.requireType("source",n,[$data.Expressions.EntityContextExpression,$data.Expressions.EntitySetExpression]);Guard.requireType("selector",n,[$data.Expressions.MemberInfoExpression,$data.Expressions.CodeExpression,$data.Expressions.ParametricQueryExpression]);this.source=n;this.selector=t;this.params=i;this.instance=r;this.storage_type={};var u=f();switch(!0){case this.source instanceof $data.Expressions.EntityContextExpression:Guard.requireType("selector",t,$data.Expressions.MemberInfoExpression);this.elementType=t.memberDefinition.elementType;this.storageModel=u.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntityExpression:Guard.requireType("selector",t,$data.Expressions.AssociationInfoExpression);this.elementType=t.associationInfo.ToType;this.storageModel=u.instance._storageModel.getStorageModel(this.elementType);break;case this.source instanceof $data.Expressions.EntitySetExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;case this.source instanceof $data.Expressions.ServiceOperationExpression:this.elementType=this.source.elementType;this.storageModel=this.source.storageModel;break;default:Guard.raise("take and skip must be the last expressions in the chain!")}},instance:{enumerable:!1},nodeType:{value:$data.Expressions.ExpressionType.EntitySet,enumerable:!0}});$C("$data.Expressions.FrameOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i){this.source=n;this.operation=t;this.parameters=i},nodeType:{value:$data.Expressions.ExpressionType.FrameOperation}});$C("$data.Expressions.EntityFunctionOperationExpression",$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.EntityFunctionOperation}});$C("$data.Expressions.ContextFunctionOperationExpression",$data.Expressions.FrameOperationExpression,null,{nodeType:{value:$data.Expressions.ExpressionType.ContextFunctionOperation}});$C("$data.Expressions.FilterExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.Filter,enumerable:!0}});$C("$data.Expressions.InlineCountExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.InlineCount,enumerable:!0}});$C("$data.Expressions.FrameOperator",$data.Expressions.ExpressionNode,null,{constructor:function(){this.isTerminated=!0}});$C("$data.Expressions.CountExpression",$data.Expressions.FrameOperator,null,{constructor:function(n){this.source=n;this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.Count,enumerable:!0}});$C("$data.Expressions.SingleExpression",$data.Expressions.FrameOperator,null,{constructor:function(n){this.source=n;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Single,enumerable:!0}});$C("$data.Expressions.FindExpression",$data.Expressions.FrameOperator,null,{constructor:function(n,t){this.source=n;this.params=t;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Find,enumerable:!0}});$C("$data.Expressions.FirstExpression",$data.Expressions.FrameOperator,null,{constructor:function(n){this.source=n;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.First,enumerable:!0}});$C("$data.Expressions.ForEachExpression",$data.Expressions.FrameOperator,null,{constructor:function(n){this.source=n;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ForEach,enumerable:!0}});$C("$data.Expressions.ToArrayExpression",$data.Expressions.FrameOperator,null,{constructor:function(n){this.source=n;this.resultType=$data.Array},nodeType:{value:$data.Expressions.ExpressionType.ToArray,enumerable:!0}});$C("$data.Expressions.SomeExpression",$data.Expressions.FrameOperator,null,{constructor:function(n){this.source=n;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Some,enumerable:!0}});$C("$data.Expressions.EveryExpression",$data.Expressions.FrameOperator,null,{constructor:function(n){this.source=n;this.resultType=$data.Object},nodeType:{value:$data.Expressions.ExpressionType.Every,enumerable:!0}});$C("$data.Expressions.BatchDeleteExpression",$data.Expressions.FrameOperator,null,{constructor:function(n){this.source=n;this.resultType=$data.Integer},nodeType:{value:$data.Expressions.ExpressionType.BatchDelete,enumerable:!0}});$C("$data.Expressions.IncludeExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.Include,writable:!0},toString:function(){return"unimplemented"}},null);$C("$data.Expressions.MemberInfoExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n){this.memberDefinition=n;this.memberName=n.name},nodeType:{value:$data.Expressions.ExpressionType.MemberInfo,enumerable:!0}});$C("$data.Expressions.OrderExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(n,t,i){this.nodeType=i},nodeType:{value:$data.Expressions.ExpressionType.OrderBy,writable:!0},toString:function(){return"unimplemented"}},null);$C("$data.Expressions.ParametricQueryExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t){this.expression=n;this.parameters=t||[]},nodeType:{value:$data.Expressions.ExpressionType.ParametricQuery,enumerable:!0}});$C("$data.Expressions.ProjectionExpression",$data.Expressions.EntitySetExpression,null,{constructor:function(){},nodeType:{value:$data.Expressions.ExpressionType.Projection,enumerable:!0}});$C("$data.Expressions.QueryExpressionCreator",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(n){Guard.requireValue("scopeContext",n);this.scopeContext=n},VisitEntitySetExpression:function(n){return n.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(n),n},VisitServiceOperationExpression:function(n){return n.source instanceof $data.Expressions.EntityContextExpression&&this.lambdaTypes.push(n),n},VisitCodeExpression:function(n,t){var o=n.source.toString(),i=Container.createCodeParser(this.scopeContext).createExpression(o),r,u;this.scopeContext.log({event:"JSCodeExpression",data:i});r=Container.createConstantValueResolver(n.parameters,window,this.scopeContext);u=Container.createParameterResolverVisitor();i=u.Visit(i,r);this.scopeContext.log({event:"JSCodeExpressionResolved",data:i});var f=Container.createCodeToEntityConverter(this.scopeContext),e=f.Visit(i,{queryParameters:n.parameters,lambdaParameters:this.lambdaTypes,frameType:t.frameType}),s=Container.createParametricQueryExpression(e,f.parameters);return this.scopeContext.log({event:"EntityExpression",data:e}),s},VisitFilterExpression:function(n,t){var r=this.Visit(n.source,t),i;return(t=t||{},t.frameType=n.getType(),i=this.Visit(n.selector,t),r!==n.source||i!==n.selector)?Container.createFilterExpression(r,i,n.params,n.instance):n},VisitInlineCountExpression:function(n,t){var r=this.Visit(n.source,t),i;return(t=t||{},t.frameType=n.getType(),i=this.Visit(n.selector,t),r!==n.source||i!==n.selector)?Container.createInlineCountExpression(r,i,n.params,n.instance):n},VisitProjectionExpression:function(n,t){var u=this.Visit(n.source,t),i,r;return(t=t||{},t.frameType=n.getType(),i=this.Visit(n.selector,t),u!==n.source||i!==n.selector)?(r=Container.createProjectionExpression(u,i,n.params,n.instance),r.projectionAs=n.projectionAs,r):n},VisitOrderExpression:function(n,t){var r=this.Visit(n.source,t),i;return(t=t||{},t.frameType=n.getType(),i=this.Visit(n.selector,t),r!==n.source||i!==n.selector)?Container.createOrderExpression(r,i,n.nodeType):n}});$C("$data.Expressions.QueryParameterExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i){this.name=n;this.index=t;this.value=i;this.type=Container.getTypeName(i)},nodeType:{value:$data.Expressions.ExpressionType.QueryParameter,writable:!1}});$C("$data.Expressions.RepresentationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(){},getMemberDefinition:function(n){return this.entityType.getMemberDefinition(n)},nodeType:{value:$data.Expressions.ExpressionType.Entity}});$C("$data.Expressions.ServiceOperationExpression",$data.Expressions.ExpressionNode,null,{constructor:function(n,t,i,r,u){function f(){for(var t=n;t;){if(t instanceof $data.Expressions.EntityContextExpression)return t;t=t.source}}Guard.requireType("source",n,[$data.Expressions.EntityContextExpression]);Guard.requireType("selector",n,[$data.Expressions.MemberInfoExpression]);this.source=n;this.selector=t;this.params=i;this.cfg=r;this.boundItem=u;var e=f();switch(!0){case this.source instanceof $data.Expressions.EntityContextExpression:this.elementType=r.elementType?Container.resolveType(r.elementType):this.elementType?Container.resolveType(r.returnType):null;this.storageModel=r.elementType?e.instance._storageModel.getStorageModel(Container.resolveType(r.elementType)):null;break;default:Guard.raise("Unknown source type for EntitySetExpression: "+this.source.getType().name)}},nodeType:{value:$data.Expressions.ExpressionType.ServiceOperation,enumerable:!0}});$C("$data.Expressions.ContinuationExpressionBuilder",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(n){this.mode=n},compile:function(n){var t={mode:"find",skipExists:!1},i,u,r;return this.Visit(n.expression,t),i={skip:t.skipSize,take:t.pageSize,message:""},"pageSize"in t?(r={mode:this.mode,pageSize:t.pageSize},!t.skipExists&&t.pageSize?(r.append=!0,u=this.Visit(n.expression,r)):t.skipExists&&(u=this.Visit(n.expression,r)),r.abort?(i.skip=(i.skip||0)-i.take,i.message="Invalid skip value!"):i.expression=u):i.message="take expression not defined in the chain!",i},VisitPagingExpression:function(n,t){var r,i;switch(t.mode){case"find":n.nodeType===$data.Expressions.ExpressionType.Take?t.pageSize=n.amount.value:(t.skipSize=n.amount.value,t.skipExists=!0);break;case"prev":if(n.nodeType===$data.Expressions.ExpressionType.Skip)return r=n.amount.value-t.pageSize,t.abort=r<0&&n.amount.value>=t.pageSize,i=Container.createConstantExpression(Math.max(r,0),"number"),Container.createPagingExpression(n.source,i,n.nodeType);t.append&&(t.abort=!0);break;case"next":if(n.nodeType===$data.Expressions.ExpressionType.Skip)return r=t.pageSize+n.amount.value,i=Container.createConstantExpression(r,"number"),Container.createPagingExpression(n.source,i,n.nodeType);if(t.append)return i=Container.createConstantExpression(t.pageSize,"number"),Container.createPagingExpression(n,i,$data.Expressions.ExpressionType.Skip)}this.Visit(n.source,t)}});$data.Class.define("$data.Validation.ValidationError",null,null,{constructor:function(n,t,i){this.Message=n;this.PropertyDefinition=t;this.Type=i},Type:{dataType:"string"},Message:{dataType:"string"},PropertyDefinition:{dataType:$data.MemberDefinition}},null);$data.Class.define("$data.Validation.EntityValidationBase",null,null,{ValidateEntity:function(){return[]},ValidateEntityField:function(){return[]},getValidationValue:function(){Guard.raise("Pure class")},getValidationMessage:function(){Guard.raise("Pure class")}},null);$data.Validation=$data.Validation||{};$data.Validation.Entity=new $data.Validation.EntityValidationBase;$data.Class.define("$data.Validation.Defaults",null,null,null,{validators:{value:{required:function(n){return!Object.isNullOrUndefined(n)},customValidator:function(n,t){return Object.isNullOrUndefined(n)||typeof t=="function"?t(n):!0},minValue:function(n,t){return Object.isNullOrUndefined(n)||n>=t},maxValue:function(n,t){return Object.isNullOrUndefined(n)||n<=t},minLength:function(n,t){return Object.isNullOrUndefined(n)||n.length>=t},maxLength:function(n,t){return Object.isNullOrUndefined(n)||n.length<=t},length:function(n,t){return Object.isNullOrUndefined(n)||n.length==t},regex:function(n,t){return Object.isNullOrUndefined(n)||n.match(typeof t=="string"?new RegExp(t.indexOf("/")===0&&t.lastIndexOf("/")===t.length-1?t.slice(1,-1):t):t)}}},_getGroupValidations:function(n){var r={},t,i;if(Array.isArray(n))for(t=0;t<n.length;t++)i=n[t],typeof this.validators[i]=="function"&&(r[i]=this.validators[i]);return r}});$data.Class.define("$data.Validation.EntityValidation",$data.Validation.EntityValidationBase,null,{ValidateEntity:function(n){var t=[];return n.getType().memberDefinitions.getPublicMappedProperties().forEach(function(i){t=t.concat(this.ValidateEntityField(n,i,undefined,!0))},this),t},ValidateEntityField:function(n,t,i,r){var f=[],u=Container.resolveType(t.dataType),e=Container.resolveName(u),o=r?n[t.name]:i;return!t.inverseProperty&&u&&typeof u.isAssignableTo=="function"&&u.isAssignableTo($data.Entity)&&(e=$data.Entity.fullName),this.fieldValidate(n,t,o,f,e),f},getValidationValue:function(n,t){var i,r;return i=n[t]&&n[t].value?n[t].value:n[t],this.convertableValidation[t]&&(r=this.convertableValidation[t]===!0?n.type:this.convertableValidation[t],r&&(i=Container.convertTo(i,r,n.elementType))),i},getValidationMessage:function(n,t,i){var r=i;return typeof n[t]=="object"&&n[t].message?r=n[t].message:n.errorMessage&&(r=n.errorMessage),r},createValidationError:function(n,t,i){return new $data.Validation.ValidationError(this.getValidationMessage(n,t,i),n,t)},convertableValidation:{value:{required:"$data.Boolean",minValue:!0,maxValue:!0,minLength:"$data.Integer",maxLength:"$data.Integer",length:"$data.Integer"}},supportedValidations:{value:{"$data.ObjectID":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Byte":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.SByte":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Decimal":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Float":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Number":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Int16":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Integer":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Int32":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Int64":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.String":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minLength","maxLength","length","regex"]),"$data.Date":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.DateTimeOffset":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Time":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minValue","maxValue"]),"$data.Boolean":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Array":$data.Validation.Defaults._getGroupValidations(["required","customValidator","length"]),"$data.Object":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Guid":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.Blob":$data.Validation.Defaults._getGroupValidations(["required","customValidator","minLength","maxLength","length"]),"$data.GeographyPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyMultiPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyMultiLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyMultiPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeographyCollection":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiPoint":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiLineString":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryMultiPolygon":$data.Validation.Defaults._getGroupValidations(["required","customValidator"]),"$data.GeometryCollection":$data.Validation.Defaults._getGroupValidations(["required","customValidator"])}},fieldValidate:function(n,t,i,r,u){var f,e;n.entityState==$data.EntityState.Modified&&n.changedProperties&&n.changedProperties.indexOf(t)<0||(f=this.supportedValidations[u],f&&(e=Object.keys(f),e.forEach(function(u){t[u]&&f[u]&&!f[u].call(n,i,this.getValidationValue(t,u))&&r.push(this.createValidationError(t,u,"Validation error!"))},this),u===$data.Entity.fullName&&i instanceof $data.Entity&&!i.isValid()&&r.push(this.createValidationError(t,"ComplexProperty","Validation error!"))))}},null);$data.Validation.Entity=new $data.Validation.EntityValidation;$data.Class.define("$data.Notifications.ChangeDistributorBase",null,null,{distributeData:function(){Guard.raise("Pure class")}},null);$data.Class.define("$data.Notifications.ChangeCollectorBase",null,null,{buildData:function(){Guard.raise("Pure class")},processChangedData:function(n){this.Distrbutor&&this.Distrbutor.distributeData&&this.Distrbutor.distributeData(this.buildData(n))},Distrbutor:{enumerable:!1,dataType:$data.Notifications.ChangeDistributorBase,storeOnObject:!0}},null);$data.Class.define("$data.Notifications.ChangeDistributor",$data.Notifications.ChangeDistributorBase,null,{constructor:function(n){this.broadcastUrl=n},distributeData:function(n){$data.ajax({url:this.broadcastUrl,type:"POST",data:"data="+JSON.stringify(n),succes:this.success,error:this.error})},broadcastUrl:{dataType:"string"},success:function(){},error:function(){}},null);$data.Class.define("$data.Notifications.ChangeCollector",$data.Notifications.ChangeCollectorBase,null,{buildData:function(n){var t=[];return n.forEach(function(n){var r={entityState:n.data.entityState,typeName:n.data.getType().name},i=[];switch(n.data.entityState){case $data.EntityState.Added:i=n.data.getType().memberDefinitions.getPublicMappedProperties();break;case $data.EntityState.Modified:i=n.data.changedProperties;break;case $data.EntityState.Deleted:i=n.data.getType().memberDefinitions.getKeyProperties()}i.forEach(function(t){r[t.name]=n.data[t.name]});t.push(r)}),t}},null);$data.Class.define("$data.Transaction",null,null,{constructor:function(){this._objectId=(new Date).getTime();$data.Trace.log("create: ",this._objectId);this.oncomplete=new $data.Event("oncomplete",this);this.onerror=new $data.Event("onerror",this)},abort:function(){Guard.raise(new Exception("Not Implemented","Not Implemented",arguments))},_objectId:{type:$data.Integer},transaction:{type:$data.Object},oncomplete:{type:$data.Event},onerror:{type:$data.Event}},null);$data.Class.define("$data.Access",null,null,{},{isAuthorized:function(n,t,i,r){var u=new $data.PromiseHandler,f=u.createCallback(r),e=u.getPromise();return f.success(!0),e},getAccessBitmaskFromPermission:function(n){var t=$data.Access.None;return n.Create&&(t|=$data.Access.Create),n.Read&&(t|=$data.Access.Read),n.Update&&(t|=$data.Access.Update),n.Delete&&(t|=$data.Access.Delete),n.DeleteBatch&&(t|=$data.Access.DeleteBatch),n.Execute&&(t|=$data.Access.Execute),t},None:{value:0},Create:{value:1},Read:{value:2},Update:{value:4},Delete:{value:8},DeleteBatch:{value:16},Execute:{value:32}});$data.Class.define("$data.Promise",null,null,{always:function(){Guard.raise(new Exception("$data.Promise.always","Not implemented!"))},done:function(){Guard.raise(new Exception("$data.Promise.done","Not implemented!"))},fail:function(){Guard.raise(new Exception("$data.Promise.fail","Not implemented!"))},isRejected:function(){Guard.raise(new Exception("$data.Promise.isRejected","Not implemented!"))},isResolved:function(){Guard.raise(new Exception("$data.Promise.isResolved","Not implemented!"))},pipe:function(){Guard.raise(new Exception("$data.Promise.pipe","Not implemented!"))},progress:function(){Guard.raise(new Exception("$data.Promise.progress","Not implemented!"))},promise:function(){Guard.raise(new Exception("$data.Promise.promise","Not implemented!"))},state:function(){Guard.raise(new Exception("$data.Promise.state","Not implemented!"))},then:function(){Guard.raise(new Exception("$data.Promise.then","Not implemented!"))}},null);$data.Class.define("$data.PromiseHandlerBase",null,null,{constructor:function(){},createCallback:function(n){return n=$data.typeSystem.createCallbackSetting(n),cbWrapper={success:n.success,error:n.error,notify:n.notify}},getPromise:function(){return new $data.Promise}},null);$data.PromiseHandler=$data.PromiseHandlerBase;EventSubscriber=$data.Class.define("EventSubscriber",null,null,{constructor:function(n,t,i){this.handler=n;this.state=t;this.thisArg=i},handler:{},state:{},thisArg:{}});$data.Event=Event=$data.Class.define("$data.Event",null,null,{constructor:function(n,t){function r(n,t){n.forEach(function(i,r){i.handler==t&&n.splice(r,1)})}var i=null,u=t;this.attach=function(n,r,u){i||(i=[]);i.push(new EventSubscriber(n,r,u||t))};this.detach=function(n){r(i,n)};this.fire=function(n,r){var u=r||t||this;i&&i.forEach(function(t){try{t.handler.call(t.thisArg,u,n,t.state)}catch(i){console.log("unhandled exception in event handler. exception suppressed");console.dir(i)}})};this.fireCancelAble=function(n,r){var f=r||t||this,u=!0;return i&&i.forEach(function(t){try{u=u&&(t.handler.call(t.thisArg,f,n,t.state)===!1?!1:!0)}catch(i){console.log("unhandled exception in event handler. exception suppressed");console.dir(i)}}),u}}});var eventData=$data.Class.define("EventData",null,null,{eventName:{}}),PropertyChangeEventData=$data.Class.define("PropertyChangeEventData",EventData,null,{constructor:function(n,t,i){this.propertyName=n;this.oldValue=t;this.newValue=i},propertyName:{},oldValue:{},newValue:{}}),PropertyValidationEventData=$data.Class.define("PropertyValidationEventData",EventData,null,{constructor:function(n,t,i,r){this.propertyName=n;this.oldValue=t;this.newValue=i;this.errors=r;this.cancel=!1},propertyName:{},oldValue:{},newValue:{},errors:{},cancel:{}});$data.Entity=Entity=$data.Class.define("$data.Entity",null,null,{constructor:function(n,t){var i,s,f,h,r,o;if(this.initData={},i=this.getType(),i.__copyPropertiesToInstance&&$data.typeSystem.writePropertyValues(this),s=null,this.context=s,"setDefaultValues"in i&&(t&&t.setDefaultValues===!1||(!n||Object.keys(n).length<1)&&(n=i.setDefaultValues(n))),typeof n=="object"){f=i.memberDefinitions;h=f.getPublicMappedPropertyNames();for(r in n)if(h.indexOf(r)>-1){var e=f.getMember(r),c=Container.resolveType(e.type),u=n[r];e.concurrencyMode===$data.ConcurrencyMode.Fixed?this.initData[r]=u:(t&&t.converters&&(o=t.converters[Container.resolveName(c)],o&&(u=o(u))),this.initData[r]=Container.convertTo(u,c,e.elementType,t))}}t&&t.entityBuilder&&t.entityBuilder(this,i.memberDefinitions.asArray(),i);this.changedProperties=undefined;this.entityState=undefined},toString:function(){return this.getType().fullName+"("+(this.Id||this.Name||"")+")"},toJSON:function(){var n={},t=this;return this.getType().memberDefinitions.getPublicMappedProperties().forEach(function(i){n[i.name]=t[i.name]instanceof Date&&i.type&&Container.resolveType(i.type)===$data.DateTimeOffset?new $data.DateTimeOffset(t[i.name]):t[i.name]}),n},equals:function(n){var i,t;if(n.getType()!==this.getType())return!1;for(i=this.getType().memberDefinitions.getKeyProperties(),t=0;t<i.length;t++)if(this[i[t].name]!=n[i[t].name])return!1;return!0},propertyChanging:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){return this._propertyChanging||(this._propertyChanging=new Event("propertyChanging",this)),this._propertyChanging},set:function(n){this._propertyChanging=n}},propertyChanged:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){return this._propertyChanged||(this._propertyChanged=new Event("propertyChanged",this)),this._propertyChanged},set:function(n){this._propertyChanged=n}},propertyValidationError:{dataType:$data.Event,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,prototypeProperty:!0,get:function(){return this._propertyValidationError||(this._propertyValidationError=new Event("propertyValidationError",this)),this._propertyValidationError},set:function(n){this._propertyValidationError=n}},storeProperty:function(n,t){var i,f,r,u,e;(n.concurrencyMode!==$data.ConcurrencyMode.Fixed&&(t=Container.convertTo(t,n.type,n.elementType)),i=null,n.monitorChanges!=!1&&(this._propertyChanging||this._propertyChanged||"instancePropertyChanged"in this.constructor)&&(r=this[n.name],i=new PropertyChangeEventData(n.name,r,t),this._propertyChanging&&this.propertyChanging.fire(i)),n.monitorChanges!=!1&&(this._propertyValidationError||"instancePropertyValidationError"in this.constructor)&&(f=$data.Validation.Entity.ValidateEntityField(this,n,t),f.length>0&&(r=this[n.name],u=new PropertyValidationEventData(n.name,r,t,f),this._propertyValidationError&&this.propertyValidationError.fire(u),"instancePropertyValidationError"in this.constructor&&this.constructor.instancePropertyValidationError.fire(u,this),u.cancel==!0)))||(n.storeOnObject==!0?(e="_"+n.name,this[e]=t):this.initData[n.name]=t,this.isValidated=!1,n.monitorChanges!=!1&&this.entityState==$data.EntityState.Unchanged&&(this.entityState=$data.EntityState.Modified),this._setPropertyChanged(n),n.monitorChanges!=!1&&(this._propertyChanged&&this.propertyChanged.fire(i),"instancePropertyChanged"in this.constructor&&this.constructor.instancePropertyChanged.fire(i,this)))},_setPropertyChanged:function(n){n.monitorChanges!=!1&&(this.changedProperties||(this.changedProperties=[]),this.changedProperties.some(function(t){return t.name==n.name})||this.changedProperties.push(n))},retrieveProperty:function(n){if(n.storeOnObject==!0){var t="_"+n.name;return this[t]}return this.initData[n.name]},getProperty:function(n,t,i){var u,f,r,e;if(t=$data.typeSystem.createCallbackSetting(t),this[n.name]!=undefined){i instanceof $data.Transaction?t.success(this[n.name],i):t.success(this[n.name]);return}if(u=this.context,this.context)return u.loadItemProperty(this,n,t,i);try{if(f=this,r=this.storeToken||this.getType().storeToken,r&&typeof r.factory=="function")return e=r.factory(),e.onReady().then(function(i){return i.loadItemProperty(f,n,t)})}catch(o){}Guard.raise(new Exception("Entity not in context","Invalid operation"))},setProperty:function(n,t,i){this[n.name]=t;var r=new $data.PromiseHandler;return i=r.createCallback(i),i.success(this[n.name]),r.getPromise()},isValid:function(){return this.isValidated||(this.ValidationErrors=$data.Validation.Entity.ValidateEntity(this),this.isValidated=!0),this.ValidationErrors.length==0},isValidated:{dataType:"bool",storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1,value:!1},ValidationErrors:{dataType:Array,elementType:$data.Validation.ValidationError,storeOnObject:!0,monitorChanges:!0,notMapped:!0,enumerable:!1},resetChanges:function(){delete this._changedProperties},changedProperties:{dataType:Array,elementType:window.MemberDefinition,storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},entityState:{dataType:"integer",storeOnObject:!0,monitorChanges:!1,notMapped:!0,enumerable:!1},remove:function(){if($data.ItemStore&&"EntityInstanceRemove"in $data.ItemStore)return $data.ItemStore.EntityInstanceRemove.apply(this,arguments);throw"not implemented";},save:function(){if($data.ItemStore&&"EntityInstanceSave"in $data.ItemStore)return $data.ItemStore.EntityInstanceSave.apply(this,arguments);throw"not implemented";},refresh:function(){if($data.ItemStore&&"EntityInstanceSave"in $data.ItemStore)return $data.ItemStore.EntityInstanceRefresh.apply(this,arguments);throw"not implemented";},storeToken:{type:Object,monitorChanges:!1,notMapped:!0,storeOnObject:!0},getFieldUrl:function(n){var i,t;if(this.context)return this.context.getFieldUrl(this,n);if(this.getType().storeToken&&typeof this.getType().storeToken.factory=="function")return i=this.getType().storeToken.factory(),i.getFieldUrl(this,n);if(this.getType().storeToken)try{if(t=$data.ItemStore._getContextPromise("default",this.getType()),t instanceof $data.EntityContext)return t.getFieldUrl(this,n)}catch(r){}return"#"}},{__setPropertyfunctions:{value:!0,notMapped:!0,enumerable:!1,storeOnObject:!0},__copyPropertiesToInstance:{value:!1,notMapped:!0,enumerable:!1,storeOnObject:!0},inheritedTypeProcessor:function(n){$data.ItemStore&&"EntityInheritedTypeProcessor"in $data.ItemStore&&$data.ItemStore.EntityInheritedTypeProcessor.apply(this,arguments);n.defaultValues={};n.memberDefinitions.asArray().forEach(function(t){t.hasOwnProperty("defaultValue")&&(n.defaultValues[t.name]=t.defaultValue)});Object.keys(n.defaultValues).length>0&&(n.setDefaultValues=function(t,i){var u,r,f;t=t||{};u=n.defaultValues;for(r in u)r in t||(f=u[r],t[r]="function"==typeof f?u[r](r,i):u[r]);return t})},addEventListener:function(n,t){var i="on"+n;i in this||(this[i]=new $data.Event(n,this));this[i].attach(t)},removeEventListener:function(n,t){var i="on"+n;i in this&&this[i].detach(t)},raiseEvent:function(n,t){var i="on"+n;i in this&&this[i].fire(t)},getFieldNames:function(){return this.memberDefinitions.getPublicMappedPropertyNames()},"from$data.Object":function(n,t,i,r){if(Object.isNullOrUndefined(n))return n;var u;return r&&r.converters&&(u={converters:r.converters}),new this(n,u)}});$data.define=function(n,t,i){var u,e;if(!t||t instanceof $data.ContainerClass||(i=t,t=undefined),!i)throw new Error("json object type is not supported yet");var r={},f=[];if(Object.keys(i).forEach(function(n){var t=i[n];typeof t=="object"&&("type"in t||"get"in t||"set"in t)?(r[n]=t,t.key&&f.push(t),!("get"in t||"set"in t)||"notMapped"in t&&t.notMapped!==!0||(t.notMapped=!0,t.storeOnObject=!0),"get"in t&&!("set"in t)?t.set=function(){}:"set"in t&&!("get"in t)&&(t.get=function(){})):r[n]={type:t}}),f.length<1){switch(!0){case"id"in r:u="id";break;case"Id"in r:u="Id";break;case"ID"in r:u="ID"}u?(r[u].key=!0,e=$data.Container.resolveName(r[u].type),r[u].computed=!0):r.Id={type:"int",key:!0,computed:!0}}return $data.Entity.extend(n,t,r)};$data.implementation=function(n){return Container.resolveType(n)},function(){$data.defaults=$data.defaults||{};$data.defaults.defaultDatabaseName="JayDataDefault"}();$data.Class.define("$data.StorageModel",null,null,{constructor:function(){this.ComplexTypes=[];this.Associations=[]},LogicalType:{},LogicalTypeName:{},PhysicalType:{},PhysicalTypeName:{},EventHandlers:{},TableName:{},TableOptions:{value:undefined},ComplexTypes:{},Associations:{},ContextType:{},Roles:{}},null);$data.Class.define("$data.Association",null,null,{constructor:function(n){n&&(this.From=n.From,this.FromType=n.FromType,this.FromMultiplicity=n.FromMultiplicity,this.FromPropertyName=n.FromPropertyName,this.To=n.To,this.ToType=n.ToType,this.ToMultiplicity=n.ToMultiplicity,this.ToPropertyName=n.ToPropertyName)},From:{},FromType:{},FromMultiplicity:{},FromPropertyName:{},To:{},ToType:{},ToMultiplicity:{},ToPropertyName:{},ReferentialConstraint:{}},null);$data.Class.define("$data.ComplexType",$data.Association,null,{},null);$data.Class.define("$data.EntityContext",null,null,{constructor:function(n){var t,i,r;$data.ItemStore&&"ContextRegister"in $data.ItemStore&&$data.ItemStore.ContextRegister.apply(this,arguments);n.queryCache&&(this.queryCache=n.queryCache);"string"==typeof n&&(n=0===n.indexOf("http")?{name:"oData",oDataServiceHost:n}:{name:"local",databaseName:n});"provider"in n&&(n.name=n.provider);this.lazyLoad=!1;this.trackChanges=!1;this._entitySetReferences={};this._storageModel=[];t=this;t._isOK=!1;i=this._successInitProvider;this._successInitProvider=function(n){n instanceof $data.EntityContext?i(t):i(t,n)};this._storageModel.getStorageModel=function(n){var i=Container.resolveName(n);return t._storageModel[i]};typeof n.name=="string"&&(r=n.name,n.name=[r]);var f=[].concat(n.name),u=$data.typeSystem.createCallbackSetting({success:this._successInitProvider,error:this._successInitProvider});this._initStorageModelSync();t._initializeEntitySets(t.getType());$data.StorageProviderLoader.load(f,{success:function(i){t.storageProvider=new i(n,t);t.storageProvider.setContext(t);t.stateManager=new $data.EntityStateManager(t);var r=t.getType();i.name in r._storageModelCache?t._storageModel=r._storageModelCache[i.name]:(t._initializeStorageModel(),r._storageModelCache[i.name]=t._storageModel);n&&n.user&&Object.defineProperty(t,"user",{value:n.user,enumerable:!0});n&&n.checkPermission&&Object.defineProperty(t,"checkPermission",{value:n.checkPermission,enumerable:!0});t._initializeStore(u)},error:function(){u.error("Provider fallback failed!")}});this.addEventListener=function(n,t){var i="on"+n;i in this||(this[i]=new $data.Event(n,this));this[i].attach(t)};this.removeEventListener=function(n,t){var i="on"+n;i in this&&this[i].detach(t)};this.raiseEvent=function(n,t){var i="on"+n;i in this&&this[i].fire(t)};this.ready=this.onReady({success:$data.defaultSuccessCallback,error:function(){$data.PromiseHandler!==$data.PromiseHandlerBase?$data.defaultErrorCallback.apply(this,arguments):$data.Trace.error(arguments)}})},beginTransaction:function(){function t(t){Object.isNullOrUndefined(t)||(typeof t=="boolean"?u=t:Array.isArray(t)?r=t:n=t)}var r=null,n=null,u=!1,i;return t(arguments[0]),t(arguments[1]),t(arguments[2]),i=new $data.PromiseHandler,n=i.createCallback(n),this.storageProvider._beginTran(r,u,n),i.getPromise()},_isReturnTransaction:function(n){return n instanceof $data.Base||n==="returnTransaction"},_applyTransaction:function(n,t,i,r,u){u===!0?r instanceof $data.Transaction?(Array.prototype.push.call(i,r),t.apply(n,i)):this.beginTransaction(function(r){Array.prototype.push.call(i,r);t.apply(n,i)}):t.apply(n,i)},getDataType:function(dataType){if(typeof dataType=="string"){var memDef_dataType=this[dataType];return(memDef_dataType===undefined||memDef_dataType===null)&&(memDef_dataType=eval(dataType)),memDef_dataType}return dataType},_initializeEntitySets:function(n){for(var t,i,r=0,u=this._storageModel.length;r<u;r++)t=this._storageModel[r],this[t.ItemName]=new $data.EntitySet(t.LogicalType,this,t.ItemName,t.EventHandlers,t.Roles),i=this[t.ItemName],i.name=t.ItemName,i.tableName=t.TableName,i.tableOptions=t.TableOptions,i.eventHandlers=t.EventHandlers,this._entitySetReferences[t.LogicalType.name]=i,this._initializeActions(i,n,n.getMemberDefinition(t.ItemName))},_initializeStore:function(n){this.storageProvider&&this.storageProvider.initializeStore(n)},_initStorageModelSync:function(){for(var t,i,r,n,e,f=this.getType().memberDefinitions.asArray(),u=0;u<f.length;u++)t=f[u],"dataType"in t&&(i=Container.resolveType(t.dataType),i&&i.isAssignableTo&&i.isAssignableTo($data.EntitySet)&&(r=Container.resolveType(t.elementType),n=new $data.StorageModel,n.TableName=t.tableName||t.name,n.TableOptions=t.tableOptions,n.ItemName=t.name,n.LogicalType=r,n.LogicalTypeName=r.name,n.PhysicalTypeName=$data.EntityContext._convertLogicalTypeNameToPhysical(n.LogicalTypeName),n.ContextType=this.getType(),n.Roles=t.roles,t.indices&&(n.indices=t.indices),t.beforeCreate&&(n.EventHandlers||(n.EventHandlers={}),n.EventHandlers.beforeCreate=t.beforeCreate),t.beforeRead&&(n.EventHandlers||(n.EventHandlers={}),n.EventHandlers.beforeRead=t.beforeRead),t.beforeUpdate&&(n.EventHandlers||(n.EventHandlers={}),n.EventHandlers.beforeUpdate=t.beforeUpdate),t.beforeDelete&&(n.EventHandlers||(n.EventHandlers={}),n.EventHandlers.beforeDelete=t.beforeDelete),t.afterCreate&&(n.EventHandlers||(n.EventHandlers={}),n.EventHandlers.afterCreate=t.afterCreate),t.afterRead&&(n.EventHandlers||(n.EventHandlers={}),n.EventHandlers.afterRead=t.afterRead),t.afterUpdate&&(n.EventHandlers||(n.EventHandlers={}),n.EventHandlers.afterUpdate=t.afterUpdate),t.afterDelete&&(n.EventHandlers||(n.EventHandlers={}),n.EventHandlers.afterDelete=t.afterDelete),this._storageModel.push(n),e=Container.resolveName(r),this._storageModel[e]=n))},_initializeStorageModel:function(){var c=this.getType().memberDefinitions.asArray(),u,n,r,f,t,i,s,e,h,o;if(typeof intellisense=="undefined")for(u=0;u<this._storageModel.length;u++){for(n=this._storageModel[u],r={},n.Associations=n.Associations||[],n.ComplexTypes=n.ComplexTypes||[],f=0;f<n.LogicalType.memberDefinitions.getPublicMappedProperties().length;f++){if(t=n.LogicalType.memberDefinitions.getPublicMappedProperties()[f],i=Container.resolveType(t.dataType),this.storageProvider.supportedDataTypes.indexOf(i)>-1&&Object.isNullOrUndefined(t.inverseProperty)){s=JSON.parse(JSON.stringify(t));s.dataType=i;r[t.name]=s;continue}this._buildDbType_navigationPropertyComplite(t,i,n);(i===$data.Array||i.isAssignableTo&&i.isAssignableTo($data.EntitySet))&&t.inverseProperty&&t.inverseProperty!=="$$unbound"?this._buildDbType_Collection_OneManyDefinition(r,n,i,t):t.inverseProperty?t.inverseProperty==="$$unbound"?i===$data.Array?this._buildDbType_Collection_OneManyDefinition(r,n,i,t):this._buildDbType_ElementType_OneManyDefinition(r,n,i,t):(e=i.memberDefinitions.getMember(t.inverseProperty),e?e.elementType?(h=Container.resolveType(e.elementType),h===n.LogicalType?this._buildDbType_ElementType_OneManyDefinition(r,n,i,t):typeof intellisense=="undefined"&&Guard.raise(new Exception("Inverse property not valid, refereed item element type not match: "+n.LogicalTypeName,", property: "+t.name))):this._buildDbType_ElementType_OneOneDefinition(r,n,i,t):typeof intellisense=="undefined"&&Guard.raise(new Exception("Inverse property not valid"))):this._buildDbType_addComplexTypePropertyDefinition(r,n,i,t)}this._buildDbType_modifyInstanceDefinition(r,n,this);o={};o.convertTo=this._buildDbType_generateConvertToFunction(n,this);this._buildDbType_modifyClassDefinition(o,n,this);n.PhysicalType=$data.Class.define(n.PhysicalTypeName,$data.Entity,n.LogicalType.container,r,o)}},_initializeActions:function(n,t,i){var o,u,r,f,e;if(i&&i.actions)for(o=Object.keys(i.actions),u=0;u<o.length;u++)r=o[u],f=i.actions[r],typeof f=="function"?n[r]=f:(e=$data.MemberDefinition.translateDefinition(f,r,t),e instanceof $data.MemberDefinition&&e.kind===$data.MemberTypes.method&&(n[r]=e.method))},_buildDbType_navigationPropertyComplite:function(n,t,i){var u,o,e,r,h,f,s;if(n.inverseProperty)f=null,f=t===$data.Array||t.isAssignableTo&&t.isAssignableTo($data.EntitySet)?this._storageModel.getStorageModel(Container.resolveType(n.elementType)):this._storageModel.getStorageModel(t),s=f.LogicalType.memberDefinitions.getMember(n.inverseProperty),s&&(s.inverseProperty?s.inverseProperty!=n.name&&typeof intellisense=="undefined"&&Guard.raise(new Exception("Inverse property mismatch")):s.inverseProperty=n.name);else{if(u=null,t===$data.Array||t.isAssignableTo&&t.isAssignableTo($data.EntitySet)){if(f=this._storageModel.getStorageModel(Container.resolveType(n.elementType)),f)for(u=[],o=f.LogicalType.memberDefinitions.getPublicMappedProperties(),e=0;e<o.length;e++)r=o[e],r.inverseProperty==n.name&&Container.resolveType(r.dataType)===Container.resolveType(i.LogicalType)&&u.push(r)}else if(f=this._storageModel.getStorageModel(t),f)for(u=[],o=f.LogicalType.memberDefinitions.getPublicMappedProperties(),e=0;e<o.length;e++)r=o[e],r.elementType&&r.inverseProperty==n.name&&Container.resolveType(r.elementType)===i.LogicalType?u.push(r):r.inverseProperty==n.name&&Container.resolveType(r.dataType)===i.LogicalType&&u.push(r);u&&(u.length>1&&typeof intellisense!="undefined"&&Guard.raise(new Exception("More than one inverse property refer to this member definition: "+n.name+", type: "+Container.resolveName(i.LogicalType))),h=u.pop(),h&&(n.inverseProperty=h.name))}},_buildDbType_generateConvertToFunction:function(){return function(n){return n}},_buildDbType_modifyInstanceDefinition:function(){return},_buildDbType_modifyClassDefinition:function(){return},_buildDbType_addComplexTypePropertyDefinition:function(n,t,i,r){this._addNavigationPropertyDefinition(n,r,r.name,$data.MemberTypes.complexProperty);var u=this._createComplexElement(t.LogicalType,"",r.name,i,"","");t.ComplexTypes[r.name]=u;t.ComplexTypes.push(u)},_buildDbType_Collection_OneManyDefinition:function(n,t,i,r){var u=Container.resolveType(r.elementType),f,o,e;(u===undefined||u===null)&&typeof intellisense=="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",r));f=this._storageModel.getStorageModel(u);f||typeof intellisense=="undefined"&&Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",r));this._addNavigationPropertyDefinition(n,r,r.name);o=r.inverseProperty==="$$unbound"?"$$unbound":"0..1";e=this._addAssociationElement(t.LogicalType,o,r.name,f.LogicalType,"*",r.inverseProperty);t.Associations[r.name]=e;t.Associations.push(e)},_buildDbType_ElementType_OneManyDefinition:function(n,t,i,r){var u=Container.resolveType(r.dataType),f,o,e;(u===undefined||u===null)&&typeof intellisense=="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",r));f=this._storageModel.getStorageModel(u);f||typeof intellisense=="undefined"&&Guard.raise(new Exception("No EntitySet definition for the following element type","Field definition",r));this._addNavigationPropertyDefinition(n,r,r.name);o=r.inverseProperty==="$$unbound"?"$$unbound":"*";e=this._addAssociationElement(t.LogicalType,o,r.name,f.LogicalType,"0..1",r.inverseProperty);t.Associations[r.name]=e;t.Associations.push(e)},_buildDbType_ElementType_OneOneDefinition:function(n,t,i,r){var f=Container.resolveType(r.dataType),u,o,e;(f===undefined||f===null)&&typeof intellisense=="undefined"&&Guard.raise(new Exception("Element type definition error","Field definition",r));u=this._storageModel.getStorageModel(f);u||typeof intellisense=="undefined"&&Guard.raise(new Exception("No EntitySet definition following element type","Field definition",r));o=u.LogicalType.memberDefinitions.getMember(r.inverseProperty);o.required||r.required||typeof intellisense=="undefined"&&typeof intellisense=="undefined"&&Guard.raise(new Exception("In one to one connection, one side must required!","One to One connection",r));this._addNavigationPropertyDefinition(n,r,r.name);e=this._addAssociationElement(t.LogicalType,r.required?"0..1":"1",r.name,u.LogicalType,r.required?"1":"0..1",r.inverseProperty);t.Associations[r.name]=e;t.Associations.push(e)},_addNavigationPropertyDefinition:function(n,t,i,r){var u=JSON.parse(JSON.stringify(t));u.dataType=$data.EntitySet;u.notMapped=!0;u.kind=r?r:$data.MemberTypes.navProperty;u.association=i;n[t.name]=u},_addAssociationElement:function(n,t,i,r,u,f){return new $data.Association({From:n.name,FromType:n,FromMultiplicity:t,FromPropertyName:i,To:r.name,ToType:r,ToMultiplicity:u,ReferentialConstraint:[],ToPropertyName:f})},_createComplexElement:function(n,t,i,r,u,f){return new $data.ComplexType({From:n.name,FromType:n,FromMultiplicity:t,FromPropertyName:i,To:r.name,ToType:r,ToMultiplicity:u,ReferentialConstraint:[],ToPropertyName:f})},_successInitProvider:function(n,t){var i;if(n instanceof $data.EntityContext&&n._isOK!==undefined)if(t){if(n._isOK=t,n.onReadyFunction){for(i=0;i<n.onReadyFunction.length;i++)n.onReadyFunction[i].error(t);n.onReadyFunction=undefined}}else if(n._isOK=!0,n.onReadyFunction){for(i=0;i<n.onReadyFunction.length;i++)n.onReadyFunction[i].success(n);n.onReadyFunction=undefined}},onReady:function(n){var i=new $data.PromiseHandler,t=i.createCallback(n);return this._isOK===!0?t.success(this):this._isOK!==!1?t.error(this._isOK):(this.onReadyFunction=this.onReadyFunction||[],this.onReadyFunction.push(t)),i.getPromise()},ready:{type:$data.Promise},getEntitySetFromElementType:function(elementType){var result=this._entitySetReferences[elementType];if(!result)try{result=this._entitySetReferences[eval(elementType).name]}catch(ex){}return result},executeQuery:function(n,t,i){var r=new $data.Query(n.expression,n.defaultType,this),o,u,f,e,s;r.transaction=i instanceof $data.Transaction?i:undefined;o=this._isReturnTransaction(i);t=$data.typeSystem.createCallbackSetting(t);u=this;f={};f.success=function(n){var i;if($data.QueryCache&&$data.QueryCache.isCacheable(u,n)&&$data.QueryCache.addToCache(u,n),n.buildResultSet(u),$data.ItemStore&&"QueryResultModifier"in $data.ItemStore&&$data.ItemStore.QueryResultModifier.call(u,n),n.expression.nodeType===$data.Expressions.ExpressionType.Single||n.expression.nodeType===$data.Expressions.ExpressionType.Find||n.expression.nodeType===$data.Expressions.ExpressionType.Count||n.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete||n.expression.nodeType===$data.Expressions.ExpressionType.Some||n.expression.nodeType===$data.Expressions.ExpressionType.Every){if(n.result.length!==1){t.error(new Exception("result count failed"));return}i=n.result[0]}else if(n.expression.nodeType===$data.Expressions.ExpressionType.First){if(n.result.length===0){t.error(new Exception("result count failed"));return}i=n.result[0]}else typeof n.__count=="number"&&n.result&&(n.result.totalCount=n.__count),u.storageProvider._buildContinuationFunction(u,n),i=n.result;var f=function(){u._applyTransaction(t,t.success,[i],n.transaction,o)},e=0,r=n.getEntitySets(),s=function(){var u=r[e],t;u.afterRead?(e++,t=u.afterRead.call(this,i,r,n),typeof t=="function"?t.call(this,e<r.length?s:f,i,r,n):e<r.length?s():f()):f()};r.length?s():f()};f.error=function(){o?t.error.apply(this,arguments):t.error.apply(this,Array.prototype.filter.call(arguments,function(n){return!(n instanceof $data.Transaction)}))};e=r.getEntitySets();s=function(){var n=!0,o=u,t=function(t){t===!1&&(n=!1);n?r.transaction?$data.QueryCache&&$data.QueryCache.isInCache(u,r)?$data.QueryCache.executeQuery(u,r,f):o.storageProvider.executeQuery(r,f):o.beginTransaction(function(n){r.transaction=n;$data.QueryCache&&$data.QueryCache.isInCache(u,r)?$data.QueryCache.executeQuery(u,r,f):o.storageProvider.executeQuery(r,f)}):(r.rawDataList=[],r.result=[],f.success(r))},i=0,s=function(u){var o,f;u===!1&&(n=!1);o=e[i];o.beforeRead?(i++,f=o.beforeRead.call(this,e,r),typeof f=="function"?f.call(this,i<e.length&&n?s:t,e,r):(f===!1&&(n=!1),i<e.length&&n?s():t())):t()};e.length?s():t()};this.user&&this.checkPermission?this.checkPermission(r.expression.nodeType===$data.Expressions.ExpressionType.BatchDelete?$data.Access.DeleteBatch:$data.Access.Read,this.user,e,{success:s,error:f.error}):s()},saveChanges:function(n,t){var rt,r,ut,ti,ht,wt,ct,bt,lt,u,a,kt,at,ei,ft,it,dt,l,vt,e,h,k,ui,i,v,s,d;$data.QueryCache&&$data.QueryCache.reset(this);for(var f=[],p=this.stateManager.trackedEntities,ni=new $data.PromiseHandler,c=ni.createCallback(n),pt=ni.getPromise(),st=this._isReturnTransaction(t),tt=[];p.length>0;){for(rt=[],i=0;i<p.length;i++){for(r=p[i],ut=this._storageModel.getStorageModel(r.data.getType()),r.data.entityState==$data.EntityState.Unchanged?(r.skipSave=!0,tt.push(r.data)):r.data.entityState==$data.EntityState.Modified&&r.data.changedProperties&&(ti=r.data.changedProperties.some(function(n){var r=ut.PhysicalType.memberDefinitions.getMember(n.name),t,i;return r.kind==$data.MemberTypes.navProperty?(t=ut.Associations[r.association],i=t.FromMultiplicity+t.ToMultiplicity,i=="*0..1"||i=="0..11"):!0}),ti||(r.skipSave=!0,tt.push(r.data))),this.processEntityTypeBeforeEventHandler(tt,r),ht=[],wt=ut.PhysicalType.memberDefinitions.asArray(),ct=0;ct<wt.length;ct++)bt=wt[ct],bt.kind==$data.MemberTypes.navProperty&&ht.push(bt);for(h=0;h<ht.length;h++){var ii=ht[h],w=ut.Associations[ii.name],fi=ii.name,b=w.ToPropertyName,ri=[].concat(r.data[fi]);for(lt=0;lt<ri.length;lt++)if(u=ri[lt],u){if(a=u[b],kt=w.FromMultiplicity+w.ToMultiplicity,w.FromMultiplicity==="$$unbound")if(u instanceof $data.Array)for(r.dependentOn=r.dependentOn||[],at=0;at<u.length;at++)ei=u[at],r.dependentOn.indexOf(u)<0&&u.skipSave!==!0&&r.dependentOn.push(u);else r.dependentOn=r.dependentOn||[],r.dependentOn.indexOf(u)<0&&u.skipSave!==!0&&r.dependentOn.push(u);else{switch(kt){case"*0..1":a?a instanceof Array?a.indexOf(r.data)==-1&&(a.push(r.data),u.initData[b]=a,u._setPropertyChanged(w.ToType.getMemberDefinition(b))):typeof intellisense=="undefined"&&Guard.raise("Item must be array or subtype of array"):(u.initData[b]=[r.data],u._setPropertyChanged(w.ToType.getMemberDefinition(b)));break;default:a?a!==r.data&&typeof intellisense=="undefined"&&Guard.raise("Integrity check error! Item assigned to another entity!"):(u.initData[b]=r.data,u._setPropertyChanged(w.ToType.getMemberDefinition(b)))}switch(kt){case"*0..1":case"0..11":r.dependentOn=r.dependentOn||[];r.dependentOn.indexOf(u)<0&&u.skipSave!==!0&&r.dependentOn.push(u)}}u.entityState||(u.entityState=u.storeToken===this.storeToken?$data.EntityState.Modified:$data.EntityState.Added);rt.indexOf(u)==-1&&rt.push(u)}}}for(i=0;i<p.length;i++)e=p[i],e.skipSave!==!0&&f.push(e);for(p=[],i=0;i<rt.length;i++)ft=rt[i],tt.some(function(n){return n==ft})||f.some(function(n){return n.data==ft})||p.push({data:ft,entitySet:this.getEntitySetFromElementType(ft.getType().name)})}for(h=0;h<f.length;h++)if(it=f[h],it.dependentOn){for(dt=[],i=0;i<it.dependentOn.length;i++)tt.indexOf(it.dependentOn[i])<0&&dt.push(it.dependentOn[i]);it.dependentOn=dt}if(tt=null,l=this,f.length==0)return this.stateManager.trackedEntities.length=0,l._applyTransaction(c,c.success,[0],t,st),pt;for(vt=[],i=0;i<f.length;i++){if(e=f[i],e.data.entityState===$data.EntityState.Added)for(h=0;h<e.data.getType().memberDefinitions.getPublicMappedProperties().length;h++)if(k=e.data.getType().memberDefinitions.getPublicMappedProperties()[h],ui=Container.resolveType(k.type),k.required&&!k.computed&&!e.data[k.name])switch(ui){case $data.String:case $data.Number:case $data.Float:case $data.Decimal:case $data.Integer:case $data.Int16:case $data.Int32:case $data.Int64:case $data.Byte:case $data.SByte:case $data.Date:case $data.Boolean:e.data[k.name]=Container.getDefault(k.dataType)}e.data.entityState!==$data.EntityState.Added&&e.data.entityState!==$data.EntityState.Modified||e.data.isValid()||vt.push({item:e.data,errors:e.data.ValidationErrors})}if(vt.length>0)return c.error(vt),pt;var yt=$data.Access.None,o={},gt=[];for(i=0;i<f.length;i++)if(v=f[i],s=v.entitySet.elementType.name,gt.indexOf(v.entitySet)<0&&gt.push(v.entitySet),d=this._entitySetReferences[s],d.beforeCreate||d.beforeUpdate||d.beforeDelete||this.user&&this.checkPermission){o[s]||(o[s]={});switch(v.data.entityState){case $data.EntityState.Added:yt|=$data.Access.Create;d.beforeCreate&&(o[s].createAll||(o[s].createAll=[]),o[s].createAll.push(v));break;case $data.EntityState.Modified:yt|=$data.Access.Update;d.beforeUpdate&&(o[s].modifyAll||(o[s].modifyAll=[]),o[s].modifyAll.push(v));break;case $data.EntityState.Deleted:yt|=$data.Access.Delete;d.beforeDelete&&(o[s].deleteAll||(o[s].deleteAll=[]),o[s].deleteAll.push(v))}}var g=function(n){if(n===!1&&(y="async",f.length=0),f.length){var i={success:function(n){l._postProcessSavedItems(c,f,n,st)},error:function(){st?c.error.apply(this,arguments):c.error.apply(this,Array.prototype.filter.call(arguments,function(n){return!(n instanceof $data.Transaction)}))}};t instanceof $data.Transaction?l.storageProvider.saveChanges(i,f,t):l.beginTransaction(!0,function(n){l.storageProvider.saveChanges(i,f,n)})}else y?c.error(new Exception("Cancelled event in "+y,"CancelEvent")):l._applyTransaction(c,c.success,[0],t,st)},y,nt=Object.getOwnPropertyNames(o),i=0,et=["beforeUpdate","beforeDelete","beforeCreate"],oi={beforeCreate:"createAll",beforeDelete:"deleteAll",beforeUpdate:"modifyAll"},ot=function(n){var r,u,e,s,a,v;if(n===!1){y="async";f.length=0;g(n);return}var c=l._entitySetReferences[nt[i]],h=et.pop(),p=o[nt[i]],t=p[oi[h]];if(t){for(r=[],u=0;u<t.length;u++)r.push(t[u].data);if(et.length||(et=["beforeUpdate","beforeDelete","beforeCreate"],i++),e=c[h].call(l,r),typeof e=="function")e.call(l,i<nt.length&&!y?ot:g,r);else if(e===!1){for(y=c.name+"."+h,s=0;s<t.length;s++)a=t[s],v=f.indexOf(a),f.splice(v,1);g()}else i<nt.length&&!y?ot():g()}else et.length||(et=["beforeUpdate","beforeDelete","beforeCreate"],i++),i<nt.length&&!y?ot():g()};return this.user&&this.checkPermission?this.checkPermission(yt,this.user,gt,{success:function(){i<nt.length?ot():g()},error:c.error}):i<nt.length?ot():g(),pt},processEntityTypeBeforeEventHandler:function(n,t){if(!t.skipSave){var i=t.data,r=i.getType(),u=i.entityState;switch(!0){case u===$data.EntityState.Added&&r.onbeforeCreate instanceof $data.Event:r.onbeforeCreate.fireCancelAble(i)===!1&&(t.skipSave=!0,n.push(i));break;case u===$data.EntityState.Modified&&r.onbeforeUpdate instanceof $data.Event:r.onbeforeUpdate.fireCancelAble(i)===!1&&(t.skipSave=!0,n.push(i));break;case u===$data.EntityState.Deleted&&r.onbeforeDelete instanceof $data.Event:r.onbeforeDelete.fireCancelAble(i)===!1&&(t.skipSave=!0,n.push(i))}}},processEntityTypeAfterEventHandler:function(n){var i=n.data,t=i.getType(),r=i.entityState;switch(!0){case r===$data.EntityState.Added&&t.onafterCreate instanceof $data.Event:t.onafterCreate.fire(i);break;case r===$data.EntityState.Modified&&t.onafterUpdate instanceof $data.Event:t.onafterUpdate.fire(i);break;case r===$data.EntityState.Deleted&&t.onafterDelete instanceof $data.Event:t.onafterDelete.fire(i)}},bulkInsert:function(n,t,i,r){var e=new $data.PromiseHandler,u,o,f;if(r=e.createCallback(r),typeof n=="string"){for(o in this._entitySetReferences)if(f=this._entitySetReferences[o],f.tableName===n){u=f;break}u||(u=this[n]);n=u}return n?this.storageProvider.bulkInsert(n,t,i,r):r.error(new Exception("EntitySet not found")),e.getPromise()},prepareRequest:function(){},_postProcessSavedItems:function(n,t,i,r){var u,s,e,f,p;for(this.ChangeCollector&&this.ChangeCollector instanceof $data.Notifications.ChangeCollectorBase&&this.ChangeCollector.processChangedData(t),u={},s=this,e=0;e<t.length;e++){f=t[e];f.data.storeToken||(f.data.storeToken=s.storeToken);this.processEntityTypeAfterEventHandler(f);p=f.data.entityState;f.data.entityState=$data.EntityState.Unchanged;f.data.changedProperties=[];f.physicalData=undefined;var o=f.entitySet.elementType.name,h=s._entitySetReferences[o],l=undefined;switch(p){case $data.EntityState.Added:l="added";break;case $data.EntityState.Deleted:l="deleted";break;case $data.EntityState.Modified:l="updated"}if(l&&this.raiseEvent(l,f),h.afterCreate||h.afterUpdate||h.afterDelete){u[o]||(u[o]={});switch(p){case $data.EntityState.Added:h.afterCreate&&(u[o].createAll||(u[o].createAll=[]),u[o].createAll.push(f));break;case $data.EntityState.Modified:h.afterUpdate&&(u[o].modifyAll||(u[o].modifyAll=[]),u[o].modifyAll.push(f));break;case $data.EntityState.Deleted:h.afterDelete&&(u[o].deleteAll||(u[o].deleteAll=[]),u[o].deleteAll.push(f))}}}var c=Object.getOwnPropertyNames(u),e=0,s=this,a=["afterUpdate","afterDelete","afterCreate"],w={afterCreate:"createAll",afterDelete:"deleteAll",afterUpdate:"modifyAll"},v=function(){s.trackChanges||s.stateManager.reset();s._applyTransaction(n,n.success,[t.length],i,r)},y=function(){var o=s._entitySetReferences[c[e]],f=a.pop(),h=u[c[e]],i=h[w[f]],n,t,r;if(i){for(n=[],t=0;t<i.length;t++)n.push(i[t].data);a.length||(a=["afterUpdate","afterDelete","afterCreate"],e++);r=o[f].call(s,n);typeof r=="function"?r.call(s,e<c.length?y:v,n):e<c.length?y():v()}else a.length||(a=["afterUpdate","afterDelete","afterCreate"],e++),e<c.length?y():v()};e<c.length?y():v()},forEachEntitySet:function(n,t){var i,r;for(i in this._entitySetReferences)r=this._entitySetReferences[i],n.call(t,r)},loadItemProperty:function(n,t,i,r){var e,k,y,l,a,b,c,f,o,u,s,v;if(Guard.requireType("entity",n,$data.Entity),e=typeof t=="string"?n.getType().memberDefinitions.getMember(t):t,k=this._isReturnTransaction(r),n[e.name]!=undefined)return y=new $data.PromiseHandler,callBack=y.createCallback(i),this._applyTransaction(i,i.success,[n[e.name]],r,k),y.getPromise();var p=!0,w=this._storageModel.getStorageModel(n.getType().fullName),h=Container.resolveType(e.dataType);if(h===$data.Array||h.isAssignableTo&&h.isAssignableTo($data.EntitySet))h=Container.resolveType(e.elementType),p=!1;else{for(a=0;a<w.Associations.length;a++)if(b=w.Associations[a],b.FromPropertyName==e.name){l=b;break}l&&l.FromMultiplicity==="0..1"&&l.ToMultiplicity==="1"&&(p=!1)}if(c=w.LogicalType.memberDefinitions.getKeyProperties(),p===!0){for(f="function (e) { return",o={},u=0;u<c.length;u++)s=c[u],u>0&&(f+=" &&"),f+=" e."+s.name+" == this.key"+u,o["key"+u]=n[s.name];return f+="; }",v=this.getEntitySetFromElementType(n.getType()),v.map("function (e) { return e."+e.name+" }").single(f,o,i,r)}for(f="function (e) { return",o={},u=0;u<c.length;u++)s=c[u],u>0&&(f+=" &&"),f+=" e."+e.inverseProperty+"."+s.name+" == this.key"+u,o["key"+u]=n[s.name];return f+="; }",v=this.getEntitySetFromElementType(h),v.filter(f,o).toArray(i,r)},getTraceString:function(n){var t=new $data.Query(n.expression,n.defaultType,this);return this.storageProvider.getTraceString(t)},log:function(){},resolveBinaryOperator:function(n,t,i){return this.storageProvider.resolveBinaryOperator(n,t,i)},resolveUnaryOperator:function(n,t,i){return this.storageProvider.resolveUnaryOperator(n,t,i)},resolveFieldOperation:function(n,t,i){return this.storageProvider.resolveFieldOperation(n,t,i)},resolveSetOperations:function(n,t,i){return this.storageProvider.resolveSetOperations(n,t,i)},resolveTypeOperations:function(n,t,i){return this.storageProvider.resolveTypeOperations(n,t,i)},resolveContextOperations:function(n,t,i){return this.storageProvider.resolveContextOperations(n,t,i)},_generateServiceOperationQueryable:function(n,t,i,r){var f,u,e,o;for(typeof console!="undefined"&&console.log&&console.log("Obsolate: _generateServiceOperationQueryable, $data.EntityContext"),f=[],u=0;u<r.length;u++)e={},e[r[u]]=Container.resolveType(Container.getTypeName(i[u])),f.push(e);return o=$data.EntityContext.generateServiceOperation({serviceName:n,returnType:$data.Queryable,elementType:this[t].elementType,params:f}),o.apply(this,i)},attach:function(n,t){n instanceof $data.EntityWrapper&&(n=n.getEntity());var i=this.getEntitySetFromElementType(n.getType());return i.attach(n,t)},attachOrGet:function(n){n instanceof $data.EntityWrapper&&(n=n.getEntity());var t=this.getEntitySetFromElementType(n.getType());return t.attachOrGet(n)},addMany:function(n){var t=this;return n.forEach(function(n){t.add(n)}),n},add:function(n){n instanceof $data.EntityWrapper&&(n=n.getEntity());var t=this.getEntitySetFromElementType(n.getType());return t.add(n)},remove:function(n){n instanceof $data.EntityWrapper&&(n=n.getEntity());var t=this.getEntitySetFromElementType(n.getType());return t.remove(n)},storeToken:{type:Object},getFieldUrl:function(n,t,i){var r,f,e,u;try{return r=typeof i=="string"?this[i]:i,f=typeof t=="string"?t:t.name,n instanceof $data.Entity?r=this.getEntitySetFromElementType(n.getType()):Object.isNullOrUndefined(n)||n.constructor===$data.Object||(e=r.elementType.memberDefinitions.getKeyProperties()[0],u={},u[e.name]=n,n=u),n instanceof $data.Entity||(n=new r.elementType(n)),this.storageProvider.getFieldUrl(n,f,r)}catch(o){}return"#"}},{inheritedTypeProcessor:function(n){n.resolveForwardDeclarations&&n.resolveForwardDeclarations()},generateServiceOperation:function(n){var t,r,u,i,f,e;if(n.serviceMethod?(r=n.returnType?Container.resolveType(n.returnType):{},t=r.isAssignableTo&&r.isAssignableTo($data.Queryable)?n.serviceMethod:function(){var u=arguments[arguments.length-1],i=new $data.PromiseHandler,t,e=arguments,r;typeof u=="function"?(t=i.createCallback(u),arguments[arguments.length-1]=t):(t=i.createCallback(),arguments.push(t));try{r=n.serviceMethod.apply(this,arguments);r!==undefined&&t.success(r)}catch(f){t.error(f)}return i.getPromise()}):t=function(){var r=this,e,s,o,u,h,c,t;if(this instanceof $data.Entity){if(n.method||(n.method="POST"),this.context)r=this.context;else{Guard.raise("entity not attached into context");return}e={data:this,entitySet:r.getEntitySetFromElementType(this.getType())}}if(s=n.elementType?r.getEntitySetFromElementType(Container.resolveType(n.elementType)):null,o=null,n.params)for(o=[],u=0;u<n.params.length;u++)for(h in n.params[u])o.push(Container.createConstantExpression(arguments[u],Container.resolveType(n.params[u][h]),h));var l=Container.createEntityContextExpression(r),a=(e?e.data:r).getType().getMemberDefinition(n.serviceName),f=Container.createServiceOperationExpression(l,Container.createMemberInfoExpression(a),o,n,e),i=arguments[arguments.length-1];return typeof i!="function"&&(i=undefined),s?(t=Container.createQueryable(s,f),i)?(f.isTerminated=!0,t._runQuery(i)):t:(c=n.returnType?Container.resolveType(n.returnType):null,t=Container.createQueryable(r,f),t.defaultType=c||$data.Object,c===$data.Queryable)?(t.defaultType=Container.resolveType(n.elementType),i)?(f.isTerminated=!0,t._runQuery(i)):t:(f.isTerminated=!0,t._runQuery(i))},u=[],n.params)for(i=0;i<n.params.length;i++){f=n.params[i];for(e in f)u.push({name:e,type:f[e]})}return $data.typeSystem.extend(t,n,{params:u}),t},_convertLogicalTypeNameToPhysical:function(n){return n+"_$db$"},_storageModelCache:{get:function(){return this.__storageModelCache||(this.__storageModelCache={}),this.__storageModelCache},set:function(){}}});$data.Class.define("$data.QueryProvider",null,null,{constructor:function(){this.requiresExpressions=!1},executeQuery:function(){},getTraceString:function(){}},null);$data.Class.define("$data.ModelBinder",null,null,{constructor:function(n){if(this.context=n,this.providerName=null,this.context.storageProvider&&typeof this.context.storageProvider.getType=="function"){this.references=!(this.context.storageProvider.providerConfiguration.modelBinderOptimization||!1);for(var t in $data.RegisteredStorageProviders)$data.RegisteredStorageProviders[t]===this.context.storageProvider.getType()&&(this.providerName=t)}},_deepExtend:function(n,t){var i,r;if(n===null||n===undefined)return t;for(i in t)if(n.hasOwnProperty(i)){if(typeof t[i]=="object")if(Array.isArray(t[i]))for(r=0;r<t[i].length;r++)n[i].indexOf(t[i][r])<0&&n[i].push(t[i][r]);else this._deepExtend(n[i],t[i])}else n[i]=t[i];return this._finalize(n)},_finalize:function(n){return n instanceof $data.Entity&&(n.changedProperties=undefined,n.storeToken=this.context.storeToken),n},_buildSelector:function(n,t){var i,u,f,r;if(n.$selector){for(Array.isArray(n.$selector)||(n.$selector=[n.$selector]),i=0;i<n.$selector.length;i++){for(u=n.$selector[i].replace("json:",""),t.src+="if(",f=u.split("."),r=0;r<f.length;r++)t.src+="di."+f.slice(0,r+1).join(".")+(r<f.length-1?" && ":" !== undefined && typeof di."+u+' === "object"');t.src+="){di = di."+u+";}"+(i<n.$selector.length-1?"else ":"")}t.src+="if (di === null){";t.iter&&(t.src+=t.iter+" = null;");t.src+="return null;";t.src+="}"}},_buildKey:function(n,t,i,r,u){var t,o,f,e;if(i){if(t=Container.resolveType(t),o=Container.getIndex(t),t=t.fullName||t.name,r.src+="var "+n+"Fn = function(di){",Array.isArray(i)&&i.length!=1)for(r.src+='var key = "";',f=0;f<i.length;f++)e=typeof i[f]!="object"?i[f]:i[f].$source,r.src+="if (typeof di."+e+' === "undefined") return undefined;',r.src+="if (di."+e+" === null) return null;",r.src+='key += ("'+t+"_"+o+"_"+e+'#" + di.'+e+");";else typeof i!="string"&&(i=i[0]),r.src+="if (typeof di."+i+' === "undefined") return undefined;',r.src+="if (di."+i+" === null) return null;",r.src+='var key = ("'+t+"_"+o+"_"+i+'#" + di.'+i+");";r.src+="return key;};"}r.src+="var "+n+" = "+(i?n+"Fn("+(u||"di")+")":"undefined")+";"},build:function(n,t){var u,c,h,a,v,s,i,r,e;if(n.$selector)for(Array.isArray(n.$selector)||(n.$selector=[n.$selector]),i=0;i<n.$selector.length;i++)n.$selector[i]=n.$selector[i].replace("json:","");if(n.$value)if(typeof n.$value=="function")if(t.src+="var di = di || data;",t.src+="var fn = function(){ return meta"+(t.meta.length?"."+t.meta.join("."):"")+".$value.call(self, meta"+(t.meta.length?"."+t.meta.join("."):"")+", di); };",n.$type){var f=Container.resolveName(Container.resolveType(n.$type)),e=Container.getIndex(Container.resolveType(n.$type)),s=this.context.storageProvider.fieldConverter.fromDb[f];t.item=s?'self.context.storageProvider.fieldConverter.fromDb["'+f+'"](fn())':"new (Container.resolveByIndex("+e+"))(fn())"}else t.item="fn()";else if(n.$type){var f=Container.resolveName(Container.resolveType(n.$type)),e=Container.getIndex(Container.resolveType(n.$type)),s=this.context.storageProvider.fieldConverter.fromDb[f];t.item=s?'self.context.storageProvider.fieldConverter.fromDb["'+f+'"]('+n.$value+")":"new (Container.resolveByIndex("+e+"))("+n.$value+")"}else t.item=n.$value;else if(n.$source){var f=Container.resolveName(Container.resolveType(n.$type)),e=Container.getIndex(Container.resolveType(n.$type)),s=this.context.storageProvider.fieldConverter.fromDb[f],r="_"+f.replace(/\./gi,"_")+"_";t.forEach||(t.src+="var di = data;");t.item=r;this._buildSelector(n,t);t.src+=s?"var "+r+' = self.context.storageProvider.fieldConverter.fromDb["'+f+'"](di.'+n.$source+");":"var "+r+" = new (Container.resolveByIndex("+e+"))(di."+n.$source+");"}else if(n.$item)t.meta.push("$item"),u=t.item&&t.current?t.item+"."+t.current:t.item?t.item:"result",t.iter=u,u.indexOf(".")<0&&(t.src+="var "+u+";"),t.src+="var fn = function(di){",n.$selector&&(t.src+='if (typeof di !== "undefined" && !(Array.isArray(di))){',this._buildSelector(n,t),t.src+="}"),this.references&&n.$keys&&this._buildKey("forKey",n.$type,n.$keys,t),t.src+=u+" = typeof "+u+' == "undefined" ? [] : '+u+";",this.references&&n.$item.$keys&&(c="keycache_"+u.replace(/\./gi,"_"),t.src+="var "+c+";",t.src+="var kci = keycacheIter.indexOf("+u+");",t.src+="if (kci < 0){",t.src+=c+" = [];",t.src+="keycache.push("+c+");",t.src+="keycacheIter.push("+u+");",t.src+="}else{",t.src+=c+" = keycache[kci];",t.src+="}"),t.iter=undefined,t.forEach=!0,h="itemForKey_"+u.replace(/\./gi,"_"),t.src+="var forEachFn = function(di, i){",t.src+="var diBackup = di;",this.providerName=="sqLite"&&this.references&&n.$item.$keys&&this._buildKey(h,n.$type,n.$item.$keys,t),r=t.item||"iter",t.item=r,n.$item.$source||this._buildSelector(n.$item,t),this.build(n.$item,t),this.references&&n.$keys?(t.src+="if (forKey){",t.src+="if (cache[forKey]){",t.src+=u+" = cache[forKey];",t.src+="if ("+u+".indexOf("+(t.item||r)+") < 0){",t.src+=u+".push("+(t.item||r)+");",t.src+="}}else{",t.src+="cache[forKey] = "+u+";",t.src+=u+".push("+(t.item||r)+");",t.src+="}}else{",this.references&&n.$item.$keys&&this._buildKey("cacheKey",n.$type,n.$item.$keys,t,"diBackup"),t.src+='if (typeof cacheKey != "undefined" && cacheKey !== null){',t.src+="if (keycache_"+u.replace(/\./gi,"_")+" && cacheKey){",t.src+="if (keycache_"+u.replace(/\./gi,"_")+".indexOf(cacheKey) < 0){",t.src+=u+".push("+(t.item||r)+");",t.src+="keycache_"+u.replace(/\./gi,"_")+".push(cacheKey);",t.src+="}",t.src+="}else{",t.src+=u+".push("+(t.item||r)+");",t.src+="}",t.src+="}",t.src+="}"):this.references&&n.$item.$keys?(t.src+="if (typeof "+h+' !== "undefined" && '+h+" !== null){",t.src+="if (typeof keycache_"+u.replace(/\./gi,"_")+' !== "undefined" && '+h+"){",t.src+="if (keycache_"+u.replace(/\./gi,"_")+".indexOf("+h+") < 0){",t.src+=u+".push("+(t.item||r)+");",t.src+="keycache_"+u.replace(/\./gi,"_")+".push("+h+");",t.src+="}}else{",t.src+=u+".push("+(t.item||r)+");",t.src+="}}else{",t.src+=u+".push("+(t.item||r)+");",t.src+="}"):t.src+=u+".push("+(t.item||r)+");",t.src+="};",t.src+="if (Array.isArray(di)) di.forEach(forEachFn);",t.src+="else forEachFn(di, 0);",t.forEach=!1,t.item=null,t.src+='};fn(typeof di === "undefined" ? data : di);',t.meta.pop();else if(n.$type){t.forEach||(t.src+='if (typeof di === "undefined"){',t.src+="var di = data;",this._buildSelector(n,t),t.src+="}");var o=Container.resolveType(n.$type),f=Container.resolveName(o),e=Container.getIndex(o),p=o.isAssignableTo&&o.isAssignableTo($data.Entity),r="_"+f.replace(/\./gi,"_")+"_";t.item==r&&(r+="new_");t.item=r;a=!1;n.$source||n.$value||o===$data.Array||o===$data.Object||o.isAssignableTo||(a=!0);(o===$data.Object||o===$data.Array)&&(v=Object.keys(n),(v.length==1||v.length==2&&n.$selector)&&(a=!0));a?(s=this.context.storageProvider.fieldConverter.fromDb[f],t.src+=s?"var "+r+' = di != undefined ? self.context.storageProvider.fieldConverter.fromDb["'+f+'"](di) : di;':"var "+r+" = di;"):this.references&&n.$keys?(this._buildKey("itemKey",n.$type,n.$keys,t),t.src+="if (itemKey === null) return null;",t.src+="var "+r+";",t.src+="if (itemKey && cache[itemKey]){",t.src+=r+" = cache[itemKey];",t.src+="}else{",t.src+=p?r+" = new (Container.resolveByIndex("+e+"))(undefined, { setDefaultValues: false });":r+" = new (Container.resolveByIndex("+e+"))();",t.src+="if (itemKey){",t.src+="cache[itemKey] = "+r+";",t.src+="}",t.src+="}"):t.src+=p?"var "+r+" = new (Container.resolveByIndex("+e+"))(undefined, { setDefaultValues: false });":"var "+r+" = new (Container.resolveByIndex("+e+"))();";for(i in n)if(i.indexOf("$")<0)if(t.current=i,n[i].$item)t.meta.push(i),this.build(n[i],t),t.item=r,t.meta.pop();else if(n[i].$value)t.meta.push(i),r=t.item,this.build(n[i],t),t.src+=r+"."+i+" = "+t.item+";",t.item=r,t.meta.pop();else if(n[i].$source){if(t.src+="var fn = function(di){",this._buildSelector(n[i],t),n[i].$type){var f=Container.resolveName(Container.resolveType(n[i].$type)),e=Container.getIndex(Container.resolveType(n[i].$type)),s=this.context.storageProvider.fieldConverter.fromDb[f];t.src+=s?'return self.context.storageProvider.fieldConverter.fromDb["'+f+'"](di.'+n[i].$source+");":"return new (Container.resolveByIndex("+e+"))(di."+n[i].$source+");"}else t.src+=r+"."+i+" = di."+n[i].$source+";";t.src+="};";t.src+=n[i].$type?r+"."+i+" = fn(di);":"fn(di);"}else if(n[i].$type)t.meta.push(i),t.src+="var fn = function(di){",this._buildSelector(n[i],t),this.build(n[i],t),t.src+="return "+t.item+";};",t.src+=n[i].$type===$data.Object?r+"."+i+" = self._deepExtend("+r+"."+i+", fn(di));":r+"."+i+" = fn(di);",t.item=r,t.meta.pop();else if(n.$type){var l=Container.resolveType(n.$type).memberDefinitions.getMember(i),f=Container.resolveName(l.type),w=Container.resolveType(n.$type),y=Container.getIndex(n.$type),s=this.context.storageProvider.fieldConverter.fromDb[f];this.providerName&&l&&l.converter&&l.converter[this.providerName]&&typeof l.converter[this.providerName].fromDb=="function"?t.src+=r+"."+i+' = Container.resolveByIndex("'+y+'").memberDefinitions.getMember("'+i+'").converter.'+this.providerName+".fromDb(di."+n[i]+', Container.resolveByIndex("'+y+'").memberDefinitions.getMember("'+i+'"), self.context, Container.resolveByIndex("'+y+'"));':s?t.src+=r+"."+i+' = self.context.storageProvider.fieldConverter.fromDb["'+f+'"](di.'+n[i]+");":(e=Container.getIndex(Container.resolveType(f.memberDefinitions.getMember(i).type)),t.src+=r+"."+i+" = new (Container.resolveByIndex("+e+"))(di."+n[i]+");")}t.src+=r+" = self._finalize("+r+");"}},call:function(n,t){var i,r,u;return Object.getOwnPropertyNames(t).length?(i={src:"",meta:[]},i.src+="var self = this;",i.src+="var result;",i.src+="var cache = {};",i.src+="var keycache = [];",i.src+="var keycacheIter = [];",this.build(t,i),i.item&&(i.src+='if (typeof result === "undefined") result = '+i.item+";"),i.src+="return result;",r=new Function("meta","data",i.src).bind(this),u=r(t,n),u):n}});$C("$data.queryBuilder",null,null,{constructor:function(){this._fragments={};this.selectedFragment=null;this._binderConfig={};this.modelBinderConfig=this._binderConfig;this._binderConfigPropertyStack=[]},selectTextPart:function(n){this._fragments[n]||(this._fragments[n]={text:"",params:[]});this.selectedFragment=this._fragments[n]},getTextPart:function(n){return this._fragments[n]},addText:function(n){this.selectedFragment.text+=n},addParameter:function(n){this.selectedFragment.params.push(n)},selectModelBinderProperty:function(n){this._binderConfigPropertyStack.push(this.modelBinderConfig);n in this.modelBinderConfig||(this.modelBinderConfig[n]={});this.modelBinderConfig=this.modelBinderConfig[n]},popModelBinderProperty:function(){this.modelBinderConfig=this._binderConfigPropertyStack.length===0?this._binderConfig():this._binderConfigPropertyStack.pop()},resetModelBinderProperty:function(){this._binderConfigPropertyStack=[];this.modelBinderConfig=this._binderConfig},addKeyField:function(n){this.modelBinderConfig.$keys||(this.modelBinderConfig.$keys=[]);this.modelBinderConfig.$keys.push(n)}});$C("$data.Query",null,null,{constructor:function(n,t,i){this.expression=n;this.context=i;this.expressions=n;this.defaultType=t;this.result=[];this.rawDataList=[];this.modelBinderConfig={};this.context=i},rawDataList:{dataType:"Array"},result:{dataType:"Array"},resultType:{},buildResultSet:function(){var n=new $data.ModelBinder(this.context);this.result=n.call(this.rawDataList,this.modelBinderConfig);return},getEntitySets:function(){var n=[],t=this.context,i=function(r){r instanceof $data.Expressions.EntitySetExpression&&n.indexOf(t._entitySetReferences[r.elementType.name])<0&&n.push(t._entitySetReferences[r.elementType.name]);r.source&&i(r.source)};return i(this.expression),n}},null);$data.Class.define("$data.Queryable",null,null,{constructor:function(n,t){var i=n instanceof $data.EntityContext?n:n.entityContext;this.defaultType=n instanceof $data.EntityContext?null:n.defaultType;this.entityContext=i;this.expression=t},filter:function(n,t){var i,r,u,f,e;return arguments.length===3&&(n="it."+arguments[0]+(arguments[1][0]==="."?arguments[1]+"(param)":" "+arguments[1]+" param"),t={param:arguments[2]}),this._checkOperation("filter"),i=Container.createCodeExpression(n,t),r=this.expression,this.expression instanceof $data.Expressions.FilterExpression&&(r=this.expression.source,u=this.entityContext.storageProvider.resolveBinaryOperator("and"),i=Container.createSimpleBinaryExpression(this.expression.selector,i,"and","filter","boolean",u)),f=Container.createFilterExpression(r,i),e=Container.createQueryable(this,f),e},where:function(n,t){return this.filter(n,t)},map:function(n,t,i){var u,r;return this._checkOperation("map"),u=Container.createCodeExpression(n,t),r=Container.createProjectionExpression(this.expression,u),r.projectionAs=i==="default"?this.defaultType:i?Container.resolveType(i):$data.Object,Container.createQueryable(this,r)},select:function(n,t,i){return this.map(n,t,i)},length:function(n,t){var i;this._checkOperation("length");var r=new $data.PromiseHandler,u=r.createCallback(n),f=Container.createCountExpression(this.expression),e=Container.createQueryExpressionCreator(this.entityContext);try{i=e.Visit(f);this.entityContext.log({event:"EntityExpression",data:i});this.entityContext.executeQuery(Container.createQueryable(this,i),u,t)}catch(o){u.error(o)}return r.getPromise()},count:function(n,t){return this.length(n,t)},forEach:function(n,t){function f(t){t.forEach(n)}var i,r;this._checkOperation("forEach");i=new $data.PromiseHandler;var u=i.createCallback(f),e=Container.createForEachExpression(this.expression),o=Container.createQueryExpressionCreator(this.entityContext);try{r=o.Visit(e);this.entityContext.log({event:"EntityExpression",data:r});this.entityContext.executeQuery(Container.createQueryable(this,r),u,t)}catch(s){u.error(s)}return i.getPromise()},toArray:function(n,t){var i;if(n instanceof $data.Array)return this.toArray(function(t){n.length=0;t.forEach(function(t){n.push(t)})});this._checkOperation("toArray");var r=new $data.PromiseHandler,u=r.createCallback(n),f=Container.createToArrayExpression(this.expression),e=Container.createQueryExpressionCreator(this.entityContext);try{i=e.Visit(f);this.entityContext.log({event:"EntityExpression",data:i});this.entityContext.executeQuery(Container.createQueryable(this,i),u,t)}catch(o){u.error(o)}return r.getPromise()},toLiveArray:function(n,t){var u=this,i=[],r=function(n){return function(u){var f=new $data.PromiseHandler,e=f.createCallback(u),s=function(n){i.length=0;var t=n;$data.typeSystem.extend(i,t);i.prev=r(function(n){t.prev(n)});i.next=r(function(n){t.next(n)});e.success.apply(this,[i].concat(Array.prototype.slice.call(arguments,1)))},o;return n({success:s,error:e.error},t),o=f.getPromise(),$data.typeSystem.extend(i,o),i}};return i.refresh=r(function(n){u.toArray(n)}),i.refresh.apply(i,arguments)},single:function(n,t,i,r){var u,f;this._checkOperation("single");u=this;n&&(u=this.filter(n,t));u=u.take(2);var e=new $data.PromiseHandler,o=e.createCallback(i),s=Container.createSingleExpression(u.expression),h=Container.createQueryExpressionCreator(u.entityContext);try{f=h.Visit(s);this.entityContext.log({event:"EntityExpression",data:f});u.entityContext.executeQuery(Container.createQueryable(u,f),o,r)}catch(c){o.error(c)}return e.getPromise()},some:function(n,t,i,r){var u,f;this._checkOperation("some");u=this;n&&(u=this.filter(n,t));u=u.take(1);var e=new $data.PromiseHandler,o=e.createCallback(i),s=Container.createSomeExpression(u.expression),h=Container.createQueryExpressionCreator(u.entityContext);try{f=h.Visit(s);this.entityContext.log({event:"EntityExpression",data:f});u.entityContext.executeQuery(Container.createQueryable(u,f),o,r)}catch(c){o.error(c)}return e.getPromise()},every:function(n,t,i,r){var u,f;this._checkOperation("every");u=this;n&&(u=this.filter(n,t));u=u.take(1);var e=new $data.PromiseHandler,o=e.createCallback(i),s=Container.createEveryExpression(u.expression),h=Container.createQueryExpressionCreator(u.entityContext);try{f=h.Visit(s);this.entityContext.log({event:"EntityExpression",data:f});u.entityContext.executeQuery(Container.createQueryable(u,f),o,r)}catch(c){o.error(c)}return e.getPromise()},take:function(n){this._checkOperation("take");var t=Container.createConstantExpression(n,"number"),i=Container.createPagingExpression(this.expression,t,$data.Expressions.ExpressionType.Take);return Container.createQueryable(this,i)},skip:function(n){this._checkOperation("skip");var t=Container.createConstantExpression(n,"number"),i=Container.createPagingExpression(this.expression,t,$data.Expressions.ExpressionType.Skip);return Container.createQueryable(this,i)},order:function(n){if(n===""||n===undefined||n===null)return this;if(n[0]==="-"){var t="it."+n.replace("-","");return this.orderByDescending(t)}return this.orderBy("it."+n)},orderBy:function(n,t){this._checkOperation("orderBy");var i=Container.createCodeExpression(n,t),r=Container.createOrderExpression(this.expression,i,$data.Expressions.ExpressionType.OrderBy);return Container.createQueryable(this,r)},orderByDescending:function(n,t){this._checkOperation("orderByDescending");var i=Container.createCodeExpression(n,t),r=Container.createOrderExpression(this.expression,i,$data.Expressions.ExpressionType.OrderByDescending);return Container.createQueryable(this,r)},first:function(n,t,i,r){var u,f;this._checkOperation("first");u=this;n&&(u=this.filter(n,t));u=u.take(1);var e=new $data.PromiseHandler,o=e.createCallback(i),s=Container.createFirstExpression(u.expression),h=Container.createQueryExpressionCreator(u.entityContext);try{f=h.Visit(s);u.entityContext.log({event:"EntityExpression",data:f});u.entityContext.executeQuery(Container.createQueryable(u,f),o,r)}catch(c){o.error(c)}return e.getPromise()},find:function(n,t,i){var v=new $data.PromiseHandler,o=v.createCallback(t),s=this.defaultType.memberDefinitions.getKeyProperties(),c,u,f,y,p,w,l,h,a,r,e;try{if(s.length===1&&typeof n!="object"&&(c={},c[s[0].name]=n,n=c),typeof n!="object")throw new Exception("Key parameter is invalid");else{for(u=[],r=0;r<s.length;r++){if(f=s[r],!(f.name in n))throw new Exception("Key value missing");u.push(Container.createConstantExpression(n[f.name],f.type,f.name))}if(y=this.entityContext.storageProvider.supportedSetOperations.find,y){p=Container.createFindExpression(this.expression,u);w=Container.createQueryExpressionCreator(this.entityContext);try{l=w.Visit(p);this.entityContext.log({event:"EntityExpression",data:l});this.entityContext.executeQuery(Container.createQueryable(this,l),o,i)}catch(b){o.error(b)}}else{for(h="",a={},r=0;r<u.length;r++)e=u[r],a[e.name]=e.value,r>0&&(h+=" && "),h+="it."+e.name+" == this."+e.name;this.single(h,a,o,i)}}}catch(b){o.error(b)}return v.getPromise()},include:function(n){this._checkOperation("include");var t=Container.createConstantExpression(n,"string"),i=Container.createIncludeExpression(this.expression,t);return Container.createQueryable(this,i)},withInlineCount:function(n){this._checkOperation("withInlineCount");var t=Container.createConstantExpression(n||"allpages","string"),i=Container.createInlineCountExpression(this.expression,t);return Container.createQueryable(this,i)},removeAll:function(n,t){var i;this._checkOperation("batchDelete");var r=new $data.PromiseHandler,u=r.createCallback(n),f=Container.createBatchDeleteExpression(this.expression),e=Container.createQueryExpressionCreator(this.entityContext);try{i=e.Visit(f);this.entityContext.log({event:"EntityExpression",data:i});this.entityContext.executeQuery(Container.createQueryable(this,i),u,t)}catch(o){u.error(o)}return r.getPromise()},_runQuery:function(n,t){var r=new $data.PromiseHandler,u=r.createCallback(n),f=Container.createQueryExpressionCreator(this.entityContext),i;try{i=f.Visit(this.expression);this.entityContext.log({event:"EntityExpression",data:i});this.entityContext.executeQuery(Container.createQueryable(this,i),u,t)}catch(e){u.error(e)}return r.getPromise()},toTraceString:function(n){var t=this.expression,r,i;return t=n?Container["create"+n+"Expression"](t):Container.createToArrayExpression(t),r=Container.createQueryExpressionCreator(this.entityContext),t=r.Visit(t),i=Container.createQueryable(this,t),i.entityContext.getTraceString(i)},_checkOperation:function(n){var t=this.entityContext.resolveSetOperations(n);t.invokable==undefined||t.invokable||Guard.raise(new Exception("Operation '"+n+"' is not invokable with the provider"))},defaultType:{}},null);$data.EntitySchemaConfig=function(){this.Name=""};$data.entitySetState={created:0,defined:1,active:2};$data.Class.defineEx("$data.EntitySet",[{type:$data.Queryable,params:[new ConstructorParameter(1)]}],null,{constructor:function(n,t,i,r,u){var e,f;this.createNew=this[n.name]=this.elementType=this.defaultType=n;e=this;t["createAdd"+n.name]=function(t){var i=new n(t);return e.add(i)};this.stateManager=new $data.EntityStateManager(this);this.collectionName=i;this.roles=u;for(f in r)this[f]=r[f]},addNew:function(n,t){var r=$data.typeSystem.createCallbackSetting(t),i=new this.createNew(n);return this.entityContext.saveChanges(t),i},executeQuery:function(n,t){var i=$data.typeSystem.createCallbackSetting(t);this.entityContext.executeQuery(n,i)},getTraceString:function(n){return this.entityContext.getTraceString(n)},setContext:function(n){this.entitySetState=$data.entitySetState.active;this.entityContext=n;this.entityContext[this.schema.name]=this[this.schema.name]},_trackEntity:function(n){for(var t=this.entityContext.stateManager.trackedEntities,i=0;i<t.length;i++)if(t[i].data===n)return;t.push({entitySet:this,data:n})},add:function(n){var t=n;return n instanceof $data.EntityWrapper?t=n.getEntity():n instanceof this.createNew||(t=new this.createNew(n)),t.entityState=$data.EntityState.Added,t.changedProperties=undefined,t.context=this.entityContext,this._trackEntity(t),t},addMany:function(n){var t=[],i=this;return n.forEach(function(n){t.push(i.add(n))}),t},remove:function(n){var t=n;n instanceof $data.EntityWrapper?t=n.getEntity():n instanceof this.createNew||(t=new this.createNew(n));t.entityState=$data.EntityState.Deleted;t.changedProperties=undefined;this._trackEntity(t)},attach:function(n,t){var i=n,r,u;for(n instanceof $data.EntityWrapper?i=n.getEntity():n instanceof this.createNew||(i=new this.createNew(n)),r=0;r<this.entityContext.stateManager.trackedEntities.length;r++){if(u=this.entityContext.stateManager.trackedEntities[r],u.data===i)break;u.data.equals(i)&&Guard.raise(new Exception("Context already contains this entity!!!"))}t||(i.entityState=$data.EntityState.Unchanged,i.changedProperties=undefined);i.context=this.entityContext;this._trackEntity(i)},detach:function(n){var r=n,u,i,t,f;for(n instanceof $data.EntityWrapper?r=n.getEntity():n instanceof this.createNew||(r=new this.createNew(n)),i=this.entityContext.stateManager.trackedEntities,t=0;t<i.length;t++)i[t].data.equals(r)&&(u=i[t]);if(u){f=this.entityContext.stateManager.trackedEntities.indexOf(u);n.entityState=$data.EntityState.Detached;this.entityContext.stateManager.trackedEntities.splice(f,1);return}},attachOrGet:function(n){var t=n,u,r,i;for(n instanceof $data.EntityWrapper?t=n.getEntity():n instanceof this.createNew||(t=new this.createNew(n)),r=this.entityContext.stateManager.trackedEntities,i=0;i<r.length;i++)r[i].data.equals(t)&&(u=r[i]);return u?u.data:(t.entityState=$data.EntityState.Unchanged,t.changedProperties=undefined,t.context=this.entityContext,this._trackEntity(t),t)},loadItemProperty:function(n,t,i){return this.entityContext.loadItemProperty(n,t,i)},saveChanges:function(){return this.entityContext.saveChanges.apply(this.entityContext,arguments)},addProperty:function(){return this.elementType.addProperty.apply(this.elementType,arguments)},expression:{get:function(){if(!this._expression){var n=Container.createEntityContextExpression(this.entityContext),t=this.entityContext.getType().getMemberDefinition(this.collectionName),i=Container.createEntitySetExpression(n,Container.createMemberInfoExpression(t),null,this);this._expression=i}return this._expression},set:function(n){this._expression=n}},getFieldUrl:function(n,t){return this.entityContext.getFieldUrl(n,t,this)},bulkInsert:function(n,t,i){return this.entityContext.bulkInsert(this,n,t,i)}},null);$data.EntityState={Detached:0,Unchanged:10,Added:20,Modified:30,Deleted:40};$data.Class.define("$data.EntityStateManager",null,null,{constructor:function(n){this.entityContext=null;this.trackedEntities=[];this.init(n)},init:function(n){this.entityContext=n},reset:function(){this.trackedEntities=[]}},null);$data.Class.define("$data.ItemStoreClass",null,null,{constructor:function(){var n=this;n.itemStoreConfig={aliases:{},contextTypes:{}};n.resetStoreToDefault("local",!0);$data.addStore=function(){return n.addItemStoreAlias.apply(n,arguments)};$data.implementation=n.implementation;$data.Entity.addMember("storeToken",{get:function(){if(this.storeConfigs&&this.storeConfigs["default"])return this.storeConfigs.stores[this.storeConfigs["default"]]},set:function(t){n._setTypeStoreConfig(this,"default",t)}},!0)},itemStoreConfig:{},addItemStoreAlias:function(n,t,i){var r=this,u=new $data.PromiseHandler,f=u.createCallback(),s,e,o;if("string"==typeof n){if("object"==typeof t&&"factory"in t)return s=Container.resolveType(t.typeName),r.itemStoreConfig.aliases[n]=t.factory,r.itemStoreConfig.contextTypes[n]=s,i&&(r.itemStoreConfig["default"]=n),f.success(),u.getPromise();if("function"==typeof t)return e=t(),e&&e instanceof $data.EntityContext?(f.success(e),o=u.getPromise()):o=e,o.then(function(e){return typeof e=="function"?r.addItemStoreAlias(n,e,i):e instanceof $data.EntityContext?e.onReady().then(function(u){return r.itemStoreConfig.aliases[n]=t,r.itemStoreConfig.contextTypes[n]=u.getType(),i&&(r.itemStoreConfig["default"]=n),u}):(u=new $data.PromiseHandler,f=u.createCallback(),f.error(new Exception("factory dont have context instance","Invalid arguments")),u.getPromise())})}return f.error(new Exception("Name or factory missing","Invalid arguments")),u.getPromise()},resetStoreToDefault:function(n,t){this.itemStoreConfig.aliases[n]=this._getDefaultItemStoreFactory;delete this.itemStoreConfig.contextTypes[n];t&&(this.itemStoreConfig["default"]=n)},_setStoreAlias:function(n,t){return"object"!=typeof t||n.storeToken||(n.storeToken=t),n},_getStoreAlias:function(n,t){var i,r;if(n instanceof $data.Entity){if(r=t||n.storeToken,r)return r;i=n.getType()}else i=n;return t||(i.storeConfigs?i.storeConfigs["default"]:undefined)||i.storeToken},_getStoreContext:function(n,t,i){var r=this._getContextPromise(n,t),u,f;return(!r||r instanceof $data.EntityContext)&&(u=new $data.PromiseHandler,f=u.createCallback(),f.success(r),r=u.getPromise()),r.then(function(n){if(n instanceof $data.EntityContext)return n.onReady();if(i)return null;var t=new $data.PromiseHandler,r=t.createCallback();return r.error(new Exception("factory return type error","Error")),t.getPromise()})},_getContextPromise:function(n,t){if(n&&"object"==typeof n&&"function"==typeof n.factory)return n.factory(t);if(n&&"object"==typeof n&&"object"==typeof n.args&&"string"==typeof n.typeName){var t=Container.resolveType(n.typeName);return new t(JSON.parse(JSON.stringify(n.args)))}return n&&"string"==typeof n&&t.storeConfigs&&t.storeConfigs.stores[n]&&typeof t.storeConfigs.stores[n].factory=="function"?t.storeConfigs.stores[n].factory():n&&"string"==typeof n&&t.storeConfigs&&t.storeConfigs.stores[n]?this._getDefaultItemStoreFactory(t,t.storeConfigs.stores[n]):n&&"string"==typeof n&&this.itemStoreConfig.aliases[n]?this.itemStoreConfig.aliases[n](t):n&&"function"==typeof n?n():this.itemStoreConfig.aliases[this.itemStoreConfig["default"]](t)},_getStoreEntitySet:function(n,t){var r=this._getStoreAlias(t,n),i="function"==typeof t?t:t.getType();return this._getStoreContext(r,i).then(function(n){var r=n.getEntitySetFromElementType(i),t,u;return r?r:(t=new $data.PromiseHandler,u=t.createCallback(),u.error("EntitySet not exist for "+i.fullName),t.getPromise())})},_getDefaultItemStoreFactory:function(n,t){var o,f;if(n){var e="function"==typeof n?n:n.getType(),r=$data.Container.resolveName(e)+"_items",r=r.replace(/\./g,"_"),i=$data.typeSystem.extend({collectionName:t&&t.collectionName?t.collectionName:"Items",tableName:r,initParam:{provider:"local",databaseName:r}},t),u={};return u[i.collectionName]={type:$data.EntitySet,elementType:e},i.tableName&&(u[i.collectionName].tableName=i.tableName),o=$data.EntityContext.extend(r,u),f=new o(i.initParam),t&&typeof t=="object"&&(t.factory=f._storeToken.factory),f}return undefined},implementation:function(n,t){var i=$data.ItemStore,r;return typeof t=="string"?t=i.itemStoreConfig.contextTypes[t]:t instanceof $data.EntityContext?t=t.getType():typeof t=="function"&&t.isAssignableTo||(t=i.itemStoreConfig.contextTypes[i.itemStoreConfig["default"]]),t&&(r=i._resolveFromContext(t,n)),r||(r=Container.resolveType(n)),r},_resolveFromContext:function(n,t){for(var i,u,f,e=n.memberDefinitions.getPublicMappedProperties(),r=0;r<e.length;r++)if(i=e[r],i.type&&(u=Container.resolveType(i.type),u.isAssignableTo&&u.isAssignableTo($data.EntitySet)&&(f=Container.resolveType(i.elementType),f.name===t)))return f;return null},EntityInstanceSave:function(n,t){var r=$data.ItemStore,i=this;return r._getStoreEntitySet(n,i).then(function(u){return r._getSaveMode(i,u,t,n).then(function(n){n=n||"add";switch(n){case"add":u.add(i);break;case"attach":u.attach(i,!0);i.entityState=$data.EntityState.Modified;break;default:var t=new $data.PromiseHandler,f=t.createCallback();return f.error("save mode not supported: "+n),t.getPromise()}return u.entityContext.saveChanges().then(function(){return r._setStoreAlias(i,u.entityContext.storeToken),i})})})},EntityInstanceRemove:function(n){var i=$data.ItemStore,t=this;return i._getStoreEntitySet(n,t).then(function(n){return n.remove(t),n.entityContext.saveChanges().then(function(){return t})})},EntityInstanceRefresh:function(n,t){var u=$data.ItemStore,i=this,r=i.getType(),f=u._getKeyObjectFromEntity(i,r);return r.read(f,n).then(function(n){return r.memberDefinitions.getPublicMappedProperties().forEach(function(t){i[t.name]=n[t.name]}),i.storeToken=(t?i.storeToken:undefined)||n.storeToken,i.changedProperties=undefined,i})},EntityInheritedTypeProcessor:function(n){var t=$data.ItemStore;n.readAll=t.EntityTypeReadAll(n);n.read=t.EntityTypeRead(n);n.removeAll=t.EntityTypeRemoveAll(n);n.remove=t.EntityTypeRemove(n);n.get=t.EntityTypeGet(n);n.save=t.EntityTypeSave(n);n.addMany=t.EntityTypeAddMany(n);n.itemCount=t.EntityTypeItemCount(n);n.query=t.EntityTypeQuery(n);n.takeFirst=t.EntityTypeTakeFirst(n);n.setStore=t.EntityTypeSetStore(n)},EntityTypeReadAll:function(n){return function(t){var i=$data.ItemStore;return i._getStoreEntitySet(t,n).then(function(n){return n.forEach(function(t){i._setStoreAlias(t,n.entityContext.storeToken)})})}},EntityTypeRemoveAll:function(n){return function(t){var i=$data.ItemStore;return i._getStoreEntitySet(t,n).then(function(n){return n.toArray().then(function(t){return t.forEach(function(t){n.remove(t)}),n.entityContext.saveChanges().then(function(){return t})})})}},EntityTypeRead:function(n){return function(t,i){var r=$data.ItemStore;return r._getStoreEntitySet(i,n).then(function(n){var i,u,f;try{return i=r._findByIdQueryable(n,t),n.single(i.predicate,i.thisArgs).then(function(t){return r._setStoreAlias(t,n.entityContext.storeToken)})}catch(e){return u=new $data.PromiseHandler,f=u.createCallback(),f.error(e),u.getPromise()}})}},EntityTypeGet:function(n){return function(t,i){var u=$data.ItemStore,r=new n(u._getKeyObjectFromEntity(t));return r.refresh(i),r}},EntityTypeSave:function(n){return function(t,i,r){var f=$data.ItemStore,u=new n(t);return u.save(i,r)}},EntityTypeAddMany:function(n){return function(t,i){var r=$data.ItemStore;return r._getStoreEntitySet(i,n).then(function(n){var i=n.addMany(t);return n.entityContext.saveChanges().then(function(){return i})})}},EntityTypeRemove:function(n){return function(t,i){var e=$data.ItemStore,f=n.memberDefinitions.getKeyProperties(),r,u;return f.length===1?(u={},u[f[0].name]=t,r=new n(u)):r=new n(t),r.remove(i)}},EntityTypeItemCount:function(n){return function(t){var i=$data.ItemStore;return i._getStoreEntitySet(t,n).then(function(n){return n.length()})}},EntityTypeQuery:function(n){return function(t,i,r){var u=$data.ItemStore;return u._getStoreEntitySet(r,n).then(function(n){return n.filter(t,i).forEach(function(t){u._setStoreAlias(t,n.entityContext.storeToken)})})}},EntityTypeTakeFirst:function(n){return function(t,i,r){var u=$data.ItemStore;return u._getStoreEntitySet(r,n).then(function(n){return n.first(t,i).then(function(t){return u._setStoreAlias(t,n.entityContext.storeToken)})})}},EntityTypeSetStore:function(n){return function(t,i){var e,u,r,f,o;if(typeof t=="object"&&typeof i=="undefined"&&(i=t,t="default"),e=$data.ItemStore,u={},i){if(i.tableName&&(u.tableName=i.tableName,delete i.tableName),i.collectionName&&(u.collectionName=i.collectionName,delete i.collectionName),typeof i.dataSource=="string"){r=i.dataSource;r.lastIndexOf("/")===r.length-1&&(r=r.substring(0,r.lastIndexOf("/")));f=r.substring(0,r.lastIndexOf("/"));u.tableName||(u.tableName=r.substring(r.lastIndexOf("/")+1));o=i.provider||i.name;switch(o){case"oData":i.oDataServiceHost=i.oDataServiceHost||f;break;case"webApi":i.apiUrl=i.apiUrl||f}}}else i={name:"local"};return u.initParam=i,e._setTypeStoreConfig(n,t,u),n}},_setTypeStoreConfig:function(n,t,i){n.storeConfigs||(n.storeConfigs={stores:{}});n.storeConfigs.stores[t]=i;t==="default"&&(n.storeConfigs["default"]=t)},_findByIdQueryable:function(n,t){var i=n.defaultType.memberDefinitions.getKeyProperties(),f,e,r,u;if(i.length>1&&t&&"object"==typeof t){for(f="",e={},r=0;r<i.length;r++)r>0&&(f+=" && "),u=i[r],f+="it."+u.name+" == this."+u.name,e[u.name]=t[u.name];return{predicate:f,thisArgs:e}}if(i.length===1)return{predicate:"it."+i[0].name+" == this.value",thisArgs:{value:t}};throw"invalid keys";},_getKeyObjectFromEntity:function(n,t){var r,i=t.memberDefinitions.getKeyProperties(),u;if(i.length===1)r=n&&typeof n=="object"?n[i[0].name]:n;else for(r={},u=0;u<i.length;u++)r[i[0].name]=n?n[i[0].name]:n;return r},_getSaveMode:function(n,t,i,r){var o=this,e=new $data.PromiseHandler,u=e.createCallback(),f=n.getType();switch(!0){case i==="update":u.success("attach");break;case i==="new":u.success("add");break;case!1===f.memberDefinitions.getKeyProperties().every(function(t){return n[t.name]}):u.success("add");break;case!!n.storeToken:u.success("attach");break;default:r=this._getStoreAlias(n,r);f.read(o._getKeyObjectFromEntity(n,f),r).then(function(){u.success("attach")}).fail(function(){u.success("add")})}return e.getPromise()},ContextRegister:function(n){var o=this,e=JSON.parse(JSON.stringify(n)),u,t,i,r,f;for(this.storeToken={typeName:this.getType().fullName,args:e,factory:function(){return new(o.getType())(e)}},u=this.getType().memberDefinitions.getPublicMappedProperties(),t=0;t<u.length;t++)i=u[t],i.type&&(r=Container.resolveType(i.type),r&&r.isAssignableTo&&r.isAssignableTo($data.EntitySet)&&(f=Container.resolveType(i.elementType),f.storeToken||(f.storeToken=this.storeToken)))},QueryResultModifier:function(n){var e=$data.ItemStore,o=n.context,i=n.modelBinderConfig.$type,s,t,f,r,u;if("string"==typeof i&&(i=Container.resolveType(i)),i===$data.Array&&n.modelBinderConfig.$item&&n.modelBinderConfig.$item.$type&&(i=n.modelBinderConfig.$item.$type),typeof i=="undefined"&&n.result&&n.result[0]instanceof $data.Entity)for(s=i?i.memberDefinitions.getPublicMappedProperties().filter(function(n){return!!n.inverseProperty}):[],t=0;t<n.result.length;t++)for(e._setStoreAlias(n.result[t],o.storeToken),f=0;f<s.length;f++)if(r=s[f],n.result[t][r.name]instanceof $data.Entity)e._setStoreAlias(n.result[t][r.name],o.storeToken);else if(Array.isArray(n.result[t][r.name]))for(u=0;u<n.result[t][r.name].length;u++)n.result[t][r.name][u]instanceof $data.Entity&&e._setStoreAlias(n.result[t][r.name][u],o.storeToken)}});$data.ItemStore=new $data.ItemStoreClass;$data.Entity.addMember("field",function(n){var t=this.memberDefinitions.getMember(n);if(t){if(t.definedBy===this)return new $data.MemberWrapper(t);Guard.raise(new Exception("Member '"+n+"' defined on '"+t.definedBy.fullName+"'!","Invalid Operation"))}else Guard.raise(new Exception("Member '"+n+"' not exists!","Invalid Operation"));return this},!0);$data.Class.define("$data.MemberWrapper",null,null,{constructor:function(n){this.memberDefinition=n},setKey:function(n){return this.memberDefinition.key=n||n===undefined?!0:!1,this},setComputed:function(n){return this.memberDefinition.computed=n||n===undefined?!0:!1,this},setRequired:function(n){return this.memberDefinition.required=n||n===undefined?!0:!1,this},setNullable:function(n){return this.memberDefinition.nullable=n||n===undefined?!0:!1,this},changeDefinition:function(n,t){return this.memberDefinition[n]=t,this}});$data.Class.define("$data.StorageProviderLoaderBase",null,null,{isSupported:function(n){$data.Trace.log("Detecting "+n+" provider support");var t=!0;switch(n){case"indexedDb":t=window.indexedDB||window.webkitIndexedDB||window.mozIndexedDB||window.msIndexedDB&&!/^file:/.test(window.location.href);break;case"storm":t="XMLHttpRequest"in window;break;case"webSql":case"sqLite":t="openDatabase"in window;break;case"LocalStore":t="localStorage"in window&&window.localStorage?!0:!1;break;case"sqLite":t="openDatabase"in window;break;case"mongoDB":t=$data.mongoDBDriver}return $data.Trace.log(n+" provider is "+(t?"":"not")+" supported"),t},scriptLoadTimeout:{type:"int",value:1e3},scriptLoadInterval:{type:"int",value:50},npmModules:{value:{indexedDb:"jaydata-indexeddb",InMemory:"jaydata-inmemory",LocalStore:"jaydata-inmemory",mongoDB:"jaydata-mongodb",oData:"jaydata-odata",webApi:"jaydata-webapi",sqLite:"jaydata-sqlite",webSql:"jaydata-sqlite",storm:"jaydata-storm"}},ProviderNames:{value:{indexedDb:"IndexedDb",InMemory:"InMemory",LocalStore:"InMemory",oData:"oData",webApi:"WebApi",sqLite:"SqLite",webSql:"SqLite",storm:"Storm"}},load:function(n,t){$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||{};$data.Trace.log("Loading provider(s): "+n);t=$data.typeSystem.createCallbackSetting(t);var i=this,r=n.join(",");i._fallbackCache=i._fallbackCache||{};i._fallbackCache[r]?t.success(i._fallbackCache[r]):this.find(n,{success:function(n){i._fallbackCache[r]=n;t.success.call(this,n)},error:t.error})},find:function(n,t){var i=n.shift(),i=this.getVirtual(i),r;for(Array.isArray(i)&&(n=i,i=n.shift());i&&!this.isSupported(i);)i=n.shift();if($data.Trace.log("First supported provider is "+i),i||($data.Trace.log("Provider fallback failed"),t.error()),$data.RegisteredStorageProviders){if($data.Trace.log("Is the "+i+" provider already registered?"),r=$data.RegisteredStorageProviders[i],r){$data.Trace.log(i+" provider registered");t.success(r);return}$data.Trace.log(i+" provider not registered")}typeof module!="undefined"&&typeof module.exports!="undefined"?($data.Trace.log("node.js detected trying to load NPM module"),this.loadNpmModule(i,n,t)):($data.Trace.log("Browser detected trying to load provider"),this.loadProvider(i,n,t))},loadProvider:function(n,t,i){var e=this,r=$data.StorageProviderLoader.ProviderNames[n]||n,u,f;$data.Trace.log(n+" provider is mapped to name "+r+"Provider");r&&(u=this.getUrl(r),$data.Trace.log(n+" provider from URL: "+u),f=this.loadScript,document&&document.createElement&&($data.Trace.log("document and document.createElement detected, using script element loader method"),f=this.loadScriptElement),f.call(this,u,n,function(r){var u=$data.RegisteredStorageProviders[n];r&&u?($data.Trace.log(n+" provider successfully registered"),i.success(u)):t.length>0?($data.Trace.log(n+" provider failed to load, trying to fallback to "+t+" provider(s)"),e.find(t,i)):($data.Trace.log(n+" provider failed to load"),i.error())}))},getUrl:function(n){var t=document.querySelector('script[src$="jaydata.min.js"]'),i=document.querySelector('script[src$="jaydata.js"]');return t?t.src.substring(0,t.src.lastIndexOf("/")+1)+"jaydataproviders/"+n+"Provider.min.js":i?i.src.substring(0,i.src.lastIndexOf("/")+1)+"jaydataproviders/"+n+"Provider.js":"jaydataproviders/"+n+"Provider.js"},loadScript:function(n,t,i){function u(){if(window.XMLHttpRequest)return new XMLHttpRequest;if(window.ActiveXObject!==undefined)return new ActiveXObject("MsXml2.XmlHttp");$data.Trace.log("XMLHttpRequest or MsXml2.XmlHttp ActiveXObject not found");i(!1);return}if(!n){i(!1);return}var r=u();r.onreadystatechange=function(){$data.Trace.log("HTTP request is in state: "+r.readyState);r.readyState==4&&(r.status==200||r.status==304?($data.Trace.log("HTTP request succeeded"),$data.Trace.log("HTTP request response text: "+r.responseText),eval.call(window,r.responseText),typeof i=="function"?i(!0):$data.Trace.log("Callback function is undefined")):($data.Trace.log("HTTP request status: ",r.status),typeof i=="function"?i(!1):$data.Trace.log("Callback function is undefined")))};r.open("GET",n,!0);r.send(null)},loadScriptElement:function(n,t,i){function o(){$data.Trace.log("Script element watcher iteration "+r);var n=$data.RegisteredStorageProviders[t];n?($data.Trace.log(t+" provider registered"),i(!0)):(r--,r>0?($data.Trace.log("Script element watcher next iteration"),setTimeout(o,f)):($data.Trace.log("Script element loader failed"),i(!1)))}var e=document.getElementsByTagName("head")[0]||document.documentElement,u=document.createElement("script"),f,r;u.type="text/javascript";u.src=n;$data.Trace.log("Appending child "+u+" to "+e);e.appendChild(u);f=this.scriptLoadInterval||50;r=Math.ceil(this.scriptLoadTimeout/f);$data.Trace.log("Script element watcher iterating "+r+" times");setTimeout(o,f)},loadNpmModule:function(n,t,i){var r=null;try{require(this.npmModules[n]);r=$data.RegisteredStorageProviders[n];$data.Trace.log("NPM module loader successfully registered "+n+" provider")}catch(u){$data.Trace.log("NPM module loader failed for "+n+" provider")}r?i.success(r):t.length>0?this.find(t,i):i.error()},virtualProviders:{type:$data.Array,value:{local:{fallbacks:["webSql","indexedDb","LocalStore"]}}},getVirtual:function(n){return this.virtualProviders[n]?[].concat(this.virtualProviders[n].fallbacks):n}});$data.StorageProviderLoader=new $data.StorageProviderLoaderBase;$data.storageProviders={DbCreationType:{Merge:10,DropTableIfChanged:20,DropTableIfChange:20,DropAllExistingTables:30,ErrorIfChange:40,DropDbIfChange:50}};$data.ConcurrencyMode={Fixed:"fixed",None:"none"};$data.Class.define("$data.StorageProviderBase",null,null,{constructor:function(n){var i,t;if(this.providerConfiguration=n||{},this.name=this.getType().name,$data.RegisteredStorageProviders)for(i=Object.keys($data.RegisteredStorageProviders),t=0;t<i.length;t++)if(this instanceof $data.RegisteredStorageProviders[i[t]]){this.name=i[t];break}},providers:{},supportedDataTypes:{value:[],writable:!1},initializeStore:function(){Guard.raise("Pure class")},executeQuery:function(){Guard.raise("Pure class")},loadRawData:function(n,t){t=$data.typeSystem.createCallbackSetting(t);t.error(new Exception("loadRawData is not supported","Invalid Operation"))},buildIndependentBlocks:function(n){function g(n){for(var t in n)if(n.hasOwnProperty(t))return!0;return!1}for(var i,r,h,w,u,c,b,f,l,t,e,k,a,y,p,d,o=[],v=[],s=0;s<n.length;s++)if(i=n[s],i.dependentOn&&i.dependentOn.length!=0){for(r=null,h=0;h<i.dependentOn.length;h++)if(w=i.dependentOn[h],w.entityState!=$data.EntityState.Unchanged){for(r=r||{},u=-1,c=0;c<n.length;c++)if(n[c].data==w){u=c;break}u==-1&&Guard.raise(new Exception("Dependent object not found","ObjectNotFound",i.dependentOn[h]));r[u]=!0;from=v[u]||{};from[s]=!0;v[u]=from}r!==null&&(o[s]=r)}for(b=[],f=[],l=0;l<n.length;l++)o.hasOwnProperty(l)||f.push(l);while(f.length>0){for(t=[].concat(f),f=[],e=0;e<t.length;e++){if(k=v[t[e]],typeof k!="undefined")for(a in k)delete o[a][t[e]],g(o[a])||(delete o[a],f.push(a));delete v[t[e]]}for(y=[],p=0;p<t.length;p++)d=n[t[p]],d.data.entityState!=$data.EntityState.Unchanged&&y.push(d);y.length>0&&b.push(y)}return b},getTraceString:function(){Guard.raise("Pure class")},setContext:function(n){this.context=n},_buildContinuationFunction:function(n,t){Array.isArray(t.result)&&(t.result.next=this._buildPagingMethod(n,t,"next"),t.result.prev=this._buildPagingMethod(n,t,"prev"))},_buildPagingMethod:function(n,t,i){return function(r){var e=new $data.PromiseHandler,o=e.createCallback(r),s=new $data.Expressions.ContinuationExpressionBuilder(i),u=s.compile(t),f;return u.expression?(f=Container.createQueryable(n,u.expression),f.defaultType=t.defaultType,n.executeQuery(f,o)):o.error(new Exception(u.message,"Invalid Operation",u)),e.getPromise()}},buildDbType_modifyInstanceDefinition:function(n,t){var i=function(t,i){var r;return i?(r=JSON.parse(JSON.stringify(n[i])),r.kind=t.kind,r.name=t.name,r.notMapped=!1):r=JSON.parse(JSON.stringify(t)),r.dataType=Container.resolveType(t.dataType),r.type=r.dataType,r.key=!1,r.computed=!1,r},r=function(n,t,i,r){var u={};return u[n.name]=i,u[t.name]=r+"__"+i,u};t.Associations&&t.Associations.forEach(function(t){var e=!1,f=t.FromType,o=t.ToType,u=t.ToPropertyName;t.ReferentialConstraint=t.ReferentialConstraint||[];(t.FromMultiplicity=="*"&&t.ToMultiplicity=="0..1"||t.FromMultiplicity=="0..1"&&t.ToMultiplicity=="1")&&(f=t.ToType,o=t.FromType,u=t.FromPropertyName,e=!0);f.memberDefinitions.getPublicMappedProperties().filter(function(n){return n.key}).forEach(function(s){e&&(n[u+"__"+s.name]=i(s,u));t.ReferentialConstraint.push(r(f,o,s.name,u))},this)},this);t.ComplexTypes&&t.ComplexTypes.forEach(function(t){t.ReferentialConstraint=t.ReferentialConstraint||[];t.ToType.memberDefinitions.getPublicMappedProperties().forEach(function(u){n[t.FromPropertyName+"__"+u.name]=i(u);t.ReferentialConstraint.push(r(t.ToType,t.FromType,u.name,t.FromPropertyName))},this)},this)},buildDbType_generateConvertToFunction:function(n){return function(t){var i=new n.PhysicalType;return i.entityState=t.entityState,n.PhysicalType.memberDefinitions.getPublicMappedProperties().forEach(function(n){t[n.name]!==undefined&&(i[n.name]=t[n.name])},this),n.Associations&&n.Associations.forEach(function(n){if(n.FromMultiplicity=="*"&&n.ToMultiplicity=="0..1"||n.FromMultiplicity=="0..1"&&n.ToMultiplicity=="1"){var r=t[n.FromPropertyName];r!==undefined&&n.ReferentialConstraint.forEach(function(t){i[t[n.From]]=r!==null?r[t[n.To]]:null},this)}},this),n.ComplexTypes&&n.ComplexTypes.forEach(function(n){var r=t[n.FromPropertyName];r!==undefined&&n.ReferentialConstraint.forEach(function(t){i[t[n.From]]=r!==null?r[t[n.To]]:null},this)},this),i}},bulkInsert:function(n,t,i,r){r.error(new Exception("Not Implemented"))},supportedFieldOperations:{value:{length:{dataType:"number",allowedIn:"filter, map"},substr:{dataType:"string",allowedIn:"filter",parameters:[{name:"startFrom",dataType:"number"},{name:"length",dataType:"number"}]},toLowerCase:{dataType:"string"}},enumerable:!0,writable:!0},resolveFieldOperation:function(n,t,i){var r=this.supportedFieldOperations[n],u;if(Array.isArray(r)){for(u=0;u<r.length;u++)if(r[u].allowedType==="default"||Container.resolveType(r[u].allowedType)===Container.resolveType(t.selector.memberDefinition.type)&&i&&r[u].allowedIn&&(Array.isArray(r[u].allowedIn)&&r[u].allowedIn.some(function(n){return i===Container.resolveType(n)})||!Array.isArray(r[u].allowedIn)&&i===Container.resolveType(r[u].allowedIn))){r=r[u];break}u===r.length&&(r=undefined)}return r||Guard.raise(new Exception("Field operation '"+n+"' is not supported by the provider")),i&&r.allowedIn&&((!(r.allowedIn instanceof Array)||r.allowedIn.some(function(n){return i===Container.resolveType(n)}))&&(r.allowedIn instanceof Array||i===Container.resolveType(r.allowedIn))||Guard.raise(new Exception(n+" not supported in: "+i.name))),r.name=n,r},supportedBinaryOperators:{value:{equal:{mapTo:"eq",dataType:"boolean"}},enumerable:!0,writable:!0},resolveBinaryOperator:function(n,t,i){var r=this.supportedBinaryOperators[n];return r||Guard.raise(new Exception("Binary operator '"+n+"' is not supported by the provider")),i&&r.allowedIn&&((!(r.allowedIn instanceof Array)||r.allowedIn.some(function(n){return i===Container.resolveType(n)}))&&(r.allowedIn instanceof Array||i===Container.resolveType(r.allowedIn))||Guard.raise(new Exception(n+" not supported in: "+i.name))),r.name=n,r},supportedUnaryOperators:{value:{not:{mapTo:"not"}},enumerable:!0,writable:!0},resolveUnaryOperator:function(n,t,i){var r=this.supportedUnaryOperators[n];return r||Guard.raise(new Exception("Unary operator '"+n+"' is not supported by the provider")),i&&r.allowedIn&&((!(r.allowedIn instanceof Array)||r.allowedIn.some(function(n){return i===Container.resolveType(n)}))&&(r.allowedIn instanceof Array||i===Container.resolveType(r.allowedIn))||Guard.raise(new Exception(n+" not supported in: "+i.name))),r.name=n,r},supportedSetOperations:{value:{toArray:{invokable:!0,allowedIn:[]}},enumerable:!0,writable:!0},resolveSetOperations:function(n,t,i){var u=this.supportedSetOperations[n],r;return u||Guard.raise(new Exception("Operation '"+n+"' is not supported by the provider")),r=u.allowedIn||[],i&&r&&((!(r instanceof Array)||r.some(function(n){return i===Container.resolveType(n)}))&&(r instanceof Array||i===Container.resolveType(r))||Guard.raise(new Exception(n+" not supported in: "+i.name))),u},resolveTypeOperations:function(n,t){Guard.raise(new Exception("Entity '"+t.entityType.name+"' Operation '"+n+"' is not supported by the provider"))},resolveContextOperations:function(n,t){Guard.raise(new Exception("Context '"+t.instance.getType().name+"' Operation '"+n+"' is not supported by the provider"))},makePhysicalTypeDefinition:function(){},_beginTran:function(n,t,i){i.success(new $data.Transaction)},getFieldUrl:function(){return"#"},supportedAutoincrementKeys:{value:{}}},{onRegisterProvider:{value:new $data.Event},registerProvider:function(n,t){this.onRegisterProvider.fire({name:n,provider:t},this);$data.RegisteredStorageProviders=$data.RegisteredStorageProviders||[];$data.RegisteredStorageProviders[n]=t},getProvider:function(n){var t=$data.RegisteredStorageProviders[n];return t||console.warn("Provider not found: '"+n+"'"),t},isSupported:{get:function(){return!0},set:function(){}}});$data.Class.define("$data.ServiceOperation",null,null,{},{translateDefinition:function(n,t){n.serviceName=t;var i=new $data.MemberDefinition(this.generateServiceOperation(n),this);return i.name=t,i},generateServiceOperation:function(n){var t,i,r;return n.serviceMethod?(i=n.returnType?Container.resolveType(n.returnType):{},t=i.isAssignableTo&&i.isAssignableTo($data.Queryable)?n.serviceMethod:function(){var u=arguments[arguments.length-1],i=new $data.PromiseHandler,t,e=arguments,r;typeof u=="function"?(t=i.createCallback(u),arguments[arguments.length-1]=t):(t=i.createCallback(),arguments.push(t));try{r=n.serviceMethod.apply(this,arguments);r!==undefined&&t.success(r)}catch(f){t.error(f)}return i.getPromise()}):t=function(){var u=this,c,s,e,y,l,h,a,i,t,p,o,r,v,f;if(this instanceof $data.Entity||this instanceof $data.EntitySet){if(this instanceof $data.Entity)if(this.context)u=this.context,e=u.getEntitySetFromElementType(this.getType());else if(this.storeToken&&typeof this.storeToken.factory=="function")u=this.storeToken.factory(),e=u.getEntitySetFromElementType(this.getType());else{Guard.raise(new Exception("entity can't resolve context","Not Found!",this));return}else this instanceof $data.EntitySet&&(u=this.entityContext,e=this,y=u.getType().getMemberDefinition(e.name),c=$data.MemberDefinition.translateDefinition(y.actions[n.serviceName],n.serviceName,e.getType()));s={data:this,entitySet:e}}if(l=n.elementType?u.getEntitySetFromElementType(Container.resolveType(n.elementType)):null,h=null,n.params)if(h=[],arguments[0]&&typeof arguments[0]=="object"&&arguments[0].constructor===$data.Object&&n.params&&n.params[0]&&n.params[0].name in arguments[0])for(a=arguments[0],i=0;i<n.params.length;i++)t=n.params[i],t.name&&t.type&&t.name in a&&h.push(Container.createConstantExpression(a[t.name],Container.resolveType(t.type),t.name));else for(i=0;i<n.params.length;i++){if(typeof arguments[i]=="function")break;t=n.params[i];t.name&&t.type&&arguments[i]!==undefined&&h.push(Container.createConstantExpression(arguments[i],Container.resolveType(t.type),t.name))}return p=Container.createEntityContextExpression(u),c||(c=s&&s.data?s.data.getType().getMemberDefinition(n.serviceName):u.getType().getMemberDefinition(n.serviceName)),o=Container.createServiceOperationExpression(p,Container.createMemberInfoExpression(c),h,n,s),r=arguments[arguments.length-1],typeof r=="function"||typeof r=="object"&&(typeof r.success=="function"||typeof r.error=="function")||(r=undefined),l?(f=Container.createQueryable(l,o),r)?(o.isTerminated=!0,f._runQuery(r)):f:(v=n.returnType?Container.resolveType(n.returnType):null,f=Container.createQueryable(u,o),f.defaultType=v||$data.Object,v===$data.Queryable)?(f.defaultType=Container.resolveType(n.elementType),r)?(o.isTerminated=!0,f._runQuery(r)):f:(o.isTerminated=!0,f._runQuery(r))},r=n.params||[],$data.typeSystem.extend(t,n,{params:r}),t}});$data.Class.define("$data.ServiceAction",$data.ServiceOperation,null,{},{generateServiceOperation:function(n){return n.method||(n.method="POST"),$data.ServiceOperation.generateServiceOperation.apply(this,arguments)}});$data.Base.extend("$data.EntityWrapper",{getEntity:function(){Guard.raise("pure object")}});typeof jQuery!="undefined"&&jQuery.ajax&&($data.ajax=$data.ajax||jQuery.ajax);typeof WinJS!="undefined"&&WinJS.xhr&&($data.ajax=$data.ajax||function(n){var i,t;$data.typeSystem.extend(n,{dataType:"json",headers:{}});i={json:{accept:"application/json, text/javascript",convert:JSON.parse},text:{accept:"text/plain",convert:function(n){return n}},html:{accept:"text/html",convert:function(n){return n}},xml:{accept:"application/xml, text/xml",convert:function(n){return n}}};t=i[n.dataType.toLowerCase()];n.headers.Accept=t.accept;var r=n.success||$data.defaultSuccessCallback,u=n.error||$data.defaultErrorCallback,f=n.progress,e=function(n){var i=t.convert(n.responseText);r(i)},o=function(n){var i=t.convert(n.responseText);u(i)},s=f;WinJS.xhr(n).done(e,o,s)});typeof Ext!="undefined"&&typeof Ext.Ajax&&($data.ajax=$data.ajax||function(n){Ext.Ajax.request(n)});$data.ajax=$data.ajax||function(){var n=arguments[arguments.length-1],t=$data.typeSystem.createCallbackSetting(n);t.error("Not implemented")};$C("$data.modelBinder.FindProjectionVisitor",$data.Expressions.EntityExpressionVisitor,null,{VisitProjectionExpression:function(n){this.projectionExpression=n}});$C("$data.modelBinder.ModelBinderConfigCompiler",$data.Expressions.EntityExpressionVisitor,null,{constructor:function(n,t,i){this._query=n;this._includes=t;this._isoDataProvider=i||!1},VisitSingleExpression:function(n){this._defaultModelBinder(n)},VisitSomeExpression:function(n){this._defaultModelBinder(n)},VisitFindExpression:function(n){this._defaultModelBinder(n)},VisitEveryExpression:function(n){this._defaultModelBinder(n)},VisitToArrayExpression:function(n){this._defaultModelBinder(n)},VisitFirstExpression:function(n){this._defaultModelBinder(n)},VisitForEachExpression:function(n){this._defaultModelBinder(n)},VisitServiceOperationExpression:function(n){var t,i;n.cfg.returnType&&(t=Container.resolveType(n.cfg.returnType),typeof t.isAssignableTo=="function"&&t.isAssignableTo($data.Queryable)||t===$data.Array?this._defaultModelBinder(n):(i=Container.createqueryBuilder(),i.modelBinderConfig.$type=t,typeof t.isAssignableTo=="function"&&t.isAssignableTo($data.Entity)?i.modelBinderConfig.$selector=["json:"+n.cfg.serviceName]:(i.modelBinderConfig.$type=t,i.modelBinderConfig.$value=function(t,i){return n.cfg.serviceName in i?i[n.cfg.serviceName]:i.value}),this.VisitExpression(n,i),i.resetModelBinderProperty(),this._query.modelBinderConfig=i.modelBinderConfig))},VisitCountExpression:function(){var n=Container.createqueryBuilder();n.modelBinderConfig.$type=$data.Array;n.selectModelBinderProperty("$item");n.modelBinderConfig.$type=$data.Integer;n.modelBinderConfig.$source="cnt";n.resetModelBinderProperty();this._query.modelBinderConfig=n.modelBinderConfig},VisitBatchDeleteExpression:function(){var n=Container.createqueryBuilder();n.modelBinderConfig.$type=$data.Array;n.selectModelBinderProperty("$item");n.modelBinderConfig.$type=$data.Integer;n.modelBinderConfig.$source="cnt";n.resetModelBinderProperty();this._query.modelBinderConfig=n.modelBinderConfig},VisitConstantExpression:function(n,t){t.modelBinderConfig.$type=n.type;t.modelBinderConfig.$value=n.value},VisitExpression:function(n,t){var i=Container.createFindProjectionVisitor();i.Visit(n);i.projectionExpression?this.Visit(i.projectionExpression,t):this.DefaultSelection(t,this._query.defaultType,this._includes)},_defaultModelBinder:function(n){var t=Container.createqueryBuilder();t.modelBinderConfig.$type=$data.Array;this._isoDataProvider&&(t.modelBinderConfig.$selector=["json:d.results","json:d","json:results"]);t.modelBinderConfig.$item={};t.selectModelBinderProperty("$item");this.VisitExpression(n,t);t.resetModelBinderProperty();this._query.modelBinderConfig=t.modelBinderConfig},_addPropertyToModelBinderConfig:function(n,t){var i=this._query.context._storageModel.getStorageModel(n);n.memberDefinitions?n.memberDefinitions.getPublicMappedProperties().forEach(function(n){var r,u;i&&(!i||i.Associations[n.name]||i.ComplexTypes[n.name])||(r=Container.resolveType(n.dataType),!i&&this._query.context.storageProvider.supportedDataTypes.indexOf(r)<0?(t.selectModelBinderProperty(n.name),t.modelBinderConfig.$type=r,t.modelBinderConfig.$selector=this._isoDataProvider?["json:"+n.name+".results","json:"+n.name]:"json:"+n.name,this._addPropertyToModelBinderConfig(r,t),t.popModelBinderProperty()):(n.key&&t.addKeyField(n.name),n.concurrencyMode===$data.ConcurrencyMode.Fixed?t.modelBinderConfig[n.name]={$selector:"json:__metadata",$source:"etag"}:r===$data.Array&&n.elementType?(t.selectModelBinderProperty(n.name),t.modelBinderConfig.$type=r,t.modelBinderConfig.$selector=this._isoDataProvider?["json:"+n.name+".results","json:"+n.name]:"json:"+n.name,t.selectModelBinderProperty("$item"),u=Container.resolveType(n.elementType),t.modelBinderConfig.$type=u,this._addPropertyToModelBinderConfig(u,t),t.popModelBinderProperty(),t.popModelBinderProperty()):t.modelBinderConfig[n.name]=n.name))},this):(t._binderConfig.$item=t._binderConfig.$item||{},t.modelBinderConfig=t._binderConfig.$item);i&&this._addComplexTypeProperties(i.ComplexTypes,t)},_addComplexTypeProperties:function(n,t){n.forEach(function(n){var f,i,u,r;if(n.ToType!==$data.Array)t.selectModelBinderProperty(n.FromPropertyName),t.modelBinderConfig.$type=n.ToType,t.modelBinderConfig.$selector=this._isoDataProvider?["json:"+n.FromPropertyName+".results","json:"+n.FromPropertyName]:"json:"+n.FromPropertyName,this._addPropertyToModelBinderConfig(n.ToType,t),t.popModelBinderProperty();else if(f=n.ToType,i=Container.resolveType(n.FromType.memberDefinitions.getMember(n.FromPropertyName).elementType),f===$data.Array&&i&&i.isAssignableTo&&i.isAssignableTo($data.Entity)){for(config={$type:$data.Array,$selector:"json:"+n.FromPropertyName,$item:{$type:i}},u=i.memberDefinitions.getPublicMappedProperties(),r=0;r<u.length;r++)config.$item[u[r].name]={$type:u[r].type,$source:u[r].name};t.modelBinderConfig[n.FromPropertyName]=config}else t.modelBinderConfig[n.FromPropertyName]={$type:n.ToType,$source:n.FromPropertyName}},this)},DefaultSelection:function(n,t,i){n.modelBinderConfig.$type=t;var r=this._query.context._storageModel.getStorageModel(t);this._addPropertyToModelBinderConfig(t,n);i&&i.forEach(function(t){for(var i=t.name.split("."),f=null,e=r,o=0,u=0;u<i.length;u++)n.modelBinderConfig.$item&&(n.selectModelBinderProperty("$item"),o++),n.selectModelBinderProperty(i[u]),f=e.Associations[i[u]],e=this._query.context._storageModel.getStorageModel(f.ToType);for(n.modelBinderConfig.$selector=this._isoDataProvider?["json:"+i[i.length-1]+".results","json:"+i[i.length-1]]:"json:"+i[i.length-1],f.ToMultiplicity==="*"?(n.modelBinderConfig.$type=$data.Array,n.selectModelBinderProperty("$item"),n.modelBinderConfig.$type=t.type,this._addPropertyToModelBinderConfig(t.type,n),n.popModelBinderProperty()):(n.modelBinderConfig.$type=t.type,this._addPropertyToModelBinderConfig(t.type,n)),u=0;u<i.length+o;u++)n.popModelBinderProperty()},this)},VisitProjectionExpression:function(n,t){this.hasProjection=!0;this.Visit(n.selector,t);n.selector&&n.selector.expression instanceof $data.Expressions.ObjectLiteralExpression&&(t.modelBinderConfig.$type=n.projectionAs||t.modelBinderConfig.$type||$data.Object)},VisitParametricQueryExpression:function(n,t){n.expression instanceof $data.Expressions.EntityExpression||n.expression instanceof $data.Expressions.EntitySetExpression?this.VisitEntityAsProjection(n,t):this.Visit(n.expression,t)},VisitEntityAsProjection:function(n,t){this.mapping="";this.Visit(n.expression,t);var i;this.mapping&&this._includes instanceof Array&&(i=this._includes.filter(function(n){return n.name.indexOf(this.mapping+".")===0},this),i=i.map(function(n){return{name:n.name.replace(this.mapping+".",""),type:n.type}},this),i.length>0&&this.DefaultSelection(t,n.expression.entityType,i));n.expression instanceof $data.Expressions.EntityExpression?this.DefaultSelection(t,n.expression.entityType):n.expression instanceof $data.Expressions.EntitySetExpression&&(t.modelBinderConfig.$type=$data.Array,t.modelBinderConfig.$item={},t.selectModelBinderProperty("$item"),this.DefaultSelection(t,n.expression.elementType),t.popModelBinderProperty())},VisitEntityFieldExpression:function(n,t){this.Visit(n.source,t);this.Visit(n.selector,t)},VisitMemberInfoExpression:function(n,t){t.modelBinderConfig.$type=n.memberDefinition.type;n.memberDefinition.storageModel&&n.memberName in n.memberDefinition.storageModel.ComplexTypes?this._addPropertyToModelBinderConfig(Container.resolveType(n.memberDefinition.type),t):t.modelBinderConfig.$type&&Container.resolveType(t.modelBinderConfig.$type).isAssignableTo&&Container.resolveType(t.modelBinderConfig.$type).isAssignableTo($data.Entity)||(t.modelBinderConfig.$source=n.memberName)},VisitEntitySetExpression:function(n,t){n.source instanceof $data.Expressions.EntityExpression&&(this.Visit(n.source,t),this.Visit(n.selector,t))},VisitComplexTypeExpression:function(n,t){if(this.Visit(n.source,t),this.Visit(n.selector,t),"$selector"in t.modelBinderConfig&&t.modelBinderConfig.$selector.length>0)if(t.modelBinderConfig.$selector instanceof $data.Array){var i=t.modelBinderConfig.$selector[1];t.modelBinderConfig.$selector[0]=i+"."+n.selector.memberName+".results";t.modelBinderConfig.$selector[1]=i+"."+n.selector.memberName}else t.modelBinderConfig.$selector+="."+n.selector.memberName;else t.modelBinderConfig.$selector=this._isoDataProvider?["json:"+n.selector.memberName+".results","json:"+n.selector.memberName]:"json:"+n.selector.memberName},VisitEntityExpression:function(n,t){this.Visit(n.source,t)},VisitAssociationInfoExpression:function(n,t){if("$selector"in t.modelBinderConfig&&t.modelBinderConfig.$selector.length>0)if(t.modelBinderConfig.$selector instanceof $data.Array){var i=t.modelBinderConfig.$selector[1];t.modelBinderConfig.$selector[0]=i+"."+n.associationInfo.FromPropertyName+".results";t.modelBinderConfig.$selector[1]=i+"."+n.associationInfo.FromPropertyName}else t.modelBinderConfig.$selector+="."+n.associationInfo.FromPropertyName;else t.modelBinderConfig.$selector=this._isoDataProvider?["json:"+n.associationInfo.FromPropertyName+".results","json:"+n.associationInfo.FromPropertyName]:"json:"+n.associationInfo.FromPropertyName;this.mapping&&this.mapping.length>0&&(this.mapping+=".");this.mapping+=n.associationInfo.FromPropertyName},VisitObjectLiteralExpression:function(n,t){t.modelBinderConfig.$type=$data.Object;n.members.forEach(function(n){this.Visit(n,t)},this)},VisitObjectFieldExpression:function(n,t){t.selectModelBinderProperty(n.fieldName);n.expression instanceof $data.Expressions.EntityExpression||n.expression instanceof $data.Expressions.EntitySetExpression?this.VisitEntityAsProjection(n,t):this.Visit(n.expression,t);t.popModelBinderProperty()}});$data.Class.define("$data.Authentication.AuthenticationBase",null,null,{constructor:function(n){this.configuration=n||{};this.Authenticated=!1},Login:function(){Guard.raise("Pure class")},Logout:function(){Guard.raise("Pure class")},CreateRequest:function(){Guard.raise("Pure class")}},null);$data.Class.define("$data.Authentication.Anonymous",$data.Authentication.AuthenticationBase,null,{constructor:function(n){this.configuration=n||{};this.Authenticated=!1},Login:function(){},Logout:function(){},CreateRequest:function(n){$data.ajax(n)}},null);$data.Class.define("$data.Authentication.FacebookAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(n){this.configuration=$data.typeSystem.extend({Url_code:"",type_code:"",scope:"",Url_token:"",type_token:"",access_token:"",app_id:""},n)},Login:function(n){if(!this.Authenticated){var t=this;t.configuration.stateCallbacks=n||{};$data.ajax({url:this.configuration.Url_code,data:"type="+t.configuration.type_code+"&client_id="+t.configuration.app_id+"&scope="+t.configuration.scope,type:"POST",dataType:"json",success:function(n){typeof t.configuration.stateCallbacks.pending=="function"&&t.configuration.stateCallbacks.pending(n);t._processRequestToken(n);t.Authenticated=!0},error:function(){typeof t.configuration.stateCallbacks.error=="function"&&t.configuration.stateCallbacks.error(arguments)}})}},Logout:function(){this.Authenticated=!1},CreateRequest:function(n){var i,t;n&&(i=this,n.url.indexOf("access_token=")===-1&&n.url&&this.Authenticated&&(t="?",n.url.indexOf(t)>0&&(t="&"),this.configuration.access_token&&(n.url=n.url+t+"access_token="+this.configuration.access_token)),$data.ajax(n))},_processRequestToken:function(n){var t=this;$data.ajax({url:t.configuration.Url_token,data:"type="+t.configuration.type_token+"&client_id="+t.configuration.app_id+"&code="+n.code,type:"POST",dataType:"json",success:function(n){t.configuration.access_token=n.access_token;typeof t.configuration.stateCallbacks.success=="function"&&t.configuration.stateCallbacks.success(n)},error:function(obj){var data=eval("("+obj.responseText+")");data.error&&(data.error.message=="authorization_pending"?setTimeout(function(){t._processRequestToken(n)},2e3):"authorization_declined"&&typeof t.configuration.stateCallbacks.abort=="function"&&t.configuration.stateCallbacks.abort(arguments))}})}},null);$data.Class.define("$data.Authentication.BasicAuth.BasicAuth",$data.Authentication.AuthenticationBase,null,{constructor:function(n){this.configuration=$data.typeSystem.extend({Username:"",Password:""},n)},Login:function(n){n&&typeof n.pending=="function"&&n.pending()},Logout:function(){},CreateRequest:function(n){if(n){var t=this,i=n.beforeSend;n.beforeSend=function(n){n.setRequestHeader("Authorization","Basic  "+t.__encodeBase64(t.configuration.Username+":"+t.configuration.Password));typeof i=="function"&&i(n)};$data.ajax(n)}},__encodeBase64:function(n){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=";input=n;var s="",f,t,i="",h,c,e,r="",o=0;do f=input.charCodeAt(o++),t=input.charCodeAt(o++),i=input.charCodeAt(o++),h=f>>2,c=(f&3)<<4|t>>4,e=(t&15)<<2|i>>6,r=i&63,isNaN(t)?e=r=64:isNaN(i)&&(r=64),s=s+u.charAt(h)+u.charAt(c)+u.charAt(e)+u.charAt(r),f=t=i="",h=c=e=r="";while(o<input.length);return s}},null);$data.Class.define("$data.MetadataLoaderClass",null,null,{load:function(n,t,i){var r={EntityBaseClass:"$data.Entity",ContextBaseClass:"$data.EntityContext",AutoCreateContext:!1,DefaultNamespace:("ns"+Math.random()).replace(".","")+n.replace(/[^\w]/g,"_"),ContextInstanceName:"context",EntitySetBaseClass:"$data.EntitySet",CollectionBaseClass:"Array",url:n,user:undefined,password:undefined,withCredentials:undefined,httpHeaders:undefined,typeFilter:"",navigation:!0,generateKeys:!0,dependentRelationsOnly:!1},n,u;if($data.typeSystem.extend(r,i||{}),r.DefaultNamespace&&r.DefaultNamespace.lastIndexOf(".")!==r.DefaultNamespace.length-1&&(r.DefaultNamespace+="."),this.factoryCache=this.factoryCache||{},t=$data.typeSystem.createCallbackSetting(t),n in this.factoryCache){t.success.apply({},this.factoryCache[n]);return}r.url?(r.SerivceUri=r.url.replace("/$metadata",""),r.metadataUri=r.url.indexOf("/$metadata")===-1?r.url.replace(/\/+$/,"")+"/$metadata":r.url):t.error("metadata url is missing");u=this;u._loadXMLDoc(r,function(n,i){if(i.statusCode<200||i.statusCode>299){t.error(i);return}var f=u._findVersion(n);u.xsltRepoUrl?(console.log("XSLT: "+u.xsltRepoUrl+u._supportedODataVersionXSLT),u._loadXMLDoc({metadataUri:u.xsltRepoUrl+u._supportedODataVersionXSLT,user:r.user,password:r.password,httpHeaders:r.httpHeaders},function(i,e){var o,s;if(e.statusCode<200||e.statusCode>299){t.error(e);return}o=e.responseText;o=o.replace('xmlns:edm="@@VERSIONNS@@"','xmlns:edm="'+f.ns+'"');o=o.replace("@@VERSION@@",f.version);window.ActiveXObject===undefined?(s=new DOMParser,i=s.parseFromString(o,"text/xml")):(i=new ActiveXObject("Microsoft.XMLDOM"),i.async=!1,i.loadXML(o));u._transform(t,f,n,i,r)})):u._transform(t,f,n,undefined,r)})},debugMode:{type:"bool",value:!1},xsltRepoUrl:{type:"string",value:""},createFactoryFunc:function(n,t,i){var r=this;return function(r){if(n){var u=$data.typeSystem.extend({name:"oData",oDataServiceHost:t.SerivceUri,user:t.user,password:t.password,withCredentials:t.withCredentials,maxDataServiceVersion:i.maxVersion||"3.0"},r);return new n(u)}return null}},_transform:function(callBack,versionInfo,xml,xsl,cnf){var self=this,codeText=self._processResults(cnf.url,versionInfo,xml,xsl,cnf),ctxType,factoryFn;try{eval(codeText)}catch(e){callBack.error(new Exception("SyntaxError","Unexpected model",[e,codeText]));return}if(!$data.generatedContexts||!(ctxType=$data.generatedContexts.pop())){callBack.error(new Exception("No context found in service","Not found",[cnf,codeText]));return}factoryFn=self.createFactoryFunc(ctxType,cnf,versionInfo);this.factoryCache[cnf.url]=[factoryFn,ctxType];factoryFn.type=ctxType;self.debugMode?(factoryFn.codeText=codeText,callBack.success(factoryFn,ctxType,codeText)):callBack.success(factoryFn,ctxType)},_loadXMLDoc:function(n,t){var i=this;$data.postMessageODataHandler?(n.user&&n.password&&(!n.httpHeaders||n.httpHeaders&&!n.httpHeaders.Authorization)&&(httpHeader=httpHeader||{},httpHeader.Authorization="Basic "+this.__encodeBase64(n.user+":"+n.password)),$data.postMessageODataHandler.requestProxy({url:n.metadataUri,httpHeaders:n.httpHeaders,success:function(n){var i,r;typeof module!="undefined"&&typeof require!="undefined"?i=n.responseText:window.ActiveXObject?(i=new ActiveXObject("Microsoft.XMLDOM"),i.async="false",i.loadXML(n.responseText)):(r=new DOMParser,i=r.parseFromString(n.responseText,"text/xml"));t(i,n)},error:function(){i._loadXHTTP_XMLDoc(n,t)}})):this._loadXHTTP_XMLDoc(n,t)},_loadXHTTP_XMLDoc:function(n,t){var i=new XMLHttpRequest;i.open("GET",n.metadataUri,!0);n.httpHeaders&&Object.keys(n.httpHeaders).forEach(function(t){i.setRequestHeader(t,n.httpHeaders[t])});i.onreadystatechange=function(){if(i.readyState===4){var r={requestUri:n.metadataUri,statusCode:i.status,statusText:i.statusText,responseText:i.responseText};t(i.responseXML||i.responseText,r)}};n.user&&n.password&&(!n.httpHeaders||n.httpHeaders&&!n.httpHeaders.Authorization)&&i.setRequestHeader("Authorization","Basic "+this.__encodeBase64(n.user+":"+n.password));i.send("")},_processResults:function(n,t,i,r,u){var c=this.getCurrentXSLTVersion(t,i),s,f,h,a,l,v,e,o;if(u.typeFilter=this._prepareTypeFilter(i,t,u),window.ActiveXObject!==undefined){if(o=new ActiveXObject("Msxml2.XSLTemplate.6.0"),s=new ActiveXObject("Msxml2.FreeThreadedDOMDocument.6.0"),s.async=!1,r?s.load(r):s.loadXML(c),s.parseError.errorCode!=0)a=s.parseError;else if(o.stylesheet=s,h=new ActiveXObject("Msxml2.DOMDocument.6.0"),h.async=!1,h.load(i),h.parseError.errorCode!=0)a=h.parseError;else return f=o.createProcessor(),f.input=h,f.addParameter("SerivceUri",u.SerivceUri),f.addParameter("EntityBaseClass",u.EntityBaseClass),f.addParameter("ContextBaseClass",u.ContextBaseClass),f.addParameter("AutoCreateContext",u.AutoCreateContext),f.addParameter("ContextInstanceName",u.ContextInstanceName),f.addParameter("EntitySetBaseClass",u.EntitySetBaseClass),f.addParameter("CollectionBaseClass",u.CollectionBaseClass),f.addParameter("DefaultNamespace",u.DefaultNamespace),f.addParameter("MaxDataserviceVersion",t.maxVersion||"3.0"),f.addParameter("AllowedTypesList",u.typeFilter),f.addParameter("GenerateNavigationProperties",u.navigation),f.transform(),f.output;return""}return typeof document!="undefined"&&document.implementation&&document.implementation.createDocument?(r?l=r:(v=new DOMParser,l=v.parseFromString(c,"text/xml")),e=new XSLTProcessor,e.importStylesheet(l),e.setParameter(null,"SerivceUri",u.SerivceUri),e.setParameter(null,"EntityBaseClass",u.EntityBaseClass),e.setParameter(null,"ContextBaseClass",u.ContextBaseClass),e.setParameter(null,"AutoCreateContext",u.AutoCreateContext),e.setParameter(null,"ContextInstanceName",u.ContextInstanceName),e.setParameter(null,"EntitySetBaseClass",u.EntitySetBaseClass),e.setParameter(null,"CollectionBaseClass",u.CollectionBaseClass),e.setParameter(null,"DefaultNamespace",u.DefaultNamespace),e.setParameter(null,"MaxDataserviceVersion",t.maxVersion||"3.0"),e.setParameter(null,"AllowedTypesList",u.typeFilter),e.setParameter(null,"GenerateNavigationProperties",u.navigation),resultDocument=e.transformToFragment(i,document),resultDocument.textContent):typeof module!="undefined"&&typeof require!="undefined"?(o=require("node_xslt"),o.transform(o.readXsltString(c),o.readXmlString(i),["SerivceUri","'"+u.SerivceUri+"'","EntityBaseClass","'"+u.EntityBaseClass+"'","ContextBaseClass","'"+u.ContextBaseClass+"'","AutoCreateContext","'"+u.AutoCreateContext+"'","ContextInstanceName","'"+u.ContextInstanceName+"'","EntitySetBaseClass","'"+u.EntitySetBaseClass+"'","CollectionBaseClass","'"+u.CollectionBaseClass+"'","DefaultNamespace","'"+u.DefaultNamespace+"'","MaxDataserviceVersion","'"+(t.maxVersion||"3.0")+"'","AllowedTypesList","'"+u.typeFilter+"'","GenerateNavigationProperties","'"+u.navigation+"'"])):void 0},_prepareTypeFilter:function(n,t,i){var a="",h,e,f,u,v,y,p,c,w,l,o,b,k,r,s;if(!(typeof n=="object"&&"querySelector"in n&&"querySelectorAll"in n))return a;if(h=[],typeof i.typeFilter=="object"&&i.typeFilter){for(e=Object.keys(i.typeFilter),r=0;r<e.length;r++){if(f=i.typeFilter[e[r]],u={},typeof f=="object"&&f)Array.isArray(f)?(u.Name=e[r],u.Fields=f):(u.Name=f.name||e[r],u.Fields=f.members||[]);else if(f)u.Name=e[r],u.Fields=[];else continue;for(v=u.Name,y="",u.Name.lastIndexOf(".")>0&&(y=u.Name.substring(0,u.Name.lastIndexOf(".")),v=u.Name.substring(u.Name.lastIndexOf(".")+1)),p=n.querySelectorAll("EntityContainer[Name = '"+y+"']"),c=0;c<p.length;c++)if(w=p[c].querySelector("EntitySet[Name = '"+v+"']"),w!=null){u.Name=w.attributes.EntityType.value;break}h.push(u)}for(l=i.dependentRelationsOnly?this._discoverProperyDependencies(h,n,i.navigation,i.generateKeys):this._discoverTypeDependencies(h,n,i.navigation,i.generateKeys),o=n.querySelectorAll("ComplexType"),r=0;r<o.length;r++)b=o[r].parentNode.attributes.Namespace.value,k=b?b+"."+o[r].attributes.Name.value:o[r].attributes.Name.value,l.push({Name:k,Fields:[]});for(r=0;r<l.length;r++)s=l[r],a+=s.Fields.length>0?s.Name+":"+s.Fields.join(",")+";":s.Name+";"}return a},_discoverTypeDependencies:function(n,t,i,r){for(var o,e=[],s=[],f=[],u=0;u<n.length;u++)o=f.indexOf(n[u].Name),o>=0&&f.splice(o,1),this._discoverType(n[u],t,e,s,i,r,!0,f);for(u=0;u<f.length;u++)this._discoverType({Name:f[u],Fields:[]},t,e,s,i,r,!1,[]);return e},_discoverType:function(n,t,i,r,u,f,e,o){var s=n.Name,a,b,c,v,y,k,d,h,p,l;if(!(r.indexOf(s)>=0)&&(console.log("Discover: "+s),a=s,b="",s.lastIndexOf(".")>0&&(b=s.substring(0,s.lastIndexOf(".")),a=s.substring(s.lastIndexOf(".")+1)),c=t.querySelector("Schema[Namespace = '"+b+"']"),c!=null&&(v=c.querySelector("EntityType[Name = '"+a+"'], ComplexType[Name = '"+a+"']"),v!=null))){if(i.push(n),r.push(s),f&&n.Fields.length>0&&(y=v.querySelectorAll("Key PropertyRef"),y!=null))for(h=0;h<y.length;h++)k=y[h].attributes.Name.value,n.Fields.indexOf(k)<0&&n.Fields.splice(h,0,k);if(u)for(d=v.querySelectorAll("NavigationProperty"),h=0;h<d.length;h++)if(p=d[h],n.Fields.length==0||n.Fields.indexOf(p.attributes.Name.value)>=0){var g=p.attributes.FromRole.value,nt=p.attributes.ToRole.value,w=c.querySelector("Association End[Role = '"+g+"']:not([Type = '"+s+"'])");w==null&&(w=c.querySelector("Association End[Role = '"+nt+"']:not([Type = '"+s+"'])"));w!=null&&(l=w.attributes.Type.value,e?o.indexOf(l)<0&&r.indexOf(l)<0&&o.push(l):this._discoverType({Name:l,Fields:[]},t,i,r,u,f,!1,o))}}},_discoverProperyDependencies:function(n,t,i,r){for(var f=[],e=n.map(function(n){return n.Name}),u=0;u<n.length;u++)this._discoverProperties(n[u],t,f,e,i,r);return f},_discoverProperties:function(n,t,i,r,u,f){var o=n.Name,c,s,l,g,y,h,b,a,e,k;console.log("Discover: "+o);var tt=n.Fields.length!=0,v=o,d="";if(o.lastIndexOf(".")>0&&(d=o.substring(0,o.lastIndexOf(".")),v=o.substring(o.lastIndexOf(".")+1)),c=t.querySelector("Schema[Namespace = '"+d+"']"),c!=null&&(s=c.querySelector("EntityType[Name = '"+v+"'], ComplexType[Name = '"+v+"']"),s!=null))if(i.push(n),tt){if(f&&(a=s.querySelectorAll("Key PropertyRef"),a!=null))for(e=0;e<a.length;e++)k=a[e].attributes.Name.value,n.Fields.indexOf(k)<0&&n.Fields.splice(e,0,k)}else{if(l=s.querySelectorAll("Property"),l!=null)for(e=0;e<l.length;e++)g=l[e].attributes.Name.value,n.Fields.push(g);if(u)for(y=s.querySelectorAll("NavigationProperty"),e=0;e<y.length;e++){var p=y[e],it=p.attributes.Name.value,nt=[p.attributes.FromRole.value,p.attributes.ToRole.value],w="";for(h=0;h<nt.length;h++)if(b=c.querySelector("Association End[Role = '"+nt[h]+"']"),b!=null&&(w=b.attributes.Type.value,w!=o||h==1))break;r.indexOf(w)>=0&&n.Fields.push(it)}}},_findVersion:function(n){var r="",i,t,f,u;if(typeof n=="object"&&"getElementsByTagName"in n)return i="http://schemas.microsoft.com/ado/2008/09/edm",t=n.getElementsByTagName("Schema"),t&&(t=t[0]),t&&(t=t.attributes),t&&(t=t.getNamedItem("xmlns")),t&&(i=t.value),r=n.getElementsByTagName("edmx:DataServices")[0]||n.getElementsByTagName("DataServices")[0],r&&(r=r.attributes.getNamedItem("m:MaxDataServiceVersion")),r&&i&&(r=r.value),f=this._supportedODataVersions[i],{ns:i,version:f||"unknown",maxVersion:r||this._maxDataServiceVersions[i||"unknown"]};if(typeof module!="undefined"&&typeof require!="undefined"){var o=n,e="http://schemas.microsoft.com/ado/2008/09/edm",i="nodejs";for(u in this._supportedODataVersions)if(o.search(new RegExp('<Schema.+xmlns="'+u+'"',"gi"))>=0){e=u;i=this._supportedODataVersions[u];break}return{ns:e,version:i,maxVersion:this._maxDataServiceVersions[i||"unknown"]}}},_supportedODataVersions:{value:{"http://schemas.microsoft.com/ado/2006/04/edm":"V1","http://schemas.microsoft.com/ado/2008/09/edm":"V2","http://schemas.microsoft.com/ado/2009/11/edm":"V3","http://schemas.microsoft.com/ado/2007/05/edm":"V11","http://schemas.microsoft.com/ado/2009/08/edm":"V22"}},_maxDataServiceVersions:{value:{"http://schemas.microsoft.com/ado/2006/04/edm":"2.0","http://schemas.microsoft.com/ado/2008/09/edm":"2.0","http://schemas.microsoft.com/ado/2009/11/edm":"3.0","http://schemas.microsoft.com/ado/2007/05/edm":"2.0","http://schemas.microsoft.com/ado/2009/08/edm":"2.0"}},_supportedODataVersionXSLT:{value:"JayDataContextGenerator.xslt"},getCurrentXSLTVersion:function(n){return this._metadataConverterXSLT.replace("@@VERSIONNS@@",n.ns).replace("@@VERSION@@",n.version)},__encodeBase64:function(n){var u="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789+/=",f=n,h="",e,t,i="",c,l,o,r="",s=0;do e=f.charCodeAt(s++),t=f.charCodeAt(s++),i=f.charCodeAt(s++),c=e>>2,l=(e&3)<<4|t>>4,o=(t&15)<<2|i>>6,r=i&63,isNaN(t)?o=r=64:isNaN(i)&&(r=64),h=h+u.charAt(c)+u.charAt(l)+u.charAt(o)+u.charAt(r),e=t=i="",c=l=o=r="";while(s<f.length);return h},_metadataConverterXSLT:{type:"string",value:'<xsl:stylesheet version="1.0" xmlns:xsl="http://www.w3.org/1999/XSL/Transform" \r\n                xmlns:edm="@@VERSIONNS@@" \r\n                xmlns:m="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" \r\n                xmlns:metadata="http://schemas.microsoft.com/ado/2007/08/dataservices/metadata" \r\n                xmlns:annot="http://schemas.microsoft.com/ado/2009/02/edm/annotation" \r\n                xmlns:exsl="http://exslt.org/common" \r\n                xmlns:msxsl="urn:schemas-microsoft-com:xslt" exclude-result-prefixes="msxsl">\r\n\r\n  <xsl:key name="entityType" match="edm:EntityType" use="concat(string(../@Namespace),\'.\', string(@Name))"/>\r\n  <xsl:key name="associations" match="edm:Association" use="concat(string(../@Namespace),\'.\', string(@Name))"/>\r\n\r\n  <xsl:strip-space elements="property item unprocessed"/>\r\n  <xsl:output method="text" indent="no"  />\r\n  <xsl:param name="contextNamespace" />\r\n\r\n  <xsl:param name="SerivceUri" />\r\n  <xsl:param name="EntityBaseClass"/>\r\n  <xsl:param name="ContextBaseClass"/>\r\n  <xsl:param name="AutoCreateContext"/>\r\n  <xsl:param name="ContextInstanceName"/>\r\n  <xsl:param name="EntitySetBaseClass"/>\r\n  <xsl:param name="CollectionBaseClass"/>\r\n  <xsl:param name="DefaultNamespace"/>\r\n  <xsl:param name="MaxDataserviceVersion"/>\r\n  <xsl:param name="AllowedTypesList" />\r\n  <xsl:param name="GenerateNavigationProperties" />\r\n\r\n  <xsl:param name="AllowedTypesListX">Microsoft.Crm.Sdk.Data.Services.Product;Microsoft.Crm.Sdk.Data.Services.LeadAddress:Telephone1,City,UTCOffset;<\/xsl:param>\r\n\r\n  <xsl:variable name="fullmetadata" select="/" />\r\n  \r\n  <xsl:template name="createFieldsList">\r\n    <xsl:param name="fields" />\r\n    <!--<xsl:message terminate="no">\r\n      create field: @<xsl:value-of select="$fields"/>@\r\n    <\/xsl:message>-->\r\n      <xsl:variable name="thisField">\r\n        <xsl:choose>\r\n          <xsl:when test="contains($fields,\',\')">\r\n            <xsl:value-of select="substring-before($fields, \',\')"/>\r\n          <\/xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$fields"/>\r\n          <\/xsl:otherwise>\r\n        <\/xsl:choose>\r\n      <\/xsl:variable>\r\n      <xsl:element name="field">\r\n        <xsl:attribute name="name">\r\n          <xsl:value-of select="$thisField"/>\r\n        <\/xsl:attribute> \r\n      <\/xsl:element>\r\n      <xsl:variable name="remaining" select="substring($fields, string-length($thisField) + 2)" />\r\n      <xsl:if test="string-length($remaining) > 0">\r\n        <xsl:call-template name="createFieldsList">\r\n          <xsl:with-param name="fields" select="$remaining" />\r\n        <\/xsl:call-template>\r\n      <\/xsl:if>\r\n  <\/xsl:template>\r\n\r\n  <xsl:template name="createType">\r\n    <xsl:param name="typeFull" />\r\n    <!--<xsl:message terminate="no">\r\n      create type: <xsl:value-of select="$typeFull"/>\r\n    <\/xsl:message>-->\r\n    <xsl:variable name="typeName">\r\n      <xsl:choose>\r\n        <xsl:when test="contains($typeFull,\':\')">\r\n          <xsl:value-of select="substring-before($typeFull, \':\') "/>\r\n        <\/xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="$typeFull"/>\r\n        <\/xsl:otherwise>\r\n      <\/xsl:choose>\r\n    <\/xsl:variable>\r\n    <xsl:variable name="fields" select="substring($typeFull, string-length($typeName) + 2)" />\r\n    <xsl:element name="type">\r\n      <xsl:attribute name="name">\r\n        <xsl:value-of select="$typeName"/>\r\n      <\/xsl:attribute>\r\n      <xsl:if test="string-length($fields) > 0">\r\n        <xsl:call-template name="createFieldsList">\r\n          <xsl:with-param name="fields" select="$fields" />\r\n        <\/xsl:call-template>\r\n      <\/xsl:if>\r\n    <\/xsl:element>\r\n  <\/xsl:template>\r\n  \r\n  <xsl:template name="createTypeList">\r\n    <xsl:param name="types" />\r\n    <!--<xsl:message terminate="no">\r\n      createTypeList: <xsl:value-of select="$types"/>\r\n    <\/xsl:message>-->\r\n        \r\n    <xsl:variable name="thisTypeFull">\r\n      <xsl:choose>\r\n        <xsl:when test="contains($types, \';\')">\r\n          <xsl:value-of select="substring-before($types, \';\')"/>\r\n        <\/xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="$types"/>\r\n        <\/xsl:otherwise>\r\n      <\/xsl:choose>\r\n    <\/xsl:variable>\r\n\r\n    <xsl:if test="string-length($thisTypeFull) > 0">\r\n      <xsl:call-template name="createType">\r\n        <xsl:with-param name="typeFull" select="$thisTypeFull" />\r\n      <\/xsl:call-template>\r\n    <\/xsl:if>\r\n    \r\n    <xsl:variable name="remaining" select="substring($types, string-length($thisTypeFull) + 2)" />\r\n    <!--<xsl:message terminate="no">\r\n      rem: @<xsl:value-of select="$remaining"/>@  \r\n    <\/xsl:message>-->\r\n    \r\n    <xsl:if test="string-length($remaining) > 0">\r\n      <xsl:call-template name="createTypeList">\r\n        <xsl:with-param name="types" select="$remaining" />\r\n      <\/xsl:call-template>\r\n    <\/xsl:if>\r\n  <\/xsl:template>\r\n\r\n  <xsl:variable name="allowedTypes">\r\n    <xsl:call-template name="createTypeList">\r\n      <xsl:with-param name="types" select="$AllowedTypesList" />\r\n    <\/xsl:call-template>\r\n  <\/xsl:variable>\r\n  \r\n\r\n<!-- TODO EXSLT node-set -->\r\n  <!--<xsl:variable name="hasTypeFilter" select="boolean(count(msxsl:node-set($allowedTypes)/type) > 0)"/>-->\r\n  <xsl:variable name="hasTypeFilter">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')"><xsl:value-of select="boolean(count(msxsl:node-set($allowedTypes)/type) > 0)"/><\/xsl:when>\r\n      <xsl:otherwise><xsl:value-of select="boolean(count(exsl:node-set($allowedTypes)/type) > 0)"/><\/xsl:otherwise>\r\n    <\/xsl:choose>\r\n  <\/xsl:variable>\r\n  <xsl:template match="/">\r\n\r\n/*//////////////////////////////////////////////////////////////////////////////////////\r\n////// Autogenerated by JaySvcUtil.exe http://JayData.org for more info        /////////\r\n//////                             oData @@VERSION@@                                    /////////\r\n//////////////////////////////////////////////////////////////////////////////////////*/\r\n(function(global, $data, undefined) {\r\n\r\n    \r\n<xsl:for-each select="//edm:EntityType | //edm:ComplexType" xml:space="default">\r\n  <xsl:variable name="thisName" select="concat(../@Namespace, \'.\', @Name)" />\r\n  <!-- TODO EXSLT node-set-->\r\n  <!--<xsl:variable name="thisTypeNode" select="msxsl:node-set($allowedTypes)/type[@name = $thisName]" />-->\r\n  <xsl:variable name="thisTypeNode">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')">\r\n        <xsl:copy-of select="msxsl:node-set($allowedTypes)/type[@name = $thisName]"/>\r\n      <\/xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:copy-of select="exsl:node-set($allowedTypes)/type[@name = $thisName]"/>\r\n      <\/xsl:otherwise>\r\n    <\/xsl:choose>\r\n  <\/xsl:variable>\r\n  <xsl:variable name="thisTypeNodeExists">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')">\r\n        <xsl:copy-of select="(count(msxsl:node-set($allowedTypes)/type[@name = $thisName]) > 0)"/>\r\n      <\/xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:copy-of select="(count(exsl:node-set($allowedTypes)/type[@name = $thisName]) > 0)"/>\r\n      <\/xsl:otherwise>\r\n    <\/xsl:choose>\r\n  <\/xsl:variable>\r\n  <!--<xsl:variable name="filterFields" select="(count($thisTypeNode/field) > 0)" />-->\r\n  <xsl:variable name="filterFields">\r\n    <xsl:choose>\r\n      <xsl:when test="function-available(\'msxsl:node-set\')">\r\n        <xsl:copy-of select="(count(msxsl:node-set($thisTypeNode)/type/field) > 0)"/>\r\n      <\/xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:copy-of select="(count(exsl:node-set($thisTypeNode)/type/field) > 0)"/>\r\n      <\/xsl:otherwise>\r\n    <\/xsl:choose>\r\n  <\/xsl:variable>\r\n  <xsl:if test="($hasTypeFilter = \'false\') or ($thisTypeNodeExists = \'true\')">\r\n\r\n      <xsl:message terminate="no">Info: generating type <xsl:value-of select="concat(../@Namespace, \'.\', @Name)"/><\/xsl:message>\r\n    \r\n      <xsl:variable name="BaseType">\r\n        <xsl:choose>\r\n          <xsl:when test="@BaseType">\r\n            <xsl:value-of select="concat($DefaultNamespace,@BaseType)"/>\r\n          <\/xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$EntityBaseClass"  />\r\n          <\/xsl:otherwise>\r\n        <\/xsl:choose>\r\n      <\/xsl:variable>\r\n\r\n\r\n     <xsl:variable name="props">\r\n       <xsl:for-each select="*[local-name() != \'NavigationProperty\' or ($GenerateNavigationProperties = \'true\' and local-name() = \'NavigationProperty\')]">\r\n         <xsl:variable name="fname" select="@Name" />\r\n         <xsl:variable name="isAllowedField">\r\n           <xsl:choose>\r\n             <xsl:when test="function-available(\'msxsl:node-set\')">\r\n               <xsl:copy-of select="(count(msxsl:node-set($thisTypeNode)/type/field[@name = $fname]) > 0)"/>\r\n             <\/xsl:when>\r\n             <xsl:otherwise>\r\n               <xsl:copy-of select="(count(exsl:node-set($thisTypeNode)/type/field[@name = $fname]) > 0)"/>\r\n             <\/xsl:otherwise>\r\n           <\/xsl:choose>\r\n         <\/xsl:variable>\r\n         <xsl:if test="($filterFields = \'false\') or ($isAllowedField = \'true\')">\r\n           <xsl:apply-templates select="." />\r\n         <\/xsl:if> \r\n       <\/xsl:for-each>\r\n      <\/xsl:variable>\r\n    \r\n      <xsl:text xml:space="preserve">  <\/xsl:text><xsl:value-of select="$BaseType"  />.extend(\'<xsl:value-of select="concat($DefaultNamespace,../@Namespace)"/>.<xsl:value-of select="@Name"/>\', {\r\n     <xsl:choose>\r\n        <xsl:when test="function-available(\'msxsl:node-set\')">\r\n          <xsl:for-each select="msxsl:node-set($props)/*">\r\n            <xsl:value-of select="."/>\r\n            <xsl:if test="position() != last()">\r\n            <xsl:text>,&#10;     <\/xsl:text>  \r\n            <\/xsl:if>\r\n          <\/xsl:for-each>\r\n        <\/xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:for-each select="exsl:node-set($props)/*">\r\n            <xsl:value-of select="."/>\r\n            <xsl:if test="position() != last()">,&#10;     <\/xsl:if>\r\n          <\/xsl:for-each>\r\n        <\/xsl:otherwise>\r\n      <\/xsl:choose>\r\n      <xsl:variable name="currentName"><xsl:value-of select="concat(../@Namespace,\'.\',@Name)"/><\/xsl:variable>\r\n      <xsl:for-each select="//edm:FunctionImport[@IsBindable and edm:Parameter[1]/@Type = $currentName]"><xsl:if test="position() = 1">,\r\n      <\/xsl:if>\r\n        <xsl:apply-templates select="."><\/xsl:apply-templates><xsl:if test="position() != last()">,\r\n      <\/xsl:if>\r\n      <\/xsl:for-each>\r\n  });\r\n\r\n<\/xsl:if>\r\n<\/xsl:for-each>\r\n\r\n<xsl:for-each select="//edm:EntityContainer">\r\n  <xsl:text xml:space="preserve">  <\/xsl:text><xsl:value-of select="$ContextBaseClass"  />.extend(\'<xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)"/>\', {\r\n     <!--or (@IsBindable = \'true\' and (@IsAlwaysBindable = \'false\' or @m:IsAlwaysBindable = \'false\' or @metadata:IsAlwaysBindable = \'false\'))-->\r\n\r\n   <xsl:variable name="subset">\r\n    <xsl:for-each select="edm:EntitySet | edm:FunctionImport">\r\n      <xsl:choose>\r\n        <xsl:when test="function-available(\'msxsl:node-set\')">\r\n          <xsl:if test="($hasTypeFilter = \'false\') or msxsl:node-set($allowedTypes)/type[@name = current()/@EntityType]">\r\n            <xsl:copy-of select="."/>\r\n          <\/xsl:if>\r\n        <\/xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:if test="($hasTypeFilter = \'false\') or exsl:node-set($allowedTypes)/type[@name = current()/@EntityType]">\r\n            <xsl:copy-of select="."/>\r\n          <\/xsl:if>\r\n        <\/xsl:otherwise>\r\n      <\/xsl:choose>\r\n    <\/xsl:for-each>\r\n  <\/xsl:variable>\r\n\r\n  \r\n  <xsl:choose>\r\n    <xsl:when test="function-available(\'msxsl:node-set\')">\r\n      <xsl:for-each select="msxsl:node-set($subset)/*[local-name() != \'FunctionImport\' or not(@IsBindable) or @IsBindable = \'false\']">\r\n        <xsl:apply-templates select="."><\/xsl:apply-templates>\r\n        <xsl:if test="position() != last()">,\r\n     <\/xsl:if>\r\n      <\/xsl:for-each>\r\n    <\/xsl:when>\r\n    <xsl:otherwise>\r\n      <xsl:for-each select="exsl:node-set($subset)/*[local-name() != \'FunctionImport\' or not(@IsBindable) or @IsBindable = \'false\']">\r\n        <xsl:apply-templates select="."><\/xsl:apply-templates>\r\n        <xsl:if test="position() != last()">,\r\n     <\/xsl:if>\r\n      <\/xsl:for-each>\r\n    <\/xsl:otherwise>\r\n  <\/xsl:choose>\r\n  });\r\n\r\n  $data.generatedContexts = $data.generatedContexts || [];\r\n  $data.generatedContexts.push(<xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)" />);\r\n  <xsl:if test="$AutoCreateContext = \'true\'">\r\n  /*Context Instance*/\r\n  <xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$ContextInstanceName" /> = new <xsl:value-of select="concat(concat($DefaultNamespace,../@Namespace), \'.\', @Name)" />({ name:\'oData\', oDataServiceHost: \'<xsl:value-of select="$SerivceUri" />\', maxDataServiceVersion: \'<xsl:value-of select="$MaxDataserviceVersion" />\' });\r\n<\/xsl:if>\r\n\r\n<\/xsl:for-each>\r\n      \r\n})(window, $data);\r\n      \r\n    <\/xsl:template>\r\n\r\n  <xsl:template match="edm:Key"><\/xsl:template>\r\n\r\n  <xsl:template match="edm:FunctionImport">\r\n    <xsl:text>\'<\/xsl:text>\r\n    <xsl:value-of select="@Name"/>\r\n    <xsl:text>\': { type: <\/xsl:text>\r\n    <xsl:choose>\r\n      <xsl:when test="@IsBindable = \'true\'">\r\n        <xsl:text>$data.ServiceAction<\/xsl:text>\r\n      <\/xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:text>$data.ServiceOperation<\/xsl:text>\r\n      <\/xsl:otherwise>\r\n    <\/xsl:choose>\r\n\r\n    <xsl:apply-templates select="@*" mode="FunctionImport-mode"/>\r\n\r\n    <xsl:variable name="IsBindable">\r\n      <xsl:value-of select="@IsBindable"/>\r\n    <\/xsl:variable>\r\n    <xsl:text>, params: [<\/xsl:text>\r\n    <xsl:for-each select="edm:Parameter[($IsBindable = \'true\' and position() > 1) or (($IsBindable = \'false\' or $IsBindable = \'\') and position() > 0)]">\r\n      <xsl:text>{ name: \'<\/xsl:text>\r\n      <xsl:value-of select="@Name"/>\r\n      <xsl:text>\', type: \'<\/xsl:text>\r\n      <xsl:variable name="curr" select="@Type"/>\r\n      <xsl:choose>\r\n        <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n          <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n        <\/xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="$curr" />\r\n        <\/xsl:otherwise>\r\n      <\/xsl:choose>\r\n      <xsl:text>\' }<\/xsl:text>\r\n      <xsl:if test="position() != last()">, <\/xsl:if>\r\n    <\/xsl:for-each>    \r\n    <xsl:text>]<\/xsl:text>\r\n\r\n    <xsl:text> }<\/xsl:text>\r\n  <\/xsl:template>\r\n  \r\n  <xsl:template match="@ReturnType" mode="FunctionImport-mode">\r\n    <xsl:text>, returnType: <\/xsl:text>\r\n    <xsl:choose>\r\n      <xsl:when test="not(.)">null<\/xsl:when>\r\n      <xsl:when test="starts-with(., \'Collection\')">$data.Queryable<\/xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:text>\'<\/xsl:text>\r\n        <xsl:variable name="curr" select="."/>\r\n        <xsl:choose>\r\n          <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n            <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n          <\/xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$curr" />\r\n          <\/xsl:otherwise>\r\n        <\/xsl:choose>\r\n        <xsl:text>\'<\/xsl:text>\r\n      <\/xsl:otherwise>\r\n    <\/xsl:choose>\r\n\r\n    <xsl:if test="starts-with(., \'Collection\')">\r\n      <xsl:variable name="len" select="string-length(.)-12"/>\r\n      <xsl:variable name="curr" select="substring(.,12,$len)"/>\r\n      <xsl:variable name="ElementType" >\r\n        <xsl:choose>\r\n          <xsl:when test="$fullmetadata//edm:Schema[starts-with($curr, @Namespace)]">\r\n            <xsl:value-of select="concat($DefaultNamespace,$curr)" />\r\n          <\/xsl:when>\r\n          <xsl:otherwise>\r\n            <xsl:value-of select="$curr" />\r\n          <\/xsl:otherwise>\r\n        <\/xsl:choose>\r\n      <\/xsl:variable>\r\n      <xsl:text>, elementType: \'<\/xsl:text>\r\n      <xsl:value-of select="$ElementType"/>\r\n      <xsl:text>\'<\/xsl:text>\r\n    <\/xsl:if>\r\n  <\/xsl:template>\r\n  <xsl:template match="@Name" mode="FunctionImport-mode"><\/xsl:template>\r\n  <xsl:template match="@m:HttpMethod" mode="FunctionImport-mode">\r\n    <xsl:text>, method: \'<\/xsl:text>\r\n    <xsl:value-of select="."/>\r\n    <xsl:text>\'<\/xsl:text>\r\n  <\/xsl:template>\r\n  <xsl:template match="@IsBindable | @IsSideEffecting | @IsAlwaysBindable | @m:IsAlwaysBindable | @metadata:IsAlwaysBindable | @IsComposable" mode="FunctionImport-mode">\r\n    <xsl:text>, <\/xsl:text>\r\n    <xsl:call-template name="GetAttributeName">\r\n      <xsl:with-param name="Name" select="name()" />\r\n    <\/xsl:call-template>\r\n    <xsl:text>: <\/xsl:text>\r\n    <xsl:value-of select="."/>\r\n  <\/xsl:template>\r\n  <xsl:template match="@*" mode="FunctionImport-mode">\r\n    <xsl:text>, \'<\/xsl:text>\r\n    <xsl:call-template name="GetAttributeName">\r\n      <xsl:with-param name="Name" select="name()" />\r\n    <\/xsl:call-template>\r\n    <xsl:text>\': \'<\/xsl:text>\r\n    <xsl:value-of select="."/>        \r\n    <xsl:text>\'<\/xsl:text>\r\n  <\/xsl:template>\r\n  <xsl:template name="GetAttributeName">\r\n    <xsl:param name="Name" />\r\n    <xsl:choose>\r\n      <xsl:when test="contains($Name, \':\')">\r\n        <xsl:value-of select="substring-after($Name, \':\')"/>\r\n      <\/xsl:when>\r\n      <xsl:otherwise>\r\n        <xsl:value-of select="$Name"/>\r\n      <\/xsl:otherwise>\r\n    <\/xsl:choose>\r\n  <\/xsl:template>\r\n\r\n  <xsl:template match="edm:EntitySet">\'<xsl:value-of select="@Name"/>\': { type: <xsl:value-of select="$EntitySetBaseClass"  />, elementType: <xsl:value-of select="concat($DefaultNamespace,@EntityType)"/><xsl:text> <\/xsl:text><xsl:apply-templates select="." mode="Collection-Actions" />}<\/xsl:template>\r\n\r\n  <xsl:template match="edm:EntitySet" mode="Collection-Actions">\r\n    <xsl:variable name="CollectionType" select="concat(\'Collection(\', @EntityType, \')\')" />\r\n    <xsl:for-each select="//edm:FunctionImport[edm:Parameter[1]/@Type = $CollectionType]">\r\n      <xsl:if test="position() = 1">\r\n        <xsl:text>, actions: { \r\n        <\/xsl:text>\r\n      <\/xsl:if>\r\n        <xsl:apply-templates select="."><\/xsl:apply-templates><xsl:if test="position() != last()">,\r\n        <\/xsl:if>\r\n      <xsl:if test="position() = last()">\r\n        <xsl:text>\r\n      }<\/xsl:text>\r\n      <\/xsl:if>\r\n    <\/xsl:for-each>\r\n  <\/xsl:template>\r\n  \r\n  <xsl:template match="edm:Property | edm:NavigationProperty">\r\n    <property>\r\n    <xsl:variable name="memberDefinition">\r\n      <xsl:if test="parent::edm:EntityType/edm:Key/edm:PropertyRef[@Name = current()/@Name]"><attribute name="key">true<\/attribute><\/xsl:if>\r\n      <xsl:apply-templates select="@*[local-name() != \'Name\']" mode="render-field" />\r\n    <\/xsl:variable>\'<xsl:value-of select="@Name"/>\': { <xsl:choose><xsl:when test="function-available(\'msxsl:node-set\')"><xsl:for-each select="msxsl:node-set($memberDefinition)/*">\'<xsl:if test="@extended = \'true\'">$<\/xsl:if><xsl:value-of select="@name"/>\':<xsl:value-of select="."/>\r\n      <xsl:if test="position() != last()">,<xsl:text> <\/xsl:text>\r\n    <\/xsl:if> <\/xsl:for-each><\/xsl:when>\r\n  <xsl:otherwise><xsl:for-each select="exsl:node-set($memberDefinition)/*">\'<xsl:if test="@extended = \'true\'">$<\/xsl:if><xsl:value-of select="@name"/>\':<xsl:value-of select="."/>\r\n      <xsl:if test="position() != last()">,<xsl:text> <\/xsl:text>\r\n    <\/xsl:if> <\/xsl:for-each><\/xsl:otherwise>\r\n    <\/xsl:choose> }<\/property>\r\n<\/xsl:template>\r\n  \r\n  <xsl:template match="@Name" mode="render-field">\r\n  <\/xsl:template>\r\n\r\n  <xsl:template match="@Type" mode="render-field">\r\n    <xsl:choose>\r\n      <xsl:when test="starts-with(., \'Collection\')">\r\n        <attribute name="type">\'Array\'<\/attribute>\r\n        <xsl:variable name="len" select="string-length(.)-12"/>\r\n        <xsl:variable name="currType" select="substring(.,12,$len)"/>\r\n        <xsl:choose>\r\n          <xsl:when test="starts-with($currType, ../../../@Namespace)">\r\n            <attribute name="elementType">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$currType" />\'<\/attribute>\r\n          <\/xsl:when>\r\n          <xsl:otherwise>\r\n            <attribute name="elementType">\'<xsl:value-of select="$currType" />\'<\/attribute>\r\n          <\/xsl:otherwise>\r\n        <\/xsl:choose>\r\n      <\/xsl:when>\r\n      <xsl:when test="starts-with(., ../../../@Namespace)">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="."/>\'<\/attribute>\r\n      <\/xsl:when>\r\n      <xsl:otherwise>\r\n        <attribute name="type">\'<xsl:value-of select="."/>\'<\/attribute>\r\n      <\/xsl:otherwise>\r\n    <\/xsl:choose>\r\n  <\/xsl:template>\r\n\r\n  <xsl:template match="@ConcurrencyMode" mode="render-field">\r\n    <attribute name="concurrencyMode">$data.ConcurrencyMode.<xsl:value-of select="."/><\/attribute>\r\n  <\/xsl:template>\r\n\r\n  <xsl:template match="@Nullable" mode="render-field">\r\n    <attribute name="nullable"><xsl:value-of select="."/><\/attribute>\r\n    \r\n    <xsl:if test=". = \'false\'">\r\n      <xsl:choose>\r\n        <xsl:when test="parent::edm:Property/@annot:StoreGeneratedPattern = \'Identity\' or parent::edm:Property/@annot:StoreGeneratedPattern = \'Computed\'"><\/xsl:when>\r\n        <xsl:otherwise><attribute name="required">true<\/attribute><\/xsl:otherwise>\r\n      <\/xsl:choose>\r\n    <\/xsl:if>\r\n  <\/xsl:template>\r\n\r\n  <xsl:template match="@annot:StoreGeneratedPattern" mode="render-field">\r\n    <xsl:if test=". != \'None\'"><attribute name="computed">true<\/attribute><\/xsl:if>    \r\n  <\/xsl:template>\r\n\r\n  <xsl:template match="@MaxLength" mode="render-field">\r\n    <attribute name="maxLength">\r\n      <xsl:choose>\r\n        <xsl:when test="string(.) = \'Max\'">Number.POSITIVE_INFINITY<\/xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="."/>\r\n        <\/xsl:otherwise>\r\n      <\/xsl:choose>\r\n    <\/attribute>\r\n  <\/xsl:template>\r\n\r\n  <xsl:template match="@FixedLength | @Unicode | @Precision | @Scale" mode="render-field">\r\n  <\/xsl:template>\r\n  <xsl:template match="@*" mode="render-field">\r\n    <xsl:variable name="nameProp">\r\n      <xsl:choose>\r\n        <xsl:when test="substring-after(name(), \':\') != \'\'">\r\n          <xsl:value-of select="substring-after(name(), \':\')"/>\r\n        <\/xsl:when>\r\n        <xsl:otherwise>\r\n          <xsl:value-of select="name()"/>\r\n        <\/xsl:otherwise>\r\n      <\/xsl:choose>\r\n    <\/xsl:variable>\r\n    <xsl:element name="attribute"><xsl:attribute name="extended">true<\/xsl:attribute><xsl:attribute name="name"><xsl:value-of select="$nameProp"/><\/xsl:attribute>\'<xsl:value-of select="."/>\'<\/xsl:element>\r\n  <\/xsl:template>\r\n\r\n  <xsl:template match="@Relationship" mode="render-field">\r\n    <xsl:variable name="relationName" select="string(../@ToRole)"/>\r\n    <xsl:variable name="relationshipName" select="string(.)" />\r\n    <xsl:variable name="relation" select="key(\'associations\',string(.))/edm:End[@Role = $relationName]" />\r\n    <xsl:variable name="otherName" select="../@FromRole" />\r\n    <xsl:variable name="otherProp" select="//edm:NavigationProperty[@ToRole = $otherName and @Relationship = $relationshipName]" />\r\n    <xsl:variable name="m" select="$relation/@Multiplicity" />\r\n    <xsl:choose>\r\n      <xsl:when test="$m = \'*\'">\r\n        <attribute name="type">\'<xsl:value-of select="$CollectionBaseClass"/>\'<\/attribute>\r\n        <attribute name="elementType">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'<\/attribute>\r\n        <xsl:if test="not($otherProp/@Name)">\r\n          <attribute name="inverseProperty">\'$$unbound\'<\/attribute><\/xsl:if>\r\n        <xsl:if test="$otherProp/@Name">\r\n          <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'<\/attribute><\/xsl:if>\r\n      <\/xsl:when>\r\n      <xsl:when test="$m = \'0..1\'">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'<\/attribute>\r\n        <xsl:choose>\r\n          <xsl:when test="$otherProp">\r\n            <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'<\/attribute>\r\n          <\/xsl:when >\r\n          <xsl:otherwise>\r\n            <attribute name="inverseProperty">\'$$unbound\'<\/attribute>\r\n            <xsl:message terminate="no">  Warning: inverseProperty other side missing: <xsl:value-of select="."/>\r\n          <\/xsl:message>\r\n          <\/xsl:otherwise>\r\n        <\/xsl:choose>\r\n      <\/xsl:when>\r\n      <xsl:when test="$m = \'1\'">\r\n        <attribute name="type">\'<xsl:value-of select="$DefaultNamespace"/><xsl:value-of select="$relation/@Type"/>\'<\/attribute>\r\n        <attribute name="required">true<\/attribute>\r\n        <xsl:choose>\r\n          <xsl:when test="$otherProp">\r\n            <attribute name="inverseProperty">\'<xsl:value-of select="$otherProp/@Name"/>\'<\/attribute>\r\n          <\/xsl:when >\r\n          <xsl:otherwise>\r\n            <attribute name="inverseProperty">\'$$unbound\'<\/attribute>\r\n            <xsl:message terminate="no">\r\n              Warning: inverseProperty other side missing: <xsl:value-of select="."/>\r\n            <\/xsl:message>\r\n          <\/xsl:otherwise>\r\n        <\/xsl:choose>\r\n      <\/xsl:when>\r\n    <\/xsl:choose>\r\n  <\/xsl:template>\r\n\r\n\r\n  <xsl:template match="@FromRole | @ToRole" mode="render-field"><\/xsl:template>\r\n\r\n  <xsl:template match="*" mode="render-field">\r\n    <!--<unprocessed>!!<xsl:value-of select="name()"/>!!<\/unprocessed>-->\r\n    <xsl:message terminate="no">  Warning: <xsl:value-of select="../../@Name"/>.<xsl:value-of select="../@Name"/>:<xsl:value-of select="name()"/> is an unknown/unprocessed attribued<\/xsl:message>\r\n  <\/xsl:template>\r\n  <!--<xsl:template match="*">\r\n    !<xsl:value-of select="name()"/>!\r\n  <\/xsl:template>-->\r\n<\/xsl:stylesheet>\r\n'}});$data.MetadataLoader=new $data.MetadataLoaderClass;$data.service=function(n,t,i){function e(n){switch(typeof n){case"object":typeof n.success=="function"||typeof n.error=="function"?u=n:r=n;break;case"function":u=n}}var r,u,f;return e(t),e(i),typeof n=="object"&&(r=$data.typeSystem.extend(n,r),n=n.url,delete r.url),f=new $data.PromiseHandler,u=f.createCallback(u),$data.MetadataLoader.load(n,{success:function(n){var i=n.type,t;r&&(t=r.serviceName||r.storeAlias,t&&"addStore"in $data&&$data.addStore(t,n,r.isDefault===undefined||r.isDefault));u.success(n,i)},error:u.error},r),f.getPromise()},function(n){typeof jQuery!="undefined"&&(n.Class.define("$data.Deferred",n.PromiseHandlerBase,null,{constructor:function(){this.deferred=new $.Deferred},deferred:{},createCallback:function(t){t=n.typeSystem.createCallbackSetting(t);var i=this;return cbWrapper={success:function(){t.success.apply(i.deferred,arguments);i.deferred.resolve.apply(i.deferred,arguments)},error:function(){Array.prototype.push.call(arguments,i.deferred);t.error.apply(i.deferred,arguments)},notify:function(){t.notify.apply(i.deferred,arguments);i.deferred.notify.apply(i.deferred,arguments)}}},getPromise:function(){return this.deferred.promise()}},null),n.PromiseHandler=n.Deferred)}($data),function(n){n.initService=function(t,i){var u=new n.PromiseHandler,r,f,e;return typeof t=="object"?(r=t,f=r.isSSL||r.isSSL===undefined?"https":"http",e=r.port?":"+r.port:"",t=typeof r.license=="string"&&r.license.toLowerCase()==="business"?r.appId&&r.serviceName?f+"://"+r.appId+".jaystack.net"+e+"/"+r.serviceName:r.url:r.ownerId&&r.appId&&r.serviceName?f+"://open.jaystack.net/"+r.ownerId+"/"+r.appId+"/api/"+r.serviceName:r.url,delete r.url,r=n.typeSystem.extend(r,i)):r=i,n.service(t,r).then(function(n){var t=n();return t.onReady().then(function(t){t.serviceFactory=n;u.deferred.resolve(t,n,n.type)}).fail(function(){u.deferred.reject.apply(u.deferred,arguments)})}).fail(function(){u.deferred.reject.apply(u.deferred,arguments)}),u.getPromise()}}($data);
/*
//# sourceMappingURL=jaydata.min.js.map
*/